
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://microsoft.github.io/copilot-camp/pages/custom-engine/agent-framework/05-add-communication/">
      
      
        <link rel="prev" href="../04-add-policy-search/">
      
      
        <link rel="next" href="../06-add-copilot-api/">
      
      
        
          <link rel="alternate" href="./" hreflang="en">
        
          <link rel="alternate" href="../../../../ja/pages/custom-engine/agent-framework/05-add-communication/" hreflang="ja">
        
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Lab BAF5 - Add Communication Capabilities - Copilot Developer Camp</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/labStyles.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lab-baf5-add-communication-capabilities" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Copilot Developer Camp" class="md-header__button md-logo" aria-label="Copilot Developer Camp" data-md-component="logo">
      
  <img src="../../../../assets/images/tent-small.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Copilot Developer Camp
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lab BAF5 - Add Communication Capabilities
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../../ja/pages/custom-engine/agent-framework/05-add-communication/" hreflang="ja" class="md-select__link">
              Japanese (日本語)
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/microsoft/copilot-camp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/copilot-camp
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../make/" class="md-tabs__link">
          
  
  
  Maker Path - Make your agent

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../extend-m365-copilot/" class="md-tabs__link">
          
  
  
  Extend - Build a declarative agent

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  Build - Build a custom engine agent

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../beyond-agents/" class="md-tabs__link">
          
  
  
  Beyond Agents - AI concepts

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../resources/" class="md-tabs__link">
        
  
  
    
  
  Resources

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Copilot Developer Camp" class="md-nav__button md-logo" aria-label="Copilot Developer Camp" data-md-component="logo">
      
  <img src="../../../../assets/images/tent-small.png" alt="logo">

    </a>
    Copilot Developer Camp
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/microsoft/copilot-camp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/copilot-camp
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Maker Path - Make your agent
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Maker Path - Make your agent
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/agent-builder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MAB - Copilot Studio lite
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/agent-builder/01-first-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MAB1 - Copilot Studio Lite
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS - Microsoft Copilot Studio
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/00-prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS0 - Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/01-first-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS1 - First agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/02-topics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS2 - Defining Topics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/03-actions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS3 - Defining Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/04-extending-m365-copilot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS4 - Extending Microsoft 365 Copilot
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/05-connectors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS5 - Consuming a custom connector
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/06-mcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS6 - Consuming an MCP server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/07-autonomous/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS7 - Creating Autonomous Agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/08-rag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS8 - Integrating Azure AI Search for RAG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/09-connected-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS9 - Connected Agents (Preview)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/10-mcp-oauth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS10 - Consuming an MCP server with OAuth 2.0
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/sharepoint-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MSA - SharePoint agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/sharepoint-agents/01-first-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MSA1 - Build your first SharePoint agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/sharepoint-agents/02-sharing-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MSA2 - Sharing SharePoint agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Extend - Build a declarative agent
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Extend - Build a declarative agent
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Setup
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Setup
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/00-prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E0 - Prerequisites and Environment Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Declarative Agent Fundamentals
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Declarative Agent Fundamentals
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/01-typespec-declarative-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E1 - Build a Declarative Agent using TypeSpec
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/01a-geolocator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E1a - Build a game agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Build and Integrate API from scratch
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Build and Integrate API from scratch
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/02-build-the-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E2 - Build a Backend API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/03-add-declarative-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E3 - Add Declarative Agent and API Plugin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/04-enhance-api-plugin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E4 - Enhance API and Plugin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/05-add-adaptive-card/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E5 - Add Adaptive Cards
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/06a-add-authentication-ttk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E6a - Add Entra ID Authentication (Toolkit)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Integration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Integration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/07-add-graphconnector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E7 - Add Copilot Connector
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/08-mcp-server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E8 - Connect Declarative agent to MCP Server (Preview)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/09-connected-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E9 - Connected Agents using VS Code (Preview)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/10-mcp-auth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E10 - Connect Declarative Agent to OAuth-Protected MCP Server (Preview)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Build - Build a custom engine agent
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Build - Build a custom engine agent
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Start with Microsoft Foundry
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Start with Microsoft Foundry
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/00-prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BMA0 - Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/01-agent-in-foundry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BMA1 - Prepare your agent in Microsoft Foundry
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/02-agent-with-agents-sdk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BMA2 - Build your first agent using M365 Agents SDK
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/03-agent-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BMA3 - Configure agent properties and test on Teams
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/04-bring-agent-to-copilot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BMA4 - Bring your agent to Copilot Chat
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Start with Agent Framework
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Start with Agent Framework
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../00-prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BAF0 - Prerequisites
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-build-and-run/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BAF1 - Build and Run Your First Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-add-claim-search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BAF2 - Add Document Search with Azure AI Search
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-add-vision-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BAF3 - Add Vision Analysis with Mistral AI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-add-policy-search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BAF4 - Add Policy Search
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Lab BAF5 - Add Communication Capabilities
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BAF5 - Add Communication Capabilities
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#exercise-1-create-the-communicationplugin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 1: Create the CommunicationPlugin
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-2-register-communicationplugin-in-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 2: Register CommunicationPlugin in Agent
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-3-update-agent-instructions-and-security" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 3: Update Agent Instructions and security
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-4-update-startconversationplugin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 4: Update StartConversationPlugin
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-5-test-communication-features" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 5: Test Communication Features
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-add-copilot-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BAF6 - Add Microsoft 365 Work IQ API Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../07-add-mcp-tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BAF7 - Add MCP Tools Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Beyond Agents - AI concepts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Beyond Agents - AI concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../beyond-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../beyond-agents/beginner-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 1 - Simple agent instructions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Resources
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="lab-baf5-add-communication-capabilities">Lab BAF5 - Add Communication Capabilities</h1>
<p>In this lab, you'll enhance the Zava Insurance Agent with professional communication capabilities. You'll add the ability to send detailed claim reports via email using Microsoft Graph and generate comprehensive investigation reports that include vision analysis findings and fraud assessment data.</p>
<details class="info" open="open">
<summary>Understanding Communication Plugin</summary>
<p>The <strong>CommunicationPlugin</strong> enables your agent to:</p>
<ul>
<li><strong>Send Professional Emails</strong>: Use Microsoft Graph Mail API to send HTML-formatted claim details  </li>
<li><strong>Generate Investigation Reports</strong>: Create comprehensive reports combining data from ClaimsPlugin, VisionPlugin, and PolicyPlugin  </li>
<li><strong>Knowledge Base Aggregation</strong>: Pull all available claim data including vision analysis, fraud assessment, and policy details  </li>
<li><strong>OAuth Token Management</strong>: Use cached On-Behalf-Of (OBO) tokens for secure Graph API calls</li>
</ul>
<p>This completes the claim processing workflow by adding communication and reporting capabilities.</p>
</details>
<h2 id="exercise-1-create-the-communicationplugin">Exercise 1: Create the CommunicationPlugin</h2>
<p>Now that you have claims search, vision analysis, and policy search capabilities, let's add communication features to send reports and emails.</p>
<h3 id="step-1-create-complete-communicationplugin">Step 1: Create Complete CommunicationPlugin</h3>
<details class="note">
<summary>What this plugin does</summary>
<p>The <code>CommunicationPlugin</code> provides two main capabilities:</p>
<p><strong>SendClaimDetailsByEmail</strong>:</p>
<ul>
<li>Retrieves comprehensive claim data from Knowledge Base Service</li>
<li>Creates professional HTML-formatted email</li>
<li>Sends via Microsoft Graph API</li>
<li>Uses cached OAuth token for authentication</li>
<li>Defaults to current user's email if no recipient specified</li>
</ul>
<p><strong>GenerateInvestigationReport</strong>:</p>
<ul>
<li>Gathers all claim data including vision analysis and fraud assessment</li>
<li>Formats a comprehensive investigation report with recommendations</li>
<li>Returns formatted markdown report with professional structure</li>
</ul>
<p>Both methods use the <strong>KnowledgeBaseService</strong> with custom instructions to retrieve and synthesize claim data.</p>
</details>
<p>1️⃣ Create a new file <code>src/Plugins/CommunicationPlugin.cs</code> with the complete implementation:</p>
<pre><code class="language-csharp">using Microsoft.Agents.Builder;
using Microsoft.Agents.Core.Models;
using System.ComponentModel;
using System.Text.Json;
using InsuranceAgent.Services;
using InsuranceAgent;
using Microsoft.Agents.Builder.State;

namespace ZavaInsurance.Plugins
{
    /// &lt;summary&gt;
    /// Communication Plugin for Zava Insurance
    /// Provides tools for generating professional policyholder communications
    /// Ensures consistent, compliant messaging across all customer touchpoints
    /// &lt;/summary&gt;
    public class CommunicationPlugin
    {
        private readonly ITurnContext _turnContext;
        private readonly ITurnState _turnState;
        private readonly KnowledgeBaseService _knowledgeBaseService;
        private readonly HttpClient _httpClient;

        public CommunicationPlugin(ITurnContext turnContext, ITurnState turnState, KnowledgeBaseService knowledgeBaseService, HttpClient httpClient)
        {
            _turnContext = turnContext ?? throw new ArgumentNullException(nameof(turnContext));
            _turnState = turnState ?? throw new ArgumentNullException(nameof(turnState));
            _knowledgeBaseService = knowledgeBaseService ?? throw new ArgumentNullException(nameof(knowledgeBaseService));
            _httpClient = httpClient ?? throw new ArgumentNullException(nameof(httpClient));
        }

        /// &lt;summary&gt;
        /// Sends detailed claim information via email using Microsoft Graph
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;claimId&quot;&gt;The unique claim identifier&lt;/param&gt;
        /// &lt;param name=&quot;recipientEmail&quot;&gt;Email address to send the claim details to (optional, uses policyholder email if not provided)&lt;/param&gt;
        /// &lt;returns&gt;Success or failure message indicating email delivery status&lt;/returns&gt;
        [Description(&quot;Sends a well-formatted email with comprehensive claim details including policyholder info, documentation status, timeline, and recommendations via Microsoft Graph.&quot;)]
        public async Task&lt;string&gt; SendClaimDetailsByEmail(string claimId, string recipientEmail = null)
        {
            await NotifyUserAsync($&quot;Retrieving details for claim {claimId}...&quot;);

            // Read the user profile
            var userProfile = _turnState.Conversation.GetCachedUserProfile();
            var accessToken = _turnState.Conversation.GetCachedOBOAccessToken();

            // Use Knowledge Base with instructions for email-ready claim summary
            var instructions = @&quot;You are preparing a professional claim summary for email. Include:
                - Claim Number, Status, and Date Filed
                - Policyholder Information
                - Claim Details (type, amount, location, description)
                - Current Status and Next Steps
                - Document Status and Requirements
                - Key Timeline Events
                Format clearly for email readability. Cite sources with [ref_id:X].&quot;;

            var query = $&quot;complete details for claim {claimId}&quot;;
            var claimData = await _knowledgeBaseService.RetrieveAsync(query, instructions, topResults: 5);

            // Use provided email or default to the current user's email
            var toEmail = string.IsNullOrEmpty(recipientEmail) ? userProfile.Mail : recipientEmail;

            await NotifyUserAsync($&quot;Preparing email for {toEmail}...&quot;);

            // Create well-formatted HTML email content using KB data
            var emailContent = CreateClaimDetailsEmailContentFromKB(claimId, claimData.ToString() ?? &quot;&quot;);

            try
            {
                // Send email via Microsoft Graph
                var emailPayload = new
                {
                    message = new
                    {
                        subject = $&quot;Zava Insurance - Claim Details Report ({claimId})&quot;,
                        body = new
                        {
                            contentType = &quot;HTML&quot;,
                            content = emailContent
                        },
                        toRecipients = new[]
                        {
                            new
                            {
                                emailAddress = new
                                {
                                    address = toEmail
                                }
                            }
                        },
                        from = new
                        {
                            emailAddress = new
                            {
                                address = userProfile.Mail
                            }
                        }
                    },
                    saveToSentItems = true
                };

                var jsonContent = JsonSerializer.Serialize(emailPayload);
                var httpContent = new StringContent(jsonContent, System.Text.Encoding.UTF8, &quot;application/json&quot;);

                _httpClient.DefaultRequestHeaders.Clear();
                _httpClient.DefaultRequestHeaders.Add(&quot;Authorization&quot;, $&quot;Bearer {accessToken}&quot;);
                _httpClient.DefaultRequestHeaders.Add(&quot;Accept&quot;, &quot;application/json&quot;);

                await NotifyUserAsync($&quot;Sending email via Microsoft Graph...&quot;);

                var response = await _httpClient.PostAsync(&quot;https://graph.microsoft.com/v1.0/me/sendMail&quot;, httpContent);

                if (response.IsSuccessStatusCode)
                {
                    await NotifyUserAsync($&quot;✅ Email sent successfully!&quot;);
                    return $&quot;✅ Success: Claim details for {claimId} have been successfully sent to {toEmail}. &quot; +
                           $&quot;The email includes comprehensive claim information, documentation status, timeline, and recommendations.&quot;;
                }
                else
                {
                    var errorContent = await response.Content.ReadAsStringAsync();
                    await NotifyUserAsync($&quot;❌ Failed to send email: {response.StatusCode}&quot;);
                    return $&quot;❌ Error: Failed to send email for claim {claimId}. &quot; +
                           $&quot;Status: {response.StatusCode}, Details: {errorContent}&quot;;
                }
            }
            catch (Exception ex)
            {
                await NotifyUserAsync($&quot;❌ Exception occurred while sending email&quot;);
                return $&quot;❌ Error: Exception occurred while sending claim details email: {ex.Message}&quot;;
            }
        }

        /// &lt;summary&gt;
        /// Creates well-formatted HTML email content with claim details
        /// &lt;/summary&gt;
        private string CreateClaimDetailsEmailContentFromKB(string claimId, string knowledgeBaseData)
        {
            return $@&quot;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;style&gt;
        body {{ font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background-color: #f8f9fa; }}
        .container {{ max-width: 800px; margin: 0 auto; background-color: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }}
        .header {{ background: linear-gradient(135deg, #007bff, #0056b3); color: white; padding: 30px; border-radius: 8px 8px 0 0; }}
        .content {{ padding: 30px; }}
        .section {{ margin-bottom: 25px; }}
        .footer {{ background-color: #f8f9fa; padding: 20px; text-align: center; color: #6c757d; border-radius: 0 0 8px 8px; }}
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class='container'&gt;
        &lt;div class='header'&gt;
            &lt;h1&gt;🏢 Zava Insurance - Claim Details Report&lt;/h1&gt;
            &lt;h2&gt;Claim #{claimId}&lt;/h2&gt;
        &lt;/div&gt;

        &lt;div class='content'&gt;
            &lt;div class='section'&gt;
                &lt;h3&gt;📋 Claim Information&lt;/h3&gt;
                &lt;pre style='background-color: #f8f9fa; padding: 15px; border-radius: 5px; white-space: pre-wrap;'&gt;{knowledgeBaseData}&lt;/pre&gt;
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class='footer'&gt;
            &lt;p&gt;&lt;strong&gt;Zava Insurance&lt;/strong&gt; | Professional Claims Management&lt;/p&gt;
            &lt;p&gt;This is an automated report generated from our AI-powered system.&lt;/p&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;&quot;;
        }

        /// &lt;summary&gt;
        /// Generates a comprehensive investigation report for a claim including vision analysis and fraud assessment
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;claimNumber&quot;&gt;The claim number to generate report for&lt;/param&gt;
        /// &lt;returns&gt;A formatted investigation report with findings and recommendations&lt;/returns&gt;
        [Description(&quot;Generates a comprehensive investigation report for a claim that includes damage assessment from vision analysis, fraud risk evaluation, and actionable recommendations for claim resolution.&quot;)]
        public async Task&lt;string&gt; GenerateInvestigationReport(string claimNumber)
        {
            if (string.IsNullOrWhiteSpace(claimNumber))
                return &quot;❌ Error: Claim number cannot be empty.&quot;;

            await NotifyUserAsync($&quot;📊 Generating investigation report for {claimNumber}...&quot;);

            try
            {
                // Use Knowledge Base to gather comprehensive claim data including vision and fraud analysis
                var instructions = @&quot;You are an insurance claims investigator preparing a comprehensive investigation report. 
                    Include ALL available information:

                    **Claim Overview:**
                    - Claim Number, Type, Status
                    - Policyholder Name and Policy Number
                    - Date Filed, Estimated Cost
                    - Location and Description of Incident

                    **Vision Analysis Findings:**
                    - Damage assessment results from AI vision analysis
                    - Estimated repair costs from damage photos
                    - Approval status of vision analysis
                    - Key damage observations

                    **Fraud Risk Assessment:**
                    - Fraud risk score and level
                    - Key fraud indicators identified
                    - Comparison to normal claim patterns
                    - Risk assessment explanation

                    **Documentation Review:**
                    - Completeness of documentation
                    - Missing items (if any)
                    - Quality of submitted evidence

                    **Recommendations:**
                    - Approval/denial recommendation with justification
                    - Required next steps
                    - Any additional investigation needed
                    - Suggested claim resolution path

                    Format professionally with clear sections, bullet points, and evidence-based conclusions.
                    Cite all sources with [ref_id:X].&quot;;

                var query = $&quot;Complete investigation details for claim {claimNumber} including vision analysis, fraud assessment, and all supporting evidence&quot;;
                var reportData = await _knowledgeBaseService.RetrieveAsync(query, instructions, topResults: 10);

                // Format the final report
                var report = new System.Text.StringBuilder();
                report.AppendLine($&quot;# 📋 Investigation Report: {claimNumber}&quot;);
                report.AppendLine($&quot;**Generated:** {DateTime.UtcNow:yyyy-MM-dd HH:mm:ss} UTC&quot;);
                report.AppendLine($&quot;**Status:** Investigation Complete&quot;);
                report.AppendLine();
                report.AppendLine(&quot;---&quot;);
                report.AppendLine();
                report.AppendLine(reportData);
                report.AppendLine();
                report.AppendLine(&quot;---&quot;);
                report.AppendLine();
                report.AppendLine(&quot;**Report Prepared By:** Zava Insurance Claims Investigation System&quot;);
                report.AppendLine(&quot;**Next Steps:** Review findings and proceed with recommended claim resolution action.&quot;);

                await NotifyUserAsync(&quot;✅ Investigation report generated successfully!&quot;);

                return report.ToString();
            }
            catch (Exception ex)
            {
                Console.WriteLine($&quot;Error generating investigation report: {ex.Message}&quot;);
                return $&quot;❌ Error generating investigation report: {ex.Message}&quot;;
            }
        }

        // Helper methods
        private async Task NotifyUserAsync(string message)
        {
            if (!_turnContext.Activity.ChannelId.Channel!.Contains(Channels.Webchat))
            {
                await _turnContext.StreamingResponse.QueueInformativeUpdateAsync(message);
            }
            else
            {
                await _turnContext.StreamingResponse.QueueInformativeUpdateAsync(message).ConfigureAwait(false);
            }
        }
    }
}
</code></pre>
<p><cc-end-step lab="baf5" exercise="1" step="1" /></p>
<h2 id="exercise-2-register-communicationplugin-in-agent">Exercise 2: Register CommunicationPlugin in Agent</h2>
<p>Now let's wire up the CommunicationPlugin in your ZavaInsuranceAgent.</p>
<h3 id="step-1-instantiate-communicationplugin">Step 1: Instantiate CommunicationPlugin</h3>
<p>1️⃣ Open <code>src/Agent/ZavaInsuranceAgent.cs</code>.</p>
<p>2️⃣ Find the <code>GetClientAgent</code> method (around line 159).</p>
<p>3️⃣ Locate where plugins are instantiated (after <code>PolicyPlugin policyPlugin = ...</code>).</p>
<p>4️⃣ Add the CommunicationPlugin instantiation:</p>
<pre><code class="language-csharp">
// Get HttpClient for API calls
var httpClientFactory = scope.ServiceProvider.GetRequiredService&lt;IHttpClientFactory&gt;();
var httpClient = httpClientFactory.CreateClient();
// Create CommunicationPlugin with required dependencies
CommunicationPlugin communicationPlugin = new(context, turnState, knowledgeBaseService, httpClient);
</code></pre>
<p><cc-end-step lab="baf5" exercise="2" step="1" /></p>
<h3 id="step-2-register-communication-tools">Step 2: Register Communication Tools</h3>
<p>In the same <code>GetClientAgent</code> method, scroll down to where tools are added to <code>toolOptions.Tools</code> (around line 180).</p>
<p>Find the Policy tools section and add Communication tools right after:</p>
<pre><code class="language-csharp">// Register Communication tools
toolOptions.Tools.Add(AIFunctionFactory.Create(communicationPlugin.SendClaimDetailsByEmail));
toolOptions.Tools.Add(AIFunctionFactory.Create(communicationPlugin.GenerateInvestigationReport));
</code></pre>
<details class="note">
<summary>Tool Registration Pattern</summary>
<p>The agent uses <strong>AIFunctionFactory</strong> to register plugin methods as AI tools. Each <code>[Description]</code> attribute on plugin methods becomes the tool description that helps the LLM decide when to call them.</p>
</details>
<p><cc-end-step lab="baf5" exercise="2" step="2" /></p>
<h2 id="exercise-3-update-agent-instructions-and-security">Exercise 3: Update Agent Instructions and security</h2>
<p>Update your agent's instructions to include communication capabilities and the agent security to support user's authentication and On-Behalf-Of (OBO) token support.</p>
<h3 id="step-1-add-communication-tools-to-instructions">Step 1: Add Communication Tools to Instructions</h3>
<p>1️⃣ In <code>src/Agent/ZavaInsuranceAgent.cs</code>, find the <code>AgentInstructions</code> field (around line 32).</p>
<p>2️⃣ Find the tool list section and update it with the list of all tools including communication:</p>
<pre><code class="language-csharp">private readonly string AgentInstructions = &quot;&quot;&quot;
You are a professional insurance claims assistant for Zava Insurance.

Whenever the user starts a new conversation or provides a prompt to start a new conversation like &quot;start over&quot;, &quot;restart&quot;, 
&quot;new conversation&quot;, &quot;what can you do?&quot;, &quot;how can you help me?&quot;, etc. use {{StartConversationPlugin.StartConversation}} and 
provide to the user exactly the message you get back from the plugin.

**Available Tools:**
Use {{DateTimeFunctionTool.getDate}} to get the current date and time.
For claims search, use {{ClaimsPlugin.SearchClaims}} and {{ClaimsPlugin.GetClaimDetails}}.
For damage photo viewing, use {{VisionPlugin.ShowDamagePhoto}}.
For AI vision damage analysis, use {{VisionPlugin.AnalyzeAndShowDamagePhoto}} and require approval via {{VisionPlugin.ApproveAnalysis}}.
For policy search, use {{PolicyPlugin.SearchPolicies}} and {{PolicyPlugin.GetPolicyDetails}}.
For policy coverage questions and terms, use {{PolicyPlugin.SearchPolicyDocuments}}.
For sending investigation reports and claim details via email, use {{CommunicationPlugin.GenerateInvestigationReport}} and {{CommunicationPlugin.SendClaimDetailsByEmail}}.

**IMPORTANT**: When user asks to &quot;check policy for this claim&quot;, first use GetClaimDetails to get the claim's policy number, then use GetPolicyDetails with that policy number.

Stick to the scenario above and use only the information from the tools when answering questions.
Be concise and professional in your responses.
&quot;&quot;&quot;;
</code></pre>
<details class="note">
<summary>Why Update Instructions</summary>
<p>The agent instructions guide the LLM on when to use each tool. Adding communication tools ensures the agent knows it can send emails and generate reports when requested.</p>
</details>
<p><cc-end-step lab="baf5" exercise="3" step="1" /></p>
<h3 id="step-2-configure-obo-settings">Step 2: Configure OBO settings</h3>
<p>1️⃣ In <code>m365agents.local.yml</code>, find the <code>file/createOrUpdateJsonFile</code> action (around line 47).</p>
<p>2️⃣ Uncomment the <code>me</code> settings in the <code>UserAuthorization</code> group of settings in order to enable the settings with name <code>OBOConnectionName</code>, <code>OBOScopes</code>, <code>Title</code>, and <code>Text</code>. The code should look like the following:</p>
<pre><code class="language-yaml">          UserAuthorization:
            DefaultHandlerName: me
            AutoSignin: true
            Handlers:
              me:
                Settings:
                  AzureBotOAuthConnectionName: &quot;Microsoft Graph&quot;
                  OBOConnectionName: &quot;BotServiceConnection&quot;
                  OBOScopes:
                    - &quot;https://graph.microsoft.com/.default&quot;
                  Title: &quot;Sign in&quot;
                  Text: &quot;Sign in to Microsoft Graph&quot;
</code></pre>
<details class="note">
<summary>What this code does</summary>
<p>The new code enables settings to support On-Behalf-Of (OBO) flow for the Azure Bot backing the agent.</p>
</details>
<p><cc-end-step lab="baf5" exercise="3" step="2" /></p>
<h3 id="step-3-implement-users-authentication-and-obo">Step 3: Implement user's authentication and OBO</h3>
<p>1️⃣ In <code>src/Agent/ZavaInsuranceAgent.cs</code>, find the <code>OnMessageAsync</code> method (around line 87).</p>
<p>2️⃣ Right after the first line of the method <code>await turnContext.StreamingResponse.QueueInformativeUpdateAsync( ...</code> add the following code excerpt:</p>
<pre><code class="language-csharp">            // Check if user profile is already cached, if not fetch and cache it
            var userProfile = turnState.Conversation.GetCachedUserProfile();
            if (userProfile == null)
            {
                try
                {
                    // Get the access token and store it in the conversation state
                    var accessToken = await UserAuthorization.ExchangeTurnTokenAsync(turnContext, UserAuthorization.DefaultHandlerName, exchangeScopes: new[] { &quot;https://graph.microsoft.com/.default&quot; }, cancellationToken: cancellationToken);
                    turnState.Conversation.SetCachedOBOAccessToken(accessToken);

                    // Get the user profile and store it in the conversation state
                    userProfile = await GetUserProfile(accessToken, cancellationToken);
                    turnState.Conversation.SetCachedUserProfile(userProfile);

                    // Show current user profile information to let clients that support streaming know that we are processing the request for the current user.
                    await turnContext.StreamingResponse.QueueInformativeUpdateAsync($&quot;⚒️ Working on your request {userProfile.DisplayName} ...&quot;, cancellationToken).ConfigureAwait(false);
                }
                catch (InvalidOperationException ex)
                {
                    System.Diagnostics.Trace.WriteLine($&quot;Exception occurred: {ex.Message}&quot;);
                    // User is not signed in, proceed as anonymous and inform the user
                    await turnContext.StreamingResponse.QueueInformativeUpdateAsync(&quot;⚠️ Please sign in if you want to use authenticated features.&quot;, cancellationToken).ConfigureAwait(false);
                }
            }
</code></pre>
<details class="note">
<summary>What this code does</summary>
<p>The code excerpt you just added takes care of the following activities:</p>
<ul>
<li>Tries to retrieve the current user profile from the conversation</li>
<li>If the user profile does not exist in the cache<ul>
<li>Retrieves an OBO token for the current user</li>
<li>Caches the OBO token in the current conversation</li>
<li>Retrieves the user profile via Microsoft Graph</li>
<li>Caches the user profile in the current conversation</li>
<li>Informs the user that the agent is working for her/him</li>
</ul>
</li>
</ul>
<p>In case of failure while retrieving the user profile, the agent informs via streaming the user to sign in </p>
</details>
<p><cc-end-step lab="baf5" exercise="3" step="3" /></p>
<h2 id="exercise-4-update-startconversationplugin">Exercise 4: Update StartConversationPlugin</h2>
<p>Update the welcome message to inform users about all capabilities including communication features.</p>
<h3 id="step-1-update-welcome-message">Step 1: Update Welcome Message</h3>
<p>1️⃣ Open <code>src/Plugins/StartConversationPlugin.cs</code>.</p>
<p>2️⃣ Find the <code>StartConversation</code> method.</p>
<p>3️⃣ Replace the <code>welcomeMessage</code> with the complete workflow:</p>
<pre><code class="language-csharp">var welcomeMessage = &quot;👋 Welcome to Zava Insurance Claims Assistant!\n\n&quot; +
                    &quot;I'm your AI-powered insurance claims specialist. I help adjusters and investigators streamline the entire claims process - from initial assessment to final approval.\n\n&quot; +
                    &quot;**What I can do:**\n\n&quot; +
                    &quot;- Analyze claims for fraud indicators and risk patterns\n&quot; +
                    &quot;- Validate policy coverage and check expiration dates\n&quot; +
                    &quot;- Search policy documentation and claims procedures\n&quot; +
                    &quot;- Use Mistral AI to analyze damage photos instantly\n&quot; +
                    &quot;- Generate investigation reports\n&quot; +
                    &quot;- Send detailed claim information via email\n&quot; +
                    &quot;- Track claim timelines and identify processing bottlenecks\n\n&quot; +
                    &quot;🎯 Try this complete investigation workflow:\n&quot; +
                    &quot;1. \&quot;Get details for claim CLM-2025-001007\&quot;\n&quot; +
                    &quot;2. \&quot;Check policy for this claim\&quot;\n&quot; +
                    &quot;3. \&quot;What coverage does auto insurance include?\&quot;\n&quot; +
                    &quot;4. \&quot;Analyze fraud risk for this claim\&quot;\n&quot; +
                    &quot;5. \&quot;Show damage photo for this claim\&quot;\n&quot; +
                    &quot;6. \&quot;Analyze this damage photo\&quot;\n&quot; +
                    &quot;7. \&quot;What's the claims filing procedure?\&quot;\n&quot; +
                    &quot;8. \&quot;Check compliance for this claim\&quot;\n&quot; +
                    &quot;9. \&quot;Generate investigation report for claim CLM-2025-001007\&quot;\n&quot; +
                    &quot;10. \&quot;Send the report by email\&quot;\n\n&quot; +
                    &quot;Ready to complete a full claims investigation? What would you like to start with?&quot;;
</code></pre>
<details class="note">
<summary>Complete Workflow</summary>
<p>Steps 1-10 demonstrate the complete claims investigation workflow from initial lookup through final report distribution. This mirrors the real-world process adjusters follow.</p>
</details>
<p><cc-end-step lab="baf5" exercise="4" step="1" /></p>
<h2 id="exercise-5-test-communication-features">Exercise 5: Test Communication Features</h2>
<p>Now let's test the complete communication capabilities!</p>
<h3 id="step-1-run-and-verify">Step 1: Run and Verify</h3>
<p>1️⃣ Press <strong>F5</strong> in VS Code to start debugging.</p>
<p>2️⃣ Select <strong>(Preview) Debug in Copilot (Edge)</strong> if prompted.</p>
<p>3️⃣ The terminal should show normal initialization (no new indexes to create).</p>
<p>4️⃣ A browser window will open with Microsoft 365 Copilot.</p>
<p><cc-end-step lab="baf5" exercise="5" step="1" /></p>
<h3 id="step-2-test-investigation-report-generation">Step 2: Test Investigation Report Generation</h3>
<p>1️⃣ In Microsoft 365 Copilot, say: </p>
<pre><code class="language-text">Generate investigation report for CLM-2025-001007
</code></pre>
<p>The agent should:</p>
<ul>
<li>Use <code>CommunicationPlugin.GenerateInvestigationReport</code></li>
<li>Gather comprehensive claim data from Knowledge Base</li>
<li>Include vision analysis findings (if photo was analyzed)</li>
<li>Include fraud risk assessment</li>
<li>Format professional markdown report</li>
<li>Return structured report with recommendations</li>
</ul>
<p><strong>Expected Response:</strong></p>
<pre><code>📊 Generating investigation report for CLM-2025-001007...

# 📋 Investigation Report: CLM-2025-001007
**Generated:** 2025-01-15 10:30:00 UTC
**Status:** Investigation Complete

[Comprehensive claim details including:]
- Claim overview
- Vision analysis findings
- Fraud risk assessment
- Documentation review
- Recommendations

**Report Prepared By:** Zava Insurance Claims Investigation System
**Next Steps:** Review findings and proceed with recommended claim resolution action.
</code></pre>
<div class="admonition warning">
<p class="admonition-title">OBO Token Configuration Error</p>
<p>If you receive the following error message after sending a message to the agent:</p>
<p><code>Sign in for 'me' completed without a token. Status=Exception/OBO for 'BotServiceConnection' is not setup for exchangeable tokens. For Token Service handlers, the 'Scopes' field on the Azure Bot OAuth Connection should be in the format of 'api://{appid_uri}/{scopeName}'.</code></p>
<p>Follow these steps to fix it:</p>
<ol>
<li>Go to <strong>Azure Portal</strong> and find your <strong>Resource Group</strong> containing your <strong>Azure Bot</strong></li>
<li>Open the Azure Bot resource and go to the <strong>Configuration</strong> tab</li>
<li>Click on the <strong>Microsoft Graph</strong> Azure Active Directory v2 service provider</li>
<li><strong>Take note</strong> of the existing <strong>Token Exchange URL</strong> and <strong>Scopes</strong> values (you'll need them later)</li>
<li>Replace the <strong>Token Exchange URL</strong> with: <code>https://graph.microsoft.com</code></li>
<li>Replace the <strong>Scopes</strong> with: <code>email openid profile User.Read Mail.Send</code></li>
<li><strong>Save</strong> the changes</li>
<li>Select the <strong>Microsoft Graph</strong> service provider again and click <strong>Test Connection</strong></li>
<li><strong>Grant all consent</strong> when prompted</li>
<li>Go back to the configuration and <strong>restore</strong> the original <strong>Token Exchange URL</strong> and <strong>Scopes</strong> values</li>
<li><strong>Save</strong> the changes again</li>
<li>Return to your agent, <strong>refresh the page</strong>, and test again</li>
</ol>
</div>
<p><cc-end-step lab="baf5" exercise="5" step="2" /></p>
<h3 id="step-3-test-email-functionality">Step 3: Test Email Functionality</h3>
<p>1️⃣ Try: </p>
<pre><code class="language-text">Send claim details for CLM-2025-001007 by email
</code></pre>
<p>The agent should:</p>
<ul>
<li>Retrieve claim details from Knowledge Base</li>
<li>Create HTML-formatted email</li>
<li>Send via Microsoft Graph API</li>
<li>Use your email as recipient (default)</li>
</ul>
<p><strong>Expected Response:</strong></p>
<pre><code>Retrieving details for claim CLM-2025-001007...
Preparing email for [your-email]@[domain].com...
Sending email via Microsoft Graph...
✅ Email sent successfully!

✅ Success: Claim details for CLM-2025-001007 have been successfully sent to [your-email]@[domain].com. 
The email includes comprehensive claim information, documentation status, timeline, and recommendations.
</code></pre>
<p>2️⃣ Check your email inbox - you should receive a professional HTML-formatted claim details email.</p>
<p>3️⃣ Try sending to a specific recipient: </p>
<pre><code class="language-text">Send claim details for CLM-2025-001001 to john.doe@contoso.com
</code></pre>
<p><cc-end-step lab="baf5" exercise="5" step="3" /></p>
<h3 id="step-4-test-complete-end-to-end-workflow">Step 4: Test Complete End-to-End Workflow</h3>
<p>Test the complete 10-step workflow from the welcome message:</p>
<pre><code>1. Get details for claim CLM-2025-001007
2. Check policy for this claim
3. What coverage does auto insurance include?
4. Analyze fraud risk for this claim
5. Show damage photo for this claim
6. Analyze this damage photo
7. What's the claims filing procedure?
8. Check compliance for this claim
9. Generate investigation report for claim CLM-2025-001007
10. Send the report by email
</code></pre>
<p>The agent should seamlessly use all plugins (ClaimsPlugin → PolicyPlugin → VisionPlugin → CommunicationPlugin) to complete the full investigation workflow!</p>
<p><cc-end-step lab="baf5" exercise="5" step="4" /></p>
<p><span style="font-size: large; font-weight: bold; color: #8d57c2;">CONGRATULATIONS!</span></p>
<p>You have completed Lab BAF5 - Add Communication Capabilities!</p>
<p>You've learned how to:</p>
<ul>
<li>✅ Create a CommunicationPlugin with email and report generation</li>
<li>✅ Integrate Microsoft Graph Mail API for sending professional emails</li>
<li>✅ Generate comprehensive investigation reports with aggregated data</li>
<li>✅ Update agent instructions to include communication workflows</li>
<li>✅ Test complete end-to-end claims investigation workflow</li>
</ul>
<p>Your Zava Insurance Agent is now a complete claims processing solution with:</p>
<ul>
<li><strong>Search</strong>: Claims and policies via Azure AI Search</li>
<li><strong>Analysis</strong>: AI vision with Mistral for damage assessment</li>
<li><strong>Validation</strong>: SharePoint policy document search</li>
<li><strong>Communication</strong>: Email reports and investigation summaries</li>
</ul>
<p>🎉 <strong>Congratulations!</strong> You've built a production-ready AI agent! 🎊</p>
<p><cc-next url="../06-add-copilot-api" /></p>
<p><img src="https://m365-visitor-stats.azurewebsites.net/copilot-camp/custom-engine/agent-framework/05-add-communication" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "toc.integrate", "content.code.copy"], "search": "../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../../javascripts/cc-award.js"></script>
      
        <script src="../../../../javascripts/cc-next.js"></script>
      
        <script src="../../../../javascripts/cc-lab-step.js"></script>
      
        <script src="../../../../javascripts/cc-card.js"></script>
      
    
  </body>
</html>