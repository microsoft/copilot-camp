
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://microsoft.github.io/copilot-camp/pages/custom-engine/agent-framework/07-add-mcp-tools/">
      
      
        <link rel="prev" href="../06-add-copilot-api/">
      
      
        <link rel="next" href="../../../beyond-agents/">
      
      
        
          <link rel="alternate" href="./" hreflang="en">
        
          <link rel="alternate" href="../../../../ja/pages/custom-engine/agent-framework/07-add-mcp-tools/" hreflang="ja">
        
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Lab BAF7 - Add MCP Tools Integration - Copilot Developer Camp</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/labStyles.css">
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lab-baf7-add-mcp-tools-integration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Copilot Developer Camp" class="md-header__button md-logo" aria-label="Copilot Developer Camp" data-md-component="logo">
      
  <img src="../../../../assets/images/tent-small.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Copilot Developer Camp
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lab BAF7 - Add MCP Tools Integration
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../../../ja/pages/custom-engine/agent-framework/07-add-mcp-tools/" hreflang="ja" class="md-select__link">
              Japanese (日本語)
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/microsoft/copilot-camp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/copilot-camp
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../make/" class="md-tabs__link">
          
  
  
  Maker Path - Make your agent

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../extend-m365-copilot/" class="md-tabs__link">
          
  
  
  Extend - Build a declarative agent

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  Build - Build a custom engine agent

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../beyond-agents/" class="md-tabs__link">
          
  
  
  Beyond Agents - AI concepts

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../resources/" class="md-tabs__link">
        
  
  
    
  
  Resources

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Copilot Developer Camp" class="md-nav__button md-logo" aria-label="Copilot Developer Camp" data-md-component="logo">
      
  <img src="../../../../assets/images/tent-small.png" alt="logo">

    </a>
    Copilot Developer Camp
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/microsoft/copilot-camp" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/copilot-camp
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Maker Path - Make your agent
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Maker Path - Make your agent
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/agent-builder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MAB - Copilot Studio lite
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/agent-builder/01-first-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MAB1 - Copilot Studio Lite
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS - Microsoft Copilot Studio
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/00-prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS0 - Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/01-first-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS1 - First agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/02-topics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS2 - Defining Topics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/03-actions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS3 - Defining Tools
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/04-extending-m365-copilot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS4 - Extending Microsoft 365 Copilot
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/05-connectors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS5 - Consuming a custom connector
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/06-mcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS6 - Consuming an MCP server
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/07-autonomous/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS7 - Creating Autonomous Agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/08-rag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS8 - Integrating Azure AI Search for RAG
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/09-connected-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS9 - Connected Agents (Preview)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/sharepoint-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MSA - SharePoint agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/sharepoint-agents/01-first-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MSA1 - Build your first SharePoint agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/sharepoint-agents/02-sharing-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MSA2 - Sharing SharePoint agents
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Extend - Build a declarative agent
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Extend - Build a declarative agent
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Setup
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Setup
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/00-prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E0 - Prerequisites and Environment Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Declarative Agent Fundamentals
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Declarative Agent Fundamentals
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/01-typespec-declarative-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E1 - Build a Declarative Agent using TypeSpec
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/01a-geolocator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E1a - Build a game agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Build and Integrate API from scratch
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Build and Integrate API from scratch
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/02-build-the-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E2 - Build a Backend API
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/03-add-declarative-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E3 - Add Declarative Agent and API Plugin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/04-enhance-api-plugin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E4 - Enhance API and Plugin
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/05-add-adaptive-card/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E5 - Add Adaptive Cards
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/06a-add-authentication-ttk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E6a - Add Entra ID Authentication (Toolkit)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Integration
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Integration
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/07-add-graphconnector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E7 - Add Copilot Connector
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/08-mcp-server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E8 - Connect Declarative agent to MCP Server (Preview)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/09-connected-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E9 - Connected Agents using VS Code (Preview)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Build - Build a custom engine agent
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Build - Build a custom engine agent
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Welcome
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Start with Microsoft Foundry
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Start with Microsoft Foundry
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/00-prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BMA0 - Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/01-agent-in-foundry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BMA1 - Prepare your agent in Microsoft Foundry
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/02-agent-with-agents-sdk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BMA2 - Build your first agent using M365 Agents SDK
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/03-agent-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BMA3 - Configure agent properties and test on Teams
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/04-bring-agent-to-copilot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BMA4 - Bring your agent to Copilot Chat
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Start with Agent Framework
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Start with Agent Framework
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../00-prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BAF0 - Prerequisites
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-build-and-run/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BAF1 - Build and Run Your First Agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-add-claim-search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BAF2 - Add Document Search with Azure AI Search
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-add-vision-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BAF3 - Add Vision Analysis with Mistral AI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-add-policy-search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BAF4 - Add Policy Search
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-add-communication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BAF5 - Add Communication Capabilities
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-add-copilot-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BAF6 - Add Microsoft 365 Work IQ API Integration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Lab BAF7 - Add MCP Tools Integration
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab BAF7 - Add MCP Tools Integration
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-1-create-the-mcp-server-with-azure-functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 1: Create the MCP Server with Azure Functions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-2-configure-mcp-client-in-the-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 2: Configure MCP Client in the Agent
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-3-create-the-claimsadjustersplugin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 3: Create the ClaimsAdjustersPlugin
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-4-register-claimsadjustersplugin-in-agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 4: Register ClaimsAdjustersPlugin in Agent
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-5-test-mcp-tools-integration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 5: Test MCP Tools Integration
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Beyond Agents - AI concepts
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Beyond Agents - AI concepts
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../beyond-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../beyond-agents/beginner-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Level 1 - Simple agent instructions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Resources
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="lab-baf7-add-mcp-tools-integration">Lab BAF7 - Add MCP Tools Integration</h1>
<p>In this lab, you'll extend your Zava Insurance Agent with Model Context Protocol (MCP) tools. You'll create an MCP server using Azure Functions that provides claims adjuster management capabilities, then consume those tools from a custom plugin in your Custom Engine Agent.</p>
<details class="info" open="open">
<summary>Understanding MCP Integration</summary>
<p>The <strong>Model Context Protocol (MCP)</strong> enables your agent to:</p>
<ul>
<li><strong>Connect to External Tools</strong>: Use standardized protocol to access tools from MCP servers</li>
<li><strong>Manage Claims Adjusters</strong>: List adjusters by area of expertise and country</li>
<li><strong>Assign Adjusters to Claims</strong>: Automatically assign the right adjuster based on claim type</li>
<li><strong>Leverage Azure Functions</strong>: Host MCP tools as serverless functions for scalability</li>
</ul>
<p>This integration demonstrates how to extend your agent's capabilities using the MCP ecosystem.</p>
</details>
<hr />

<h2 id="overview">Overview</h2>
<p>In previous labs, you added claims search, vision analysis, policy search, and communication capabilities. Now you'll extend your agent with MCP tools to manage claims adjusters - a common requirement in insurance workflows where claims need to be routed to specialized adjusters based on claim type and location.</p>
<p>The <strong>Model Context Protocol (MCP)</strong> is an open standard that enables AI applications to connect to external data sources and tools. By creating an MCP server with Azure Functions, you can expose business logic as tools that any MCP-compatible agent can consume.</p>
<details class="note" open="open">
<summary>What You'll Build</summary>
<ul>
<li><strong>MCP Server</strong>: An Azure Function app that exposes claims adjuster tools via MCP</li>
<li><strong>ClaimsAdjustersPlugin</strong>: A plugin that consumes MCP tools to list and assign adjusters</li>
<li><strong>Agent Integration</strong>: Wire up the plugin to enable adjuster management in conversations</li>
</ul>
</details>
<h2 id="exercise-1-create-the-mcp-server-with-azure-functions">Exercise 1: Create the MCP Server with Azure Functions</h2>
<details class="important">
<summary>Pre-defined MCP server</summary>
<p>If you don't want to create the MCP server from scratch, you can skip Exercise 1, download a pre-defined one from folder /<code>src/agent-framework/insurance-mcp</code>, configure the <code>env/.env.local</code> and the <code>env/.env.local.user</code> files, and run it pressing F5 in Visual Studio Code. If that is the case, you can move straight to Exercise 2.</p>
</details>
<p>First, let's create an Azure Function app that serves as your MCP server, exposing claims adjuster management tools.</p>
<h3 id="step-1-understand-the-mcp-server-architecture">Step 1: Understand the MCP Server Architecture</h3>
<details class="note">
<summary>How MCP Server Works</summary>
<p>The MCP server exposes tools that can be called by MCP clients. Each tool has:</p>
<ul>
<li><strong>Tool Name</strong>: Unique identifier (e.g., <code>get_claims_adjusters</code>)</li>
<li><strong>Description</strong>: Helps the LLM understand when to use the tool</li>
<li><strong>Properties</strong>: Input parameters with types and descriptions</li>
<li><strong>Handler</strong>: Function that executes when the tool is called</li>
</ul>
<p>Azure Functions provides a convenient hosting model for MCP servers, with built-in support for the MCP protocol via the native MCP protocol binding.</p>
</details>
<p>The MCP server architecture consists of:</p>
<ol>
<li><strong>Data Storage</strong>: Azure Table Storage for claims adjuster records</li>
<li><strong>HTTP Handlers</strong>: REST endpoints for direct API access</li>
<li><strong>MCP Tool Handlers</strong>: Functions registered as MCP tools for agent consumption</li>
</ol>
<p><cc-end-step lab="baf7" exercise="1" step="1" /></p>
<h3 id="step-2-create-the-azure-function-project">Step 2: Create the Azure Function Project</h3>
<p>1️⃣ Open a terminal in VSCode and create a new folder for your MCP server under your project:</p>
<pre><code class="language-bash">mkdir InsuranceMCPServer
cd InsuranceMCPServer
</code></pre>
<p>2️⃣ Initialize a new Azure Functions project with TypeScript:</p>
<pre><code class="language-bash">func init --typescript
</code></pre>
<p>3️⃣ Install the required dependencies:</p>
<pre><code class="language-bash">npm install @azure/data-tables dotenv
npm install --save-dev @types/node
</code></pre>
<p>4️⃣ Create the environment configuration file <code>env/.env.local</code> under your InsuranceMCPServer and fill in your Azure Table Storage details:</p>
<pre><code class="language-bash">AZURE_STORAGE_ACCOUNT=your_storage_account
AZURE_TABLE_ENDPOINT=https://your_storage_account.table.core.windows.net
TABLE_NAME=ClaimsAdjusters
ALLOW_INSECURE_CONNECTION=false
</code></pre>
<p>5️⃣ Create the environment configuration file <code>env/.env.local.user</code> under your InsuranceMCPServer and fill in your Azure Storage account key:</p>
<pre><code class="language-bash">SECRET_AZURE_STORAGE_KEY=your_storage_key
</code></pre>
<p><cc-end-step lab="baf7" exercise="1" step="2" /></p>
<h3 id="step-3-create-the-claims-adjusters-function">Step 3: Create the Claims Adjusters Function</h3>
<p>Create a new file <code>src/functions/ClaimsAdjusters.ts</code> with the MCP tool implementations:</p>
<pre><code class="language-typescript">import { app, HttpRequest, HttpResponseInit, InvocationContext } from &quot;@azure/functions&quot;;
import { TableClient, AzureNamedKeyCredential } from &quot;@azure/data-tables&quot;;
import * as dotenv from &quot;dotenv&quot;;
import * as path from &quot;path&quot;;
import * as fs from &quot;fs&quot;;

// Load environment variables (.env.local.user takes precedence over .env.local)
const envLocalFile = path.join(__dirname, &quot;../../../env/.env.local&quot;);
const envLocalUserFile = path.join(__dirname, &quot;../../../env/.env.local.user&quot;);

// Load .env.local first, then .env.local.user (later values override earlier ones)
dotenv.config({ path: envLocalFile });
if (fs.existsSync(envLocalUserFile)) {
    dotenv.config({ path: envLocalUserFile, override: true });
}

interface ClaimAdjuster {
    id: string;
    firstName: string;
    lastName: string;
    email: string;
    phone: string;
    country: string;
    area: string;
}

// Initialize Table Storage client
function getTableClient(): TableClient {
    const account = process.env.AZURE_STORAGE_ACCOUNT;
    const accountKey = process.env.SECRET_AZURE_STORAGE_KEY;
    const tableEndpoint = process.env.AZURE_TABLE_ENDPOINT;
    const tableName = process.env.TABLE_NAME;
    const allowInsecure = process.env.ALLOW_INSECURE_CONNECTION === &quot;true&quot;;

    if (!account || !accountKey || !tableEndpoint || !tableName) {
        throw new Error(&quot;Missing required environment variables. Please check your env/.env file.&quot;);
    }

    const credential = new AzureNamedKeyCredential(account, accountKey);
    return new TableClient(tableEndpoint, tableName, credential, {
        allowInsecureConnection: allowInsecure
    });
}

// Load claims adjusters data from Table Storage
async function loadClaimsAdjusters(): Promise&lt;ClaimAdjuster[]&gt; {
    const tableClient = getTableClient();
    const adjusters: ClaimAdjuster[] = [];

    const entities = tableClient.listEntities({
        queryOptions: { filter: `PartitionKey eq 'ClaimsAdjusters'` }
    });

    for await (const entity of entities) {
        adjusters.push({
            id: entity.rowKey as string,
            firstName: entity.firstName as string,
            lastName: entity.lastName as string,
            email: entity.email as string,
            phone: entity.phone as string,
            country: entity.country as string,
            area: entity.area as string
        });
    }

    return adjusters;
}

// Internal implementation: List claims adjusters with optional filters
async function listClaimsAdjustersImpl(country?: string, area?: string): Promise&lt;ClaimAdjuster[]&gt; {
    let adjusters = await loadClaimsAdjusters();

    // Apply filters
    if (country) {
        adjusters = adjusters.filter(adj =&gt; adj.country.toLowerCase() === country.toLowerCase());
    }

    if (area) {
        adjusters = adjusters.filter(adj =&gt; adj.area.toLowerCase() === area.toLowerCase());
    }

    return adjusters;
}

// Internal implementation: Get claim adjuster by ID
async function getClaimAdjusterByIdImpl(id: string): Promise&lt;ClaimAdjuster | null&gt; {
    const tableClient = getTableClient();

    try {
        const entity = await tableClient.getEntity(&quot;ClaimsAdjusters&quot;, id);
        const adjuster: ClaimAdjuster = {
            id: entity.rowKey as string,
            firstName: entity.firstName as string,
            lastName: entity.lastName as string,
            email: entity.email as string,
            phone: entity.phone as string,
            country: entity.country as string,
            area: entity.area as string
        };
        return adjuster;
    } catch (entityError: any) {
        if (entityError.statusCode === 404) {
            return null;
        }
        throw entityError;
    }
}

// Internal implementation: Assign a claim adjuster to a claim
async function assignClaimAdjusterImpl(claimId: string, adjusterId: string): Promise&lt;{
    success: boolean;
    assignmentId?: string;
    adjusterName?: string;
    error?: string;
}&gt; {
    if (!claimId || !adjusterId) {
        return {
            success: false,
            error: &quot;Both claimId and adjusterId are required&quot;
        };
    }

    // Verify adjuster exists
    const adjuster = await getClaimAdjusterByIdImpl(adjusterId);

    if (!adjuster) {
        return {
            success: false,
            error: `Claim adjuster with ID ${adjusterId} not found`
        };
    }

    // Generate fake assignment ID
    const currentYear = new Date().getFullYear();
    const randomNumber = Math.floor(Math.random() * 1000000).toString().padStart(6, '0');
    const assignmentId = `ASS-${currentYear}-${randomNumber}`;

    return {
        success: true,
        assignmentId: assignmentId,
        adjusterName: `${adjuster.firstName} ${adjuster.lastName}`
    };
}
</code></pre>
<p><cc-end-step lab="baf7" exercise="1" step="3" /></p>
<h3 id="step-4-register-mcp-tools">Step 4: Register MCP Tools</h3>
<p>Add the MCP tool registrations at the end of <code>src/functions/ClaimsAdjusters.ts</code>:</p>
<pre><code class="language-typescript">// MCP Tool Handler: List claims adjusters with optional filters
async function handleListClaimsAdjusters(input: any, context: InvocationContext): Promise&lt;ClaimAdjuster[] | { error: string }&gt; {
    context.log(`MCP: Listing claims adjusters with filters`);

    try {
        const country = input.arguments[&quot;country&quot;] || undefined;
        const area = input.arguments[&quot;area&quot;] || undefined;

        const adjusters = await listClaimsAdjustersImpl(country, area);
        return adjusters;
    } catch (error) {
        context.log('Error fetching claim adjusters:', error);
        return { error: (error as Error).message };
    }
}

// MCP Tool Handler: Get claim adjuster by ID
async function handleGetClaimsAdjusterById(input: any, context: InvocationContext): Promise&lt;ClaimAdjuster | { error: string }&gt; {
    context.log(`MCP: Getting claim adjuster by ID`);

    try {
        const id = input.arguments[&quot;id&quot;];

        if (!id) {
            return { error: &quot;Claim adjuster ID is required&quot; };
        }

        const adjuster = await getClaimAdjusterByIdImpl(id);

        if (!adjuster) {
            return { error: `Claim adjuster with ID ${id} not found` };
        }

        return adjuster;
    } catch (error) {
        context.log('Error fetching claim adjuster:', error);
        return { error: (error as Error).message };
    }
}

// MCP Tool Handler: Assign a claim adjuster to a claim
async function handleAssignClaimAdjuster(input: any, context: InvocationContext): Promise&lt;{ success: boolean; assignmentId?: string; adjusterName?: string; error?: string }&gt; {
    context.log(`MCP: Assigning claim adjuster to claim`);

    try {
        const claimId = input.arguments[&quot;claimId&quot;];
        const adjusterId = input.arguments[&quot;adjusterId&quot;];

        const result = await assignClaimAdjusterImpl(claimId, adjusterId);
        return result;
    } catch (error) {
        context.log('Error assigning claim adjuster:', error);
        return { success: false, error: (error as Error).message };
    }
}

// Register MCP tools
app.mcpTool(&quot;get_claims_adjusters&quot;, {
    toolName: &quot;get_claims_adjusters&quot;,
    description: &quot;Retrieve a list of all insurance claims adjusters&quot;,
    toolProperties: [
        {
            &quot;propertyName&quot;: &quot;country&quot;,
            &quot;propertyType&quot;: &quot;string&quot;,
            &quot;description&quot;: &quot;The country of the claim adjuster&quot;,
            &quot;isRequired&quot;: false
        },
        {
            &quot;propertyName&quot;: &quot;area&quot;,
            &quot;propertyType&quot;: &quot;string&quot;,
            &quot;description&quot;: &quot;The area of expertise of the claim adjuster&quot;,
            &quot;isRequired&quot;: false
        }
    ],
    handler: handleListClaimsAdjusters
});

app.mcpTool(&quot;get_claims_adjuster&quot;, {
    toolName: &quot;get_claims_adjuster&quot;,
    description: &quot;Retrieve a specific insurance claims adjuster by ID&quot;,
    toolProperties: [
        {
            &quot;propertyName&quot;: &quot;id&quot;,
            &quot;propertyType&quot;: &quot;string&quot;,
            &quot;description&quot;: &quot;The unique identifier of the claim adjuster&quot;,
            &quot;isRequired&quot;: true
        }
    ],
    handler: handleGetClaimsAdjusterById
});

app.mcpTool(&quot;assign_claim_adjuster&quot;, {
    toolName: &quot;assign_claim_adjuster&quot;,
    description: &quot;Assign a claim adjuster to an insurance claim&quot;,
    toolProperties: [
        {
            &quot;propertyName&quot;: &quot;claimId&quot;,
            &quot;propertyType&quot;: &quot;string&quot;,
            &quot;description&quot;: &quot;The unique identifier of the claim&quot;,
            &quot;isRequired&quot;: true
        },
        {
            &quot;propertyName&quot;: &quot;adjusterId&quot;,
            &quot;propertyType&quot;: &quot;string&quot;,
            &quot;description&quot;: &quot;The unique identifier of the claim adjuster to assign&quot;,
            &quot;isRequired&quot;: true
        }
    ],
    handler: handleAssignClaimAdjuster
});
</code></pre>
<details class="note">
<summary>MCP Tool Registration Pattern</summary>
<p>Each MCP tool is registered using <code>app.mcpTool()</code> with:</p>
<ul>
<li><strong>toolName</strong>: The identifier used when calling the tool</li>
<li><strong>description</strong>: Helps the LLM understand when to use this tool</li>
<li><strong>toolProperties</strong>: Array of input parameters with name, type, description, and required flag</li>
<li><strong>handler</strong>: The async function that executes the tool logic</li>
</ul>
</details>
<p><cc-end-step lab="baf7" exercise="1" step="4" /></p>
<h3 id="step-5-deploy-the-mcp-server">Step 5: Deploy the MCP Server</h3>
<p>1️⃣ Replace the placeholders in below script and run it in your terminal to create the Azure Function App in Azure:</p>
<pre><code class="language-bash">az functionapp create --name your-mcp-server --resource-group your-rg --consumption-plan-location eastus --runtime node --runtime-version 20 --functions-version 4 --storage-account your-storage
</code></pre>
<p>2️⃣ Deploy the function:</p>
<pre><code class="language-bash">func azure functionapp publish your-mcp-server
</code></pre>
<p>3️⃣ Note your MCP server endpoint URL (e.g., <code>https://your-mcp-server.azurewebsites.net/runtime/webhooks/mcp</code>)</p>
<details class="info">
<summary>MCP server local with devtunnel</summary>
<p>Instead of publishing the MCP server to Azure, you can keep it running locally and use <strong>Dev Tunnels</strong> to create a public URL:</p>
<p>1️⃣ Start your Azure Function locally:
<code>bash
func start</code></p>
<p>2️⃣ In a new terminal, create and host a dev tunnel:
<code>bash
devtunnel create --allow-anonymous
devtunnel port create -p 7071
devtunnel host</code></p>
<p>3️⃣ Copy the tunnel URL (e.g., <code>https://abc123.devtunnels.ms</code>) and use it to compose your MCP server endpoint:</p>
<p><code>text
https://abc123.devtunnels.ms/runtime/webhooks/mcp</code></p>
<p>This is useful for development and testing without deploying to Azure. The tunnel remains active as long as the <code>devtunnel host</code> command is running.</p>
</details>
<p><cc-end-step lab="baf7" exercise="1" step="5" /></p>
<h2 id="exercise-2-configure-mcp-client-in-the-agent">Exercise 2: Configure MCP Client in the Agent</h2>
<p>Now let's configure the Custom Engine Agent to connect to your MCP server.</p>
<h3 id="step-1-add-mcp-client-configuration">Step 1: Add MCP Client Configuration</h3>
<p>1️⃣ Open your <code>.env.local</code> file in the agent project.</p>
<p>2️⃣ Add the MCP server configuration:</p>
<pre><code class="language-bash"># MCP Server Configuration
MCP_SERVER_URL=https://your-mcp-server.azurewebsites.net/runtime/webhooks/mcp
</code></pre>
<p><cc-end-step lab="baf7" exercise="2" step="1" /></p>
<h3 id="step-2-register-mcp-client-in-dependency-injection">Step 2: Register MCP Client in Dependency Injection</h3>
<p>1️⃣ Open a new Terminal under your agent project root and install the ModelContextProtocol NuGet package by running the following script:</p>
<pre><code class="language-bash">dotnet add package ModelContextProtocol --version 0.4.1-preview.1
</code></pre>
<p>2️⃣ Open <code>src/Program.cs</code> in your agent project.</p>
<p>3️⃣ Add the required using statements at the top of the file:</p>
<pre><code class="language-csharp">using ModelContextProtocol.Client;
using ModelContextProtocol.Protocol;
</code></pre>
<p>4️⃣ Find where other services (VisionService, LanguageModelService etc.) are registered and add the MCP client registration:</p>
<pre><code class="language-csharp">// Register MCP Client for claims adjusters
builder.Services.AddSingleton&lt;McpClient&gt;(sp =&gt;
{
    var configuration = sp.GetRequiredService&lt;IConfiguration&gt;();
    var mcpServerUrl = configuration[&quot;MCP_SERVER_URL&quot;] 
        ?? throw new InvalidOperationException(&quot;MCP_SERVER_URL is not configured&quot;);

    var clientTransport = new HttpClientTransport(new HttpClientTransportOptions {
        Endpoint = new Uri(mcpServerUrl)});

    return McpClient.CreateAsync(clientTransport).GetAwaiter().GetResult();
});
</code></pre>
<p><cc-end-step lab="baf7" exercise="2" step="2" /></p>
<h2 id="exercise-3-create-the-claimsadjustersplugin">Exercise 3: Create the ClaimsAdjustersPlugin</h2>
<p>Now let's create the plugin that consumes MCP tools to manage claims adjusters.</p>
<h3 id="step-1-create-claimsadjustersplugin">Step 1: Create ClaimsAdjustersPlugin</h3>
<details class="note">
<summary>What this plugin does</summary>
<p>The <code>ClaimsAdjustersPlugin</code> provides two main capabilities:</p>
<p><strong>ListClaimsAdjustersAsync</strong>:</p>
<ul>
<li>Retrieves claims adjusters filtered by claim type and country</li>
<li>Validates claim types (only "Auto" and "Homeowners" supported)</li>
<li>Calls the MCP server's <code>get_claims_adjusters</code> tool</li>
</ul>
<p><strong>AssignClaimAdjusterAsync</strong>:</p>
<ul>
<li>Assigns a specific adjuster to a claim</li>
<li>Returns assignment confirmation with assignment ID</li>
<li>Calls the MCP server's <code>assign_claim_adjuster</code> tool</li>
</ul>
</details>
<p>1️⃣ Create a new file <code>src/Plugins/ClaimsAdjustersPlugin.cs</code> with the following implementation:</p>
<pre><code class="language-csharp">using Microsoft.Agents.Builder;
using Microsoft.Agents.Core.Models;
using System.ComponentModel;
using System.Text.Json;
using InsuranceAgent;
using Microsoft.Agents.Builder.State;
using ModelContextProtocol.Client;

namespace ZavaInsurance.Plugins
{
    /// &lt;summary&gt;
    /// Claims Adjusters Plugin for Zava Insurance
    /// Provides tools for managing and retrieving claims adjuster information via MCP.
    /// &lt;/summary&gt;
    public class ClaimsAdjustersPlugin
    {
        private readonly ITurnContext _turnContext;
        private readonly McpClient _mcpClient;
        private readonly IConfiguration _configuration;

        public ClaimsAdjustersPlugin(ITurnContext turnContext,
            McpClient mcpClient, 
            IConfiguration configuration)
        {
            _turnContext = turnContext ?? throw new ArgumentNullException(nameof(turnContext));
            _mcpClient = mcpClient ?? throw new ArgumentNullException(nameof(mcpClient));
            _configuration = configuration ?? throw new ArgumentNullException(nameof(configuration));
        }

        /// &lt;summary&gt;
        /// Retrieves claims adjusters based on claim type and country.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;claimType&quot;&gt;The claim type to filter claims adjusters (Auto or Homeowners)&lt;/param&gt;
        /// &lt;param name=&quot;country&quot;&gt;The country to filter claims adjusters&lt;/param&gt;
        /// &lt;returns&gt;A list of claims adjusters matching the criteria&lt;/returns&gt;
        [Description(&quot;Retrieves claims adjusters based on area and country&quot;)]
        public async Task&lt;string&gt; ListClaimsAdjustersAsync(string claimType, string country)
        {
            await NotifyUserAsync($&quot;Retrieving claims adjusters for area {claimType} and country {country}...&quot;);

            // Validate claim type - only &quot;Auto&quot; and &quot;Homeowners&quot; are supported
            if (claimType != &quot;Auto&quot; &amp;&amp; claimType != &quot;Homeowners&quot;)
            {
                claimType = null;
            }

            // Validate country
            if (country == &quot;All&quot;)
            {
                country = null;
            }

            var result = await _mcpClient.CallToolAsync(&quot;get_claims_adjusters&quot;, 
                new Dictionary&lt;string, object?&gt; {                 
                    [&quot;area&quot;] = claimType, 
                    [&quot;country&quot;] = country
                }
            );

            if (!result.IsError.HasValue || result.IsError.HasValue &amp;&amp; !result.IsError.Value)
            {
                var adjusters = result.Content;
                return JsonSerializer.Serialize(adjusters, new JsonSerializerOptions { WriteIndented = true });
            }
            else
            {
                return $&quot;Error retrieving claims adjusters!&quot;;
            }
        }

        /// &lt;summary&gt;
        /// Assigns a claims adjuster to a specific claim.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;claimId&quot;&gt;The ID of the claim&lt;/param&gt;
        /// &lt;param name=&quot;adjusterId&quot;&gt;The ID of the claims adjuster&lt;/param&gt;
        /// &lt;returns&gt;Confirmation message of assignment&lt;/returns&gt;
        [Description(&quot;Assigns a claims adjuster to a specific claim&quot;)]
        public async Task&lt;string&gt; AssignClaimAdjusterAsync(string claimId, string adjusterId)
        {
            await NotifyUserAsync($&quot;Assigning claims adjuster {adjusterId} to claim {claimId}...&quot;);

            var result = await _mcpClient.CallToolAsync(&quot;assign_claim_adjuster&quot;, 
                new Dictionary&lt;string, object?&gt; {                 
                    [&quot;claimId&quot;] = claimId, 
                    [&quot;adjusterId&quot;] = adjusterId
                }
            );

            if (!result.IsError.HasValue || result.IsError.HasValue &amp;&amp; !result.IsError.Value)
            {
                var adjusters = result.Content;
                return JsonSerializer.Serialize(adjusters, new JsonSerializerOptions { WriteIndented = true });
            }
            else
            {
                return $&quot;Error assigning claims adjuster!&quot;;
            }
        }

        private async Task NotifyUserAsync(string message)
        {
            if (!_turnContext.Activity.ChannelId.Channel!.Contains(Channels.Webchat))
            {
                await _turnContext.StreamingResponse.QueueInformativeUpdateAsync(message);
            }
            else
            {
                await _turnContext.StreamingResponse.QueueInformativeUpdateAsync(message).ConfigureAwait(false);
            }
        }
    }
}
</code></pre>
<p><cc-end-step lab="baf7" exercise="3" step="1" /></p>
<h2 id="exercise-4-register-claimsadjustersplugin-in-agent">Exercise 4: Register ClaimsAdjustersPlugin in Agent</h2>
<p>Now let's wire up the ClaimsAdjustersPlugin in your ZavaInsuranceAgent.</p>
<h3 id="step-1-update-agent-constructor">Step 1: Update Agent Constructor</h3>
<p>1️⃣ Open <code>src/Agent/ZavaInsuranceAgent.cs</code>.</p>
<p>2️⃣ Add the required using statement at the top of the file:</p>
<pre><code class="language-csharp">using ModelContextProtocol.Client;
</code></pre>
<p>3️⃣ Find the class fields section and add the MCP client field:</p>
<pre><code class="language-csharp">private readonly McpClient _mcpClient = null;
</code></pre>
<p>4️⃣ Update the constructor to accept and store the MCP client:</p>
<pre><code class="language-csharp">public ZavaInsuranceAgent(AgentApplicationOptions options, IChatClient chatClient, IConfiguration configuration, IServiceProvider serviceProvider, IHttpClientFactory httpClientFactory, McpClient mcpClient) : base(options)
{
    _chatClient = chatClient;
    _configuration = configuration;
    _serviceProvider = serviceProvider;
    _httpClient = httpClientFactory.CreateClient() ?? throw new ArgumentNullException(nameof(httpClientFactory));
    _mcpClient = mcpClient;

    // Greet when members are added to the conversation
    OnConversationUpdate(ConversationUpdateEvents.MembersAdded, WelcomeMessageAsync);

    // Listen for ANY message to be received
    OnActivity(ActivityTypes.Message, OnMessageAsync, autoSignInHandlers: [UserAuthorization.DefaultHandlerName]);
}
</code></pre>
<p><cc-end-step lab="baf7" exercise="4" step="1" /></p>
<h3 id="step-2-instantiate-claimsadjustersplugin">Step 2: Instantiate ClaimsAdjustersPlugin</h3>
<p>1️⃣ Find the <code>GetClientAgent</code> method (where other plugins are instantiated).</p>
<p>2️⃣ Add the ClaimsAdjustersPlugin instantiation after other plugins:</p>
<pre><code class="language-csharp">// Create ClaimsAdjustersPlugin with MCP client
ClaimsAdjustersPlugin claimsAdjustersPlugin = new(context, _mcpClient, _configuration);
</code></pre>
<p><cc-end-step lab="baf7" exercise="4" step="2" /></p>
<h3 id="step-3-register-claimsadjusters-tools">Step 3: Register ClaimsAdjusters Tools</h3>
<p>In the same <code>GetClientAgent</code> method, find where tools are added to <code>toolOptions.Tools</code> and add the claims adjusters tools:</p>
<pre><code class="language-csharp">// Register Claims Adjusters MCP tools
toolOptions.Tools.Add(AIFunctionFactory.Create(claimsAdjustersPlugin.ListClaimsAdjustersAsync));
toolOptions.Tools.Add(AIFunctionFactory.Create(claimsAdjustersPlugin.AssignClaimAdjusterAsync));
</code></pre>
<p><cc-end-step lab="baf7" exercise="4" step="3" /></p>
<h3 id="step-4-update-agent-instructions">Step 4: Update Agent Instructions</h3>
<p>Update the agent instructions to include claims adjuster capabilities.</p>
<p>1️⃣ Find the <code>AgentInstructions</code> field in <code>ZavaInsuranceAgent.cs</code>.</p>
<p>2️⃣ Add the claims adjuster tools to the instructions:</p>
<pre><code class="language-csharp">private readonly string AgentInstructions = &quot;&quot;&quot;
        You are a professional insurance claims assistant for Zava Insurance.

        Whenever the user starts a new conversation or provides a prompt to start a new conversation like &quot;start over&quot;, &quot;restart&quot;, 
        &quot;new conversation&quot;, &quot;what can you do?&quot;, &quot;how can you help me?&quot;, etc. use {{StartConversationPlugin.StartConversation}} and 
        provide to the user exactly the message you get back from the plugin.

        **Available Tools:**
        Use {{DateTimeFunctionTool.getDate}} to get the current date and time.
        For claims search, use {{ClaimsPlugin.SearchClaims}} and {{ClaimsPlugin.GetClaimDetails}}.
        For damage photo viewing, use {{VisionPlugin.ShowDamagePhoto}}.
        For AI vision damage analysis, use {{VisionPlugin.AnalyzeAndShowDamagePhoto}} and require approval via {{VisionPlugin.ApproveAnalysis}}.
        For policy search, use {{PolicyPlugin.SearchPolicies}} and {{PolicyPlugin.GetPolicyDetails}}.
        For sending investigation reports and claim details via email, use {{CommunicationPlugin.GenerateInvestigationReport}} and {{CommunicationPlugin.SendClaimDetailsByEmail}}.
        For claims compliance analysis, use {{ClaimsPoliciesPlugin.AnalyzeClaimCompliance}}.

        To list claim adjusters use {{ClaimsAdjustersPlugin.ListClaimsAdjusters}}. When listing claim adjusters:
        - Always try to use the country of the current claim, if any. Otherwise, if no country is specified by the user, set country value to 'All'.
        - Always try to use the claim type of the current claim, if any.
        - Always retrieve id, firstName, lastName, email, country, phone, and area for each claim adjuster.
        - Only &quot;Auto&quot; and &quot;Homeowners&quot; are valid claim types. If the user provides any other claim type, set area value to null.

        To assign a claim adjuster to a claim use {{ClaimsAdjustersPlugin.AssignClaimAdjuster}}.

        **IMPORTANT**: When user asks to &quot;check policy for this claim&quot;, first use GetClaimDetails to get the claim's policy number, then use GetPolicyDetails with that policy number.

        **IMPORTANT**: If in the response there are references to citations like [1], [2], etc., make sure to include those citations in the response so that M365 Copilot can render them properly.

        Stick to the scenario above and use only the information from the tools when answering questions.
        Be concise and professional in your responses.
        &quot;&quot;&quot;;
</code></pre>
<details class="note">
<summary>Why These Instructions Matter</summary>
<p>The instructions guide the LLM on how to use the claims adjuster tools effectively:</p>
<ul>
<li><strong>Country inference</strong>: Uses the claim's country when available</li>
<li><strong>Claim type validation</strong>: Only "Auto" and "Homeowners" are valid areas of expertise</li>
<li><strong>Contextual awareness</strong>: Leverages existing claim context to provide relevant adjusters</li>
</ul>
</details>
<p><cc-end-step lab="baf7" exercise="4" step="4" /></p>
<h2 id="exercise-5-test-mcp-tools-integration">Exercise 5: Test MCP Tools Integration</h2>
<p>Now let's test the complete MCP tools integration!</p>
<h3 id="step-1-run-and-verify">Step 1: Run and Verify</h3>
<p>1️⃣ Make sure your MCP server is running (locally or deployed to Azure).</p>
<p>2️⃣ Press <strong>F5</strong> in VS Code to start debugging your agent.</p>
<p>3️⃣ Select <strong>(Preview) Debug in Copilot (Edge)</strong> if prompted.</p>
<p>4️⃣ The terminal should show normal initialization.</p>
<p>5️⃣ A browser window will open with Microsoft 365 Copilot.</p>
<p><cc-end-step lab="baf7" exercise="5" step="1" /></p>
<h3 id="step-2-test-listing-claims-adjusters">Step 2: Test Listing Claims Adjusters</h3>
<p>1️⃣ In Microsoft 365 Copilot, first get a claim to establish context:</p>
<pre><code class="language-text">Get details for claim CLM-2025-001007
</code></pre>
<p>2️⃣ Then ask for adjusters:</p>
<pre><code class="language-text">List available claims adjusters for this claim
</code></pre>
<p>The agent should:</p>
<ul>
<li>Use the claim's type (Auto) and country from the claim details</li>
<li>Call the <code>get_claims_adjusters</code> MCP tool</li>
<li>Return a list of adjusters matching the criteria</li>
</ul>
<p><cc-end-step lab="baf7" exercise="5" step="2" /></p>
<h3 id="step-3-test-assigning-an-adjuster">Step 3: Test Assigning an Adjuster</h3>
<p>1️⃣ After getting the list of adjusters, assign one:</p>
<pre><code class="language-text">Assign adjuster ADJ-EE-0001 to this claim
</code></pre>
<p>The agent should:</p>
<ul>
<li>Call the <code>assign_claim_adjuster</code> MCP tool</li>
<li>Return confirmation with an assignment ID</li>
<li>Confirm the adjuster's name</li>
</ul>
<p><cc-end-step lab="baf7" exercise="5" step="3" /></p>
<h3 id="step-4-test-with-filters">Step 4: Test with Filters</h3>
<p>1️⃣ Test direct filtering:</p>
<pre><code class="language-text">Show me all Auto adjusters in the United States
</code></pre>
<p>The agent should filter adjusters by both area and country.</p>
<p>2️⃣ Test with "All" countries:</p>
<pre><code class="language-text">List all Homeowners adjusters
</code></pre>
<p>The agent should return all Homeowners adjusters regardless of country.</p>
<p><cc-end-step lab="baf7" exercise="5" step="4" /></p>
<div class="admonition success">
<p class="admonition-title">Congratulations!</p>
<p>You've successfully integrated MCP tools into your Custom Engine Agent! Your agent can now:</p>
<p>✅ Connect to external MCP servers<br />
✅ List claims adjusters with filtering by area and country<br />
✅ Assign adjusters to claims with confirmation<br />
✅ Use claim context to provide relevant adjuster suggestions</p>
<p>This pattern can be extended to integrate with any MCP-compatible service, enabling your agent to leverage a rich ecosystem of tools and capabilities.</p>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "toc.integrate", "content.code.copy"], "search": "../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../../javascripts/cc-award.js"></script>
      
        <script src="../../../../javascripts/cc-next.js"></script>
      
        <script src="../../../../javascripts/cc-lab-step.js"></script>
      
        <script src="../../../../javascripts/cc-card.js"></script>
      
    
  </body>
</html>