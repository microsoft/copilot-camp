---
search:
  exclude: true
---
# ãƒ©ãƒœ BTA5 - è¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã‚’å‡¦ç†ã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®è¿½åŠ 

ã“ã®ãƒ©ãƒœã§ã¯ã€æ¬¡ã®ã“ã¨ã‚’è¡Œã„ã¾ã™ã€‚

- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯ä½•ã‹ã€ãã—ã¦ãã‚Œã§è¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã‚’å‡¦ç†ã™ã‚‹æ–¹æ³•ã‚’å­¦ç¿’ã™ã‚‹  
- ã‚«ã‚¹ã‚¿ãƒ  ã‚¨ãƒ³ã‚¸ãƒ³ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ãƒãƒ«ãƒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’çµ±åˆã—ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‡¦ç†ã™ã‚‹  
- ã‚«ã‚¹ã‚¿ãƒ  ã‚¨ãƒ³ã‚¸ãƒ³ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã™ã‚‹  
- Microsoft Graph ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’çµ„ã¿åˆã‚ã›ã¦ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è‡ªå‹•åŒ–ã™ã‚‹  


<div class="lab-intro-video">
    <div style="flex: 1; min-width: 0;">
        <iframe  src="//www.youtube.com/embed/bfULaDnpAXY" frameborder="0" allowfullscreen style="width: 100%; aspect-ratio: 16/9;">          
        </iframe>
          <div>ã“ã®å‹•ç”»ã§ãƒ©ãƒœã®æ¦‚è¦ã‚’ç´ æ—©ãæŠŠæ¡ã—ã¾ã—ã‚‡ã†ã€‚</div>
    </div>
    <div style="flex: 1; min-width: 0;">
        ---8<--- "ja/b-labs-prelude.md"
    </div>
</div>

## ã¯ã˜ã‚ã«

ã„ã‚ˆã„ã‚ˆ Career Genie ã«è¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¾ã™ã€‚  
ã“ã®ãƒ©ãƒœã§ã¯ã€å€™è£œè€…ã®ãƒªã‚¹ãƒˆã‚’æ‰±ãˆã‚‹æ–°ã—ã„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ Career Genie ã®ãƒ­ã‚¸ãƒƒã‚¯ã«çµ±åˆã—ã¾ã™ã€‚ã¤ã¾ã‚Š Career Genie ã§å€™è£œè€…æ¤œç´¢ã‚’è¡Œã†éš›ã€å€™è£œè€…ç”¨ã®ãƒªã‚¹ãƒˆã‚’ä½œæˆã—ã¦åå‰ã‚’è¿½åŠ ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ä½œæˆãŒçµ‚ã‚ã£ãŸã‚‰ã€ãã®ãƒªã‚¹ãƒˆã‚’ HR ã«é€ä¿¡ã—ã¦é¢æ¥æ—¥ç¨‹ã‚’èª¿æ•´ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚  
ã“ã‚Œã‚‰ã¯ã™ã¹ã¦ã€ä»Šå› Career Genie ã«å®Ÿè£…ã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§å‡¦ç†ã•ã‚Œã¾ã™ã€‚ã•ã£ããå§‹ã‚ã¾ã—ã‚‡ã†ã€‚

???+ info "ã‚«ã‚¹ã‚¿ãƒ  ã‚¨ãƒ³ã‚¸ãƒ³ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ãŠã‘ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¨ã¯ï¼Ÿ"
    AI ã‚·ã‚¹ãƒ†ãƒ ã«ãŠã‘ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ã€ã‚³ãƒ¼ãƒ‰ã§ã„ã†ã¨ã“ã‚ã®åŸºæœ¬çš„ãªé–¢æ•°ã‚„ãƒ¡ã‚½ãƒƒãƒ‰ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›ã«åŸºã¥ãã€AI ãŒå®Ÿè¡Œã§ãã‚‹å…·ä½“çš„ãªã‚¿ã‚¹ã‚¯ã‚’è¡¨ã—ã¾ã™ã€‚AI ã‚·ã‚¹ãƒ†ãƒ ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¦æ±‚ã«å¿œã˜ã¦ã€ã©ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã‹ã‚’åˆ¤æ–­ã—ã¾ã™ã€‚

    ä¾‹ã¨ã—ã¦ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«ã¯æ¬¡ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚

    * æ–°ã—ã„ãƒªã‚¹ãƒˆã‚’ä½œæˆã™ã‚‹  
    * ãƒªã‚¹ãƒˆã‚’å‰Šé™¤ã™ã‚‹  
    * æ—¢å­˜ã®ãƒªã‚¹ãƒˆã«é …ç›®ã‚’è¿½åŠ ã™ã‚‹  
    * æ—¢å­˜ã®ãƒªã‚¹ãƒˆã‹ã‚‰é …ç›®ã‚’å‰Šé™¤ã™ã‚‹  

    ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ AI ã‚·ã‚¹ãƒ†ãƒ ã¨ã‚„ã‚Šå–ã‚Šã™ã‚‹ã¨ã€ã‚·ã‚¹ãƒ†ãƒ ã¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è§£é‡ˆã—ã¦é©åˆ‡ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—å®Ÿè¡Œã—ã¾ã™ã€‚å·¥å…·ç®±ã«ã‚ã‚‹ãƒ„ãƒ¼ãƒ«ã‚’ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‹ãƒ¼ã‚ºã«åˆã‚ã›ã¦ AI ãŒä½¿ã„åˆ†ã‘ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚

## æ¼”ç¿’ 1: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”¨ã®æ–°ã—ã„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½œæˆã™ã‚‹

ã“ã®æ¼”ç¿’ã§ã¯ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã®æ–°ã—ã„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ "prompts" ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã«ä½œæˆã—ã¾ã™ã€‚

### ã‚¹ãƒ†ãƒƒãƒ— 1: "monologue" ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½œæˆã™ã‚‹

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ `src/prompts/` ã«ç§»å‹•ã—ã€**monologue** ã¨ã„ã†åå‰ã®ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã‚’è¿½åŠ ã—ã¾ã™ã€‚  
`src/prompts/monologue/` ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã« **config.json** ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€æ¬¡ã®ã‚³ãƒ¼ãƒ‰ ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¾ã™ã€‚

```json
{
  "schema": 1.1,
  "description": "A bot that can chat with users",
  "type": "completion",
  "completion": {
    "completion_type": "chat",
    "include_history": true,
    "include_input": true,
    "max_input_tokens": 2800,
    "max_tokens": 1000,
    "temperature": 0.9,
    "top_p": 0.0,
    "presence_penalty": 0.6,
    "frequency_penalty": 0.0
  },
  "augmentation": {
      "augmentation_type": "monologue"
  }
}
```

!!! tip "`config.json` ã® `augmentation` ã«ã¤ã„ã¦"
    Augmentation ã¯ã€ç‰¹å®šã®æŒ‡ç¤ºã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«è‡ªå‹•ã§è¿½åŠ ã—ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ã‚’ç°¡ç´ åŒ–ã—ã¾ã™ã€‚augmentation ã«ã‚ˆã‚Šã€AI ã«ãƒãƒ«ãƒã‚¹ãƒ†ãƒƒãƒ— ã‚¿ã‚¹ã‚¯ï¼ˆsequenceï¼‰ã‚’æ‰±ã‚ã›ã‚‹ã‹ã€å„ã‚¹ãƒ†ãƒƒãƒ—ã‚’é †ã«è€ƒãˆã•ã›ã‚‹ï¼ˆmonologueï¼‰ã‹ã‚’è¨­å®šã§ãã¾ã™ã€‚

`src/prompts/monologue/` ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã« **skprompt.txt** ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€æ¬¡ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¾ã™ã€‚

```
You are a career specialist named "Career Genie" that helps Human Resources team who can manage lists of Candidates. 
You are friendly and professional. You like using emojis where appropriate.
Always share the lists in bullet points.

rules:
- only create lists the user has explicitly asked to create.
- only add Candidates to a list that the user has asked to have added.
- if multiple lists are being manipulated, call a separate action for each list.
- if Candidates are being added and removed from a list, call a separate action for each operation.
- if user asks for a summary, share all the lists and candidates. 
- only send an email to HR if user has explicitly asked to send.

Current lists:
{{$conversation.lists}}
```

åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã« **actions.json** ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€æ¬¡ã®ã‚³ãƒ¼ãƒ‰ ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’è²¼ã‚Šä»˜ã‘ã¾ã™ã€‚

```json
[
    {
        "name": "createList",
        "description": "Creates a new list with an optional set of initial Candidates",
        "parameters": {
            "type": "object",
            "properties": {
                "list": {
                    "type": "string",
                    "description": "The name of the list to create"
                },
                "Candidates": {
                    "type": "array",
                    "description": "The Candidates to add to the list",
                    "Candidates": {
                        "type": "string"
                    }
                }
            },
            "required": [
                "list"
            ]
        }
    },
    {
        "name": "deleteList",
        "description": "Deletes a list",
        "parameters": {
            "type": "object",
            "properties": {
                "list": {
                    "type": "string",
                    "description": "The name of the list to delete"
                }
            },
            "required": [
                "list"
            ]
        }
    },
    {
        "name": "addCandidates",
        "description": "Adds one or more Candidates to a list",
        "parameters": {
            "type": "object",
            "properties": {
                "list": {
                    "type": "string",
                    "description": "The name of the list to add the item to"
                },
                "Candidates": {
                    "type": "array",
                    "description": "The Candidates to add to the list",
                    "Candidates": {
                        "type": "string"
                    }
                }
            },
            "required": [
                "list",
                "Candidates"
            ]
        }
    },
    {
        "name": "removeCandidates",
        "description": "Removes one or more Candidates from a list",
        "parameters": {
            "type": "object",
            "properties": {
                "list": {
                    "type": "string",
                    "description": "The name of the list to remove the item from"
                },
                "Candidates": {
                    "type": "array",
                    "description": "The Candidates to remove from the list",
                    "Candidates": {
                        "type": "string"
                    }
                }
            },
            "required": [
                "list",
                "Candidates"
            ]
        }
    }
]
```

<cc-end-step lab="bta5" exercise="1" step="1" />

## æ¼”ç¿’ 2: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’é¸æŠã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ã«å®Ÿè£…ã™ã‚‹

ã“ã®æ¼”ç¿’ã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç¢ºèªã—ã€"chat" ã¨ "monologue" ã®ã©ã¡ã‚‰ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½¿ã†ã‹ã‚’åˆ¤æ–­ã™ã‚‹é–¢æ•°ã‚’ä½œæˆã—ã¾ã™ã€‚

### ã‚¹ãƒ†ãƒƒãƒ— 1: ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ã« `defaultPrompt` ç”¨é–¢æ•°ã‚’ä½œæˆã™ã‚‹

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® `src/app/app.ts` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ãã€æ¬¡ã®é–¢æ•°ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```javascript
async function choosePrompt(context){
  if (context.activity.text.includes('list')){
    const template = await prompts.getPrompt('monologue');
    return template;
  }
  else {
    const template = await prompts.getPrompt('chat');
    const skprompt = fs.readFileSync(path.join(__dirname, '..', 'prompts', 'chat', 'skprompt.txt'));

    const dataSources = (template.config.completion as any)['data_sources'];

    dataSources.forEach((dataSource: any) => {
      if (dataSource.type === 'azure_search') {
        dataSource.parameters.authentication.key = config.azureSearchKey;
        dataSource.parameters.endpoint = config.azureSearchEndpoint;
        dataSource.parameters.indexName = config.indexName;
        dataSource.parameters.embedding_dependency.deployment_name =
          config.azureOpenAIEmbeddingDeploymentName;
        dataSource.parameters.role_information = `${skprompt.toString('utf-8')}`;
      }
    });

    return template;
  }
}
```

!!! tip "`choosePrompt` é–¢æ•°ã‚’ç¢ºèª"
    `choosePrompt` é–¢æ•°ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã« "list" ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™ã€‚å«ã¾ã‚Œã¦ã„ã‚Œã° **monologue** ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¿”ã—ã€å«ã¾ã‚Œã¦ã„ãªã‘ã‚Œã°æ—¢å®šã® **chat** ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è¿”ã—ã¾ã™ã€‚

`src/app/app.ts` ãƒ•ã‚¡ã‚¤ãƒ«ã§ `planner` ã‚’æ¢ã—ã€**defaultPrompt** ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã„ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤ã—ã¾ã™ã€‚ãã®å¾Œã€`choosePrompt` é–¢æ•°ã‚’ **defaultPrompt** ã¨ã—ã¦è¨­å®šã—ã¾ã™ã€‚æœ€çµ‚çš„ãªãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```javascript
const planner = new ActionPlanner({
  model,
  prompts,
  defaultPrompt: choosePrompt,
});
```

<cc-end-step lab="bta5" exercise="2" step="1" />

## æ¼”ç¿’ 3: ã‚¢ãƒ—ãƒªã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã™ã‚‹

ã“ã®æ¼”ç¿’ã§ã¯ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”¨ã®é–¢æ•°ã‚’ä½œæˆã—ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ã‚¢ãƒ—ãƒªã«ç™»éŒ²ã—ã¾ã™ã€‚

### ã‚¹ãƒ†ãƒƒãƒ— 1: `ConversationState` ã‚’æ›´æ–°ã—ã€å„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã‚’å®šç¾©ã™ã‚‹

`src/app/app.ts` ã§ `@microsoft/teams-ai` ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ **DefaultConversationState** ã«æ›´æ–°ã—ã¾ã™ã€‚æœ€çµ‚çš„ãªã‚¤ãƒ³ãƒãƒ¼ãƒˆã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```javascript
import { AuthError, ActionPlanner, OpenAIModel, PromptManager, AI, PredictedSayCommand, Application, TurnState, DefaultConversationState } from "@microsoft/teams-ai";
```

`src/app/app.ts` ã§ **ConversationState** ã¨ **ApplicationTurnState** ã‚’è¦‹ã¤ã‘ã€æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã«ç½®ãæ›ãˆã¾ã™ã€‚

```javascript
// Strongly type the applications turn state
interface ConversationState extends DefaultConversationState {
  lists: Record<string, string[]>;
}
export type ApplicationTurnState = TurnState<ConversationState>;
```

`src/app/` ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã« **actions.ts** ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç”¨é–¢æ•°ã‚’å®šç¾©ã™ã‚‹ä»¥ä¸‹ã®ã‚½ãƒ¼ã‚¹ ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```javascript
import { ApplicationTurnState } from './app';

function getCandidates(state: ApplicationTurnState, list: string): string[] {
    ensureListExists(state, list);
    return state.conversation.lists[list];
}
  
function setCandidates(state: ApplicationTurnState, list: string, Candidates: string[]): void {
    ensureListExists(state, list);
    state.conversation.lists[list] = Candidates ?? [];
}

function ensureListExists(state: ApplicationTurnState, listName: string): void {
    if (typeof state.conversation.lists != 'object') {
        state.conversation.lists = {};
    }

    if (!Object.prototype.hasOwnProperty.call(state.conversation.lists, listName)) {
        state.conversation.lists[listName] = [];
    }
}
  
function deleteList(state: ApplicationTurnState, listName: string): void {
    if (
        typeof state.conversation.lists == 'object' &&
        Object.prototype.hasOwnProperty.call(state.conversation.lists, listName)
    ) {
        delete state.conversation.lists[listName];
    }
}

export { getCandidates, setCandidates, ensureListExists, deleteList };
```

<cc-end-step lab="bta5" exercise="3" step="1" />

### ã‚¹ãƒ†ãƒƒãƒ— 2: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ç™»éŒ²ã™ã‚‹

`src/app/app.ts` ã§æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ãƒ•ã‚¡ã‚¤ãƒ«å†’é ­ã«è¿½åŠ ã—ã¾ã™ã€‚

```javascript
import { ensureListExists, getCandidates, setCandidates, deleteList } from "./actions";
```

ç¶šã„ã¦ã€AI ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ç™»éŒ²ã™ã‚‹ãŸã‚ã€æ¬¡ã®ã‚³ãƒ¼ãƒ‰ ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’ `src/app/app.ts` ã«è¿½åŠ ã—ã¾ã™ã€‚

```javascript
// Register action handlers
interface ListOnly {
  list: string;
}

interface ListAndCandidates extends ListOnly {
  Candidates?: string[];
}

app.ai.action('createList', async (context: TurnContext, state: ApplicationTurnState, parameters: ListAndCandidates) => {
  ensureListExists(state, parameters.list);
  if (Array.isArray(parameters.Candidates) && parameters.Candidates.length > 0) {
      await app.ai.doAction(context, state, 'addCandidates', parameters);
      return `List created and Candidates added. Summarize your action.`;
  } else {
      return `List created. Summarize your action.`;
  }
});

app.ai.action('deleteList', async (context: TurnContext, state: ApplicationTurnState, parameters: ListOnly) => {
  deleteList(state, parameters.list);
  return `list deleted. Summarize your action.`;
});

app.ai.action('addCandidates', async (context: TurnContext, state: ApplicationTurnState, parameters: ListAndCandidates) => {
  const Candidates = getCandidates(state, parameters.list);
  Candidates.push(...(parameters.Candidates ?? []));
  setCandidates(state, parameters.list, Candidates);
  return `Candidates added. Summarize your action.`;
});

app.ai.action('removeCandidates', async (context: TurnContext, state: ApplicationTurnState, parameters: ListAndCandidates) => {
  const Candidates = getCandidates(state, parameters.list);
  (parameters.Candidates ?? []).forEach((candidate: string) => {
      const index = Candidates.indexOf(candidate);
      if (index >= 0) {
          Candidates.splice(index, 1);
      }
  });
  setCandidates(state, parameters.list, Candidates);
  return `Candidates removed. Summarize your action.`;
});

```

<cc-end-step lab="bta5" exercise="3" step="2" />

### ã‚¹ãƒ†ãƒƒãƒ— 3: æ–°ã—ã„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚¢ãƒ—ãƒªã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹

Visual Studio Code ã® **Run and Debug** ã‚¿ãƒ–ã‹ã‚‰ **Debug in Teams (Edge)** ã‚‚ã—ãã¯ **Debug in Teams (Chrome)** ã‚’é¸æŠã—ã€ã‚¢ãƒ—ãƒªã®ãƒ‡ãƒãƒƒã‚°ã‚’é–‹å§‹ã—ã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã§ Microsoft Teams ãŒèµ·å‹•ã—ã¾ã™ã€‚ã‚¢ãƒ—ãƒªã®è©³ç´°ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ **Add** ã‚’é¸æŠã—ã€ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹ã—ã¾ã™ã€‚

!!! tip "ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ãƒ†ã‚¹ãƒˆ"
    Teams AI ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¸€éƒ¨æ©Ÿèƒ½ã¯ Teams App Test Tool ã§ã¯æ­£ã—ãå‹•ä½œã—ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã“ã®æ¼”ç¿’ã¯å¿…ãš Teams ä¸Šã§ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œãƒ»ãƒ‡ãƒãƒƒã‚°ã—ã¦ãã ã•ã„ã€‚

ãƒ•ãƒ­ãƒ¼ã‚’ç†è§£ã™ã‚‹ãŸã‚ã€æ¬¡ã®ã‚ˆã†ã«é †ç•ªã«è³ªå•ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

- Hello  
- Can you suggest candidates who have experience in .NET?  
- Great, add Isaac Talbot in the .NET Developer Candidates list  
- Add Anthony Ivanov in the same list with Isaac  
- Can you summarize my lists  
- Suggest candidates who have experience in Python and are able to speak Spanish  
- Nice! Add Sara Folgueroles in the Python Developer Candidates (Spanish speaking) list  
- Can you suggest candidates who have 10+ years of experience  
- Ok, remove Anthony from the .NET Developer Candidates list  
- Add Anthony Ivanov in the Talent list  
- Summarize my lists  

![Animation showing Career Genie in action accordingly to the dialog flow illustrated above, to search for candidates and add them to lists.](../../../assets/images/custom-engine-05/actions.gif)

<cc-end-step lab="bta5" exercise="3" step="3" />

## æ¼”ç¿’ 4: Microsoft Graph ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’çµ„ã¿åˆã‚ã›ã¦ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è‡ªå‹•åŒ–ã™ã‚‹

ã“ã®æ¼”ç¿’ã§ã¯ã€Microsoft Graph ã‚’åˆ©ç”¨ã—ã€å€™è£œè€…ãƒªã‚¹ãƒˆã‚’ HR ã«é€ä¿¡ã—ã¦é¢æ¥ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä¾é ¼ã™ã‚‹æ–°ã—ã„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

### ã‚¹ãƒ†ãƒƒãƒ— 1: ãƒ¡ãƒ¼ãƒ«é€ä¿¡ç”¨ã®æ–°ã—ã„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å®šç¾©ã™ã‚‹

`src/prompts/monologue/actions.json` ã‚’é–‹ãã€æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```json
,
{
    "name": "sendLists",
    "description": "Send list of Candidates to Human Resources, aka HR for scheduling interviews",
    "parameters": {
        "type": "object",
        "properties": {
            "list": {
                "type": "string",
                "description": "The name of the list to send Human Resources, aka HR for scheduling interviews"
            },
            "Candidates": {
                "type": "array",
                "description": "The Candidates in the list to send Human Resources, aka HR for scheduling interviews",
                "Candidates": {
                    "type": "string"
                }
            }
        },
        "required": [
            "list",
            "Candidates"
        ]
    }
}
```

<cc-end-step lab="bta5" exercise="4" step="1" />

### ã‚¹ãƒ†ãƒƒãƒ— 2: æ–°ã—ã„ `sendLists` ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®é–¢æ•°ã‚’ä½œæˆã™ã‚‹

`src/app/app.ts` ã‚’é–‹ãã€`getUserDisplayName` ã‚’è¦‹ã¤ã‘ã¦ **export** ã‚’è¿½åŠ ã—ã¾ã™ã€‚æœ€çµ‚å½¢ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚

```javascript
export async function getUserDisplayName {
...
...
...
}

```

`src/app/app.ts` ã® `app` ã‚’è¦‹ã¤ã‘ã€ã‚¹ã‚³ãƒ¼ãƒ—ã« **'Mail.Send'** ã‚’è¿½åŠ ã—ã¾ã™ã€‚æœ€çµ‚å½¢ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚

```javascript
const app = new Application({
  storage,
  authentication: {settings: {
    graph: {
      scopes: ['User.Read', 'Mail.Send'],
        ...
        ...
    }
  }}});
```

`env/.env.local.user` ã‚’é–‹ãã€ä»¥ä¸‹ã® HR ãƒ¡ãƒ¼ãƒ«ã‚’ç’°å¢ƒå¤‰æ•°ã¨ã—ã¦è¿½åŠ ã—ã¾ã™ã€‚

```
HR_EMAIL=<YOUR-EMAIL-ADDRESS>
```

!!! pied-piper "`HR_EMAIL` ã«ã¤ã„ã¦"
    ã“ã®ãƒ©ãƒœã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ãŸã‚ã€ã”è‡ªèº«ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ¡ãƒ¼ãƒ« ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ `HR_EMAIL` ã«å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚æœ¬æ¥ã¯ HR ãƒãƒ¼ãƒ ã®ãƒ¡ãƒ¼ãƒ« ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ç”¨ã—ã¦é¢æ¥ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã™ã€‚ã“ã®ãƒ©ãƒœã¯ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ç”¨é€”ã®ã¿ã§ã€æœ¬ç•ªç’°å¢ƒã§ã®ä½¿ç”¨ã‚’æƒ³å®šã—ã¦ã„ã¾ã›ã‚“ã€‚

`teamsapp.local.yml` ã‚’é–‹ãã€`file/createOrUpdateEnvironmentFile` ã® **envs** ãƒªã‚¹ãƒˆã«æ¬¡ã®è¡Œã‚’è¿½åŠ ã—ã¾ã™ã€‚

```
HR_EMAIL: ${{HR_EMAIL}}
```

`src/config.ts` ã‚’é–‹ãã€æ¬¡ã®è¡Œã‚’ config ã«è¿½åŠ ã—ã¾ã™ã€‚

```javascript
HR_EMAIL: process.env.HR_EMAIL
```

`src/app/actions.ts` ã‚’é–‹ãã€ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«æ›´æ–°ã—ã¾ã™ã€‚

```javascript
import { getUserDisplayName, ApplicationTurnState } from './app';
import { Client } from "@microsoft/microsoft-graph-client";
import config from '../config';
```

ç¶šã„ã¦ã€`actions.ts` ã«æ¬¡ã®é–¢æ•°ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```javascript
async function sendLists(state: ApplicationTurnState, token): Promise<string> {
    const email = await createEmailContent(state.conversation.lists, token);
    try {
        const client = Client.init({
            authProvider: (done) => {
                done(null, token);
            }
        });
        const sendEmail = await client.api('/me/sendMail').post(JSON.stringify(email));
        if (sendEmail.ok) {
            return email.message.body.content;
        }
        else {
            console.log(`Error ${sendEmail.status} calling Graph in sendToHR: ${sendEmail.statusText}`);
            return 'Error sending email';
        }
    } catch (error) {
        console.error('Error in sendLists:', error);
        throw error;
    }
}
   
async function createEmailContent(lists, token) {
    let emailContent = '';
    for (const listName in lists) {
        if (lists.hasOwnProperty(listName)) {
        emailContent += `${listName}:\n`;
        lists[listName].forEach(candidate => {
            emailContent += `  â€¢ ${candidate}\n`;
        });
        emailContent += '\n'; // Add an extra line between different lists
        }
    }

    const profileName = await getUserDisplayName(token);

    const email ={
        "message": {
        "subject": "Request to Schedule Interviews with Shortlisted Candidates",
        "body": {
            "contentType": "Text",
            "content": `Hello HR Team, \nI hope this email finds you well. \n\nCould you please assist in scheduling 1:1 interviews with the following shortlisted candidates? \n\n${emailContent} Please arrange suitable times and send out the calendar invites accordingly. \n\n Best Regards, \n ${profileName}`
        },
        "toRecipients": [
            {
            "emailAddress": {
                "address": `${config.HR_EMAIL}`
            }
            }
        ]
        },
        "saveToSentCandidates": "true"
    };
    return await email;
}
```

æœ€å¾Œã« `src/app/actions.ts` ã§ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã« **sendLists** ã‚’è¿½åŠ ã—ã¾ã™ã€‚æœ€çµ‚çš„ãªã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚

```javascript
export { getCandidates, setCandidates, ensureListExists, deleteList, sendLists };
```

<cc-end-step lab="bta5" exercise="4" step="2" />

### ã‚¹ãƒ†ãƒƒãƒ— 3: `sendLists` ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã‚’ç™»éŒ²ã™ã‚‹

`src/app/app.ts` ã‚’é–‹ãã€`./actions` ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’ **sendLists** ã‚’å«ã‚€ã‚ˆã†ã«æ›´æ–°ã—ã¾ã™ã€‚æœ€çµ‚å½¢ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚

```javascript
import { ensureListExists, getCandidates, setCandidates, deleteList, sendLists } from "./actions";
```

ç¶šã„ã¦ã€AI ã‚·ã‚¹ãƒ†ãƒ ã« `sendLists` ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ç™»éŒ²ã™ã‚‹ãŸã‚ã€æ¬¡ã®ã‚³ãƒ¼ãƒ‰ ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚

```javascript
app.ai.action('sendLists', async (context: TurnContext, state: ApplicationTurnState, parameters: ListAndCandidates) => {
  await sendLists(state, state.temp.authTokens['graph']);
  return `Email sent to HR. Summarize your action.`;
});
```

<cc-end-step lab="bta5" exercise="4" step="3" />

### ã‚¹ãƒ†ãƒƒãƒ— 4: Entra ID ã‚¢ãƒ—ãƒªç™»éŒ²ã‚’æ›´æ–°ã™ã‚‹

æ–°ã—ã„ã‚¹ã‚³ãƒ¼ãƒ— `Mail.Send` ç”¨ã« Entra ID ã‚¢ãƒ—ãƒªã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›´æ–°ã—ã¾ã™ã€‚  
**aad.manifest.json** ã‚’é–‹ãã€`requiredResourceAccess` ãƒãƒ¼ãƒ‰å†…ã®  
`  "resourceAppId": "Microsoft Graph",` ã‚’æ¢ã—ã¾ã™ã€‚  
`resourceAccess` é…åˆ—ã«ã€ã‚«ãƒ³ãƒã®å¾Œã§æ¬¡ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```JSON
 {
    "id": "Mail.Send",
    "type": "Scope"
}
```

<cc-end-step lab="bta5" exercise="4" step="4" />

### ã‚¹ãƒ†ãƒƒãƒ— 5: ã‚¢ãƒ—ãƒªã¨æ–°ã—ã„ `sendLists` ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹

Visual Studio Code ã® **Run and Debug** ã‚¿ãƒ–ã‹ã‚‰ **Debug in Teams (Edge)** ã¾ãŸã¯ **Debug in Teams (Chrome)** ã‚’é¸æŠã—ã€ã‚¢ãƒ—ãƒªã®ãƒ‡ãƒãƒƒã‚°ã‚’é–‹å§‹ã—ã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã§ Microsoft Teams ãŒèµ·å‹•ã—ã¾ã™ã€‚ã‚¢ãƒ—ãƒªã®è©³ç´°ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ **Add** ã‚’é¸æŠã—ã€ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹ã—ã¾ã™ã€‚

!!! tip "ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ãƒ†ã‚¹ãƒˆ"
    Teams AI ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¸€éƒ¨æ©Ÿèƒ½ã¯ Teams App Test Tool ã§ã¯æ­£ã—ãå‹•ä½œã—ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã“ã®æ¼”ç¿’ã¯å¿…ãš Teams ä¸Šã§ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œãƒ»ãƒ‡ãƒãƒƒã‚°ã—ã¦ãã ã•ã„ã€‚

Career Genie ã¨ä¼šè©±ã‚’å§‹ã‚ã‚‹ã«ã¯ã€å˜ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¾ã™ã€‚ãŸã¨ãˆã°ã€ŒHiã€ã¨é€ä¿¡ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

!!! tip "ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¨­å®šã‚’ç¢ºèª"
    ä»¥é™ã®æ‰‹é †ã‚’å††æ»‘ã«è¡Œã†ãŸã‚ã€ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚

è¿½åŠ ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã‚’æ±‚ã‚ã‚‹ãƒ€ã‚¤ã‚¢ãƒ­ã‚° ãƒœãƒƒã‚¯ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚**Continue** ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚

![The chat in Microsoft Teams shows a message asking the user to consent permissions to the app associated with the custom engine agent. There are a message, a 'Continue' button, and a 'Cancel' button.](../../../assets/images/custom-engine-04/consent-teams.png)

Developer Tunnels ã§ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œã—ã¦ã„ã‚‹ãŸã‚è­¦å‘Šç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ãŒã€**Continue** ã‚’é¸æŠã—ã¾ã™ã€‚ã‚¢ãƒ—ãƒªãŒå±•é–‹ã•ã‚Œã‚‹ã¨ãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚ãã®å¾Œã€ãƒ­ã‚°ã‚¤ãƒ³ã¨ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã®åŒæ„ã‚’è¡Œã„ã¾ã™ã€‚

!!! tip "çµ„ç¹”å…¨ä½“ã§åŒæ„ã™ã‚‹"
    Microsoft 365 ç®¡ç†è€…ã®å ´åˆã€ã€ŒConsent on behalf of your organizationã€ã‚’é¸æŠã—ã¦ãƒ†ãƒŠãƒ³ãƒˆå†…ã®ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾ã—ã¦åŒæ„ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

**Accept** ã‚’é¸æŠã—ã¦ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ã«åŒæ„ã—ã¾ã™ã€‚

Career Genie ã‹ã‚‰ã€ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ã¨ã‚‚ã«èªè¨¼æˆåŠŸã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå±Šãã¾ã™ã€‚ã“ã“ã‹ã‚‰æ–°ã—ã„ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼

ãƒ•ãƒ­ãƒ¼ã‚’ç†è§£ã™ã‚‹ãŸã‚ã€æ¬¡ã®ã‚ˆã†ã«é †ç•ªã«è³ªå•ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

- Hello  
- Can you suggest candidates who have experience in .NET?  
- Great, add Isaac Talbot in the .NET Developer Candidates list  
- Add Anthony Ivanov in the same list with Isaac  
- Can you summarize my lists  
- Suggest candidates who have experience in Python and are able to speak Spanish  
- Nice! Add Sara Folgueroles in the Python Developer Candidates (Spanish speaking) list  
- Can you suggest candidates who have 10+ years of experience  
- Ok, remove Anthony from the .NET Developer Candidates list  
- Add Anthony Ivanov in the Talent list  
- Summarize my lists  
- Add Pedro Armijo in the same list with Sara  
- Summarize my lists  
- Send my lists to HR  

!!! tip "ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã‚’ç¢ºèª"
    æœ€å¾Œã®ã‚¹ãƒ†ãƒƒãƒ—ãŒçµ‚ã‚ã£ãŸã‚‰ã€å€™è£œè€…ãƒªã‚¹ãƒˆã®ãƒ¡ãƒ¼ãƒ«ãŒå±Šã„ã¦ã„ã‚‹ã‹å—ä¿¡ãƒˆãƒ¬ã‚¤ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

![Animation showing the full experience of using Career Genie accordingly to the dialog flow illustrated above searching for candidates, adding them to lists, removing them from lists, and sending the lists of candidates by email to HR.](../../../assets/images/custom-engine-05/career-genie-full.gif)

<cc-end-step lab="bta5" exercise="4" step="5" />

---8<--- "ja/b-congratulations.md"

BTA5 - è¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã‚’å‡¦ç†ã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®è¿½åŠ  ã‚’å®Œäº†ã—ã¾ã—ãŸï¼  
ã•ã‚‰ã«å­¦ç¿’ã—ãŸã„å ´åˆã¯ã€ã“ã®ãƒ©ãƒœã®ã‚½ãƒ¼ã‚¹ ã‚³ãƒ¼ãƒ‰ãŒ [Copilot Developer Camp ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/microsoft/copilot-camp/tree/main/src/custom-engine-agent/Lab05-Actions/CareerGenie){target=_blank} ã«ã‚ã‚Šã¾ã™ã®ã§ã”è¦§ãã ã•ã„ã€‚

ã“ã‚Œã§ **Build your own agent** ã‚³ãƒ¼ã‚¹ã¯çµ‚äº†ã§ã™ã€‚Career Genie ã®æ§‹ç¯‰ã‚’ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã¾ã—ãŸã‹ï¼Ÿ ãœã²ä½“é¨“è«‡ã‚„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ãŠèã‹ã›ãã ã•ã„ ğŸ’œ

<cc-next label="Home" url="/" />

<!-- <cc-award path="Build" /> -->

<img src="https://m365-visitor-stats.azurewebsites.net/copilot-camp/custom-engine/teams-ai/05-actions" />