---
search:
  exclude: true
---
# ãƒ©ãƒœ BTA3 - ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã®å‘ä¸Š

ã“ã®ãƒ©ãƒœã§ã¯ Powered by AIã€ã¤ã¾ã‚Š Teams AI ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæä¾›ã™ã‚‹ä¸€é€£ã®æ©Ÿèƒ½ã«ã¤ã„ã¦å­¦ã³ã€ãã‚Œã‚‰ã‚’ã‚«ã‚¹ã‚¿ãƒ  ã‚¨ãƒ³ã‚¸ãƒ³ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«çµ„ã¿è¾¼ã‚“ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚

ã“ã®ãƒ©ãƒœã§è¡Œã†ã“ã¨:

- Powered by AI æ©Ÿèƒ½ã«ã¤ã„ã¦å­¦ç¿’ã™ã‚‹
- Feedback Loop ã‚’æœ‰åŠ¹åŒ–ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’åé›†ã™ã‚‹
- Adaptive Cards ã§å¼•ç”¨ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹
- Generated by AI ãƒ©ãƒ™ãƒ«ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹
- Sensitivity ãƒ©ãƒ™ãƒ«ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹

<div class="lab-intro-video">
    <div style="flex: 1; min-width: 0;">
        <iframe  src="//www.youtube.com/embed/J7IZULJsagM" frameborder="0" allowfullscreen style="width: 100%; aspect-ratio: 16/9;">          
        </iframe>
          <div>ã“ã®ãƒ“ãƒ‡ã‚ªã§ãƒ©ãƒœã®æ¦‚è¦ã‚’çŸ­æ™‚é–“ã§ç¢ºèªã§ãã¾ã™ã€‚</div>
    </div>
    <div style="flex: 1; min-width: 0;">
        ---8<--- "ja/b-labs-prelude.md"
    </div>
</div>

## ã¯ã˜ã‚ã«

???+ info "Powered by AI ã¨ã¯?"
    Powered by AI ã¨ã¯ã€Teams AI ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæä¾›ã™ã‚‹æ©Ÿèƒ½ç¾¤ã§ã€ã‚«ã‚¹ã‚¿ãƒ  ã‚¨ãƒ³ã‚¸ãƒ³ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã®å¯¾è©±ã‚’ã‚ˆã‚Šé­…åŠ›çš„ã‹ã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã«ã—ã¾ã™ã€‚ä¸»ãªæ©Ÿèƒ½ã¯æ¬¡ã®ã¨ãŠã‚Šã§ã™ã€‚

    * **Feedback Loop:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ AI å¿œç­”ã«å¯¾ã—ã¦ã‚µãƒ ã‚ºã‚¢ãƒƒãƒ—ã¾ãŸã¯ã‚µãƒ ã‚ºãƒ€ã‚¦ãƒ³ã§è©•ä¾¡ã§ãã¾ã™ã€‚ã“ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã¯ AI ã®ç²¾åº¦ã¨æœ‰ç”¨æ€§ã‚’ç¶™ç¶šçš„ã«å‘ä¸Šã•ã›ã¾ã™ã€‚  

    * **Citations:** AI ãŒæƒ…å ±æºã‚’å‚ç…§ã¨ã—ã¦æç¤ºã—ã€é€æ˜æ€§ã¨ä¿¡é ¼æ€§ã‚’ç¢ºä¿ã—ã¾ã™ã€‚  

    * **Generated by AI:** AI ã‚·ã‚¹ãƒ†ãƒ ãŒç”Ÿæˆã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã€ŒAI generatedã€ãƒ©ãƒ™ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ AI ã¨äººé–“ã«ã‚ˆã‚‹å¿œç­”ã‚’åŒºåˆ¥ã§ãã¾ã™ã€‚  

    * **Sensitivity Information:** å…±æœ‰ã™ã‚‹æƒ…å ±ãŒæ©Ÿå¯†æ€§ã‚’å«ã‚€å ´åˆã€æ„Ÿåº¦ãƒ©ãƒ™ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã€çµ„ç¹”å¤–ã«å…±æœ‰å¯èƒ½ã‹ã©ã†ã‹ã‚’ç¤ºã—ã¾ã™ã€‚  

å‰ã®æ¼”ç¿’ã§ã¯ Retrieval-Augmented Generation (RAG) ã¨ãã®ã‚«ã‚¹ã‚¿ãƒ  ã‚¨ãƒ³ã‚¸ãƒ³ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¸ã®çµ±åˆã‚’å­¦ç¿’ã—ã¾ã—ãŸã€‚æœ¬æ¼”ç¿’ã§ã¯ Powered by AI æ©Ÿèƒ½ã‚’æ´»ç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã‚’ã•ã‚‰ã«é«˜ã‚ã¾ã™ã€‚å®Ÿæ–½å†…å®¹:

- Feedback Loop ã®å®Ÿè£…
- å¼•ç”¨ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
- AI ç”Ÿæˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãƒ©ãƒ™ãƒ«ä»˜ã‘
- Sensitivity æƒ…å ±ã®è¡¨ç¤º

Powered by AI æ©Ÿèƒ½ã‚’çµ„ã¿è¾¼ã‚€ã“ã¨ã§ã€ã‚«ã‚¹ã‚¿ãƒ  ã‚¨ãƒ³ã‚¸ãƒ³ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ã‚ˆã‚Šé€æ˜æ€§ãŒé«˜ãã€ä¿¡é ¼æ€§ãŒã‚ã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã«ã§ãã¾ã™ã€‚

## Exercise 1: Feedback Loop ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹

ã“ã®æ¼”ç¿’ã§ã¯ã€å‰ã®ãƒ©ãƒœã§ä½œæˆã—ãŸã‚½ãƒ¼ã‚¹ ã‚³ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾åˆ©ç”¨ã—ã¾ã™ã€‚

### Step 1: ã‚¢ãƒ—ãƒªã« Feedback Loop ã‚’çµ±åˆã™ã‚‹

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® `src/app/app.ts` ã‚’é–‹ãã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¦‹ã¤ã‘ã¦ **ai** ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ä¸­ã« `enable_feedback_loop: true` ã‚’è¿½åŠ ã—ã¾ã™ã€‚æ›´æ–°å¾Œã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```javascript
const app = new Application({
  storage,
  ai: {
    planner,
    //feedback loop is enabled
    enable_feedback_loop: true
  },
});
```

ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯å¿œç­”ã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã«ã€`src/app/app.ts` ã«æ¬¡ã®ã‚³ãƒ¼ãƒ‰ ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚

```javascript
app.feedbackLoop(async (_context, _state, feedbackLoopData) => {
  if (feedbackLoopData.actionValue.reaction === 'like') {
      console.log('ğŸ‘' + ' ' + feedbackLoopData.actionValue.feedback!);
  } else {
      console.log('ğŸ‘' + ' ' + feedbackLoopData.actionValue.feedback!);
  }
});
```

<cc-end-step lab="bta3" exercise="1" step="1" />

### Step 2: Feedback Loop æ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹

Feedback Loop æ©Ÿèƒ½ã‚’å‚™ãˆãŸ Career Genie ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚Visual Studio Code ã® **Run and Debug** ã‚¿ãƒ–ã‹ã‚‰ **Debug in Teams (Edge)** ã¾ãŸã¯ **Debug in Teams (Chrome)** ã‚’é¸æŠã—ãƒ‡ãƒãƒƒã‚°ã‚’é–‹å§‹ã—ã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã§ Microsoft Teams ãŒé–‹ãã€ã‚¢ãƒ—ãƒªã®è©³ç´°ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ **Add** ã‚’é¸æŠã—ã¦ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹ã—ã¾ã™ã€‚

!!! tip "Tip: ã“ã®æ¼”ç¿’ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆã™ã‚‹"
    ã“ã‚Œã¾ã§ã‚¢ãƒ—ãƒªã«å®Ÿè£…ã—ãŸã„ãã¤ã‹ã® Teams AI ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ©Ÿèƒ½ã¯ Teams App Test Tool ã§ã¯å‹•ä½œãŒå®Œå…¨ã§ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚å¿…ãš Teams ã§ãƒ­ãƒ¼ã‚«ãƒ« ãƒ‡ãƒãƒƒã‚°ã—ã¦ãã ã•ã„ã€‚

Feedback Loop ã‚’ç¢ºèªã™ã‚‹ã«ã¯ã€ã¾ãšã€ŒHiã€ã‚„ã€ŒSuggest me .NET developers who can speak Spanish.ã€ã®ã‚ˆã†ã«å…¥åŠ›ã—ã¾ã™ã€‚ã‚«ã‚¹ã‚¿ãƒ  ã‚¨ãƒ³ã‚¸ãƒ³ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å¿œç­”ã®å·¦ä¸‹ã«ã‚µãƒ ã‚ºã‚¢ãƒƒãƒ—/ãƒ€ã‚¦ãƒ³ã®ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚

![The UI of a chat with the custom engine agent when the Feedback Loop is enabled. There are thumbs up and down buttons just below the response, to allow users to provide feedback.](../../../assets/images/custom-engine-03/thumbs-up-down.png)

æ¬¡ã« Feedback Loop ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã‚µãƒ ã‚ºã‚¢ãƒƒãƒ—ã¾ãŸã¯ã‚µãƒ ã‚ºãƒ€ã‚¦ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ ã‚«ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ãƒ†ã‚­ã‚¹ãƒˆ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’å…¥åŠ›ã— **Submit** ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¾ã™ã€‚

![The UI of a chat with the custom engine agent when the Feedback Loop is enabled and the user selects any of the thumbs up or down buttons. There is a popup dialog to provide a detailed text-based feedback and a 'Submit' button to send it.](../../../assets/images/custom-engine-03/feedback-card.png)

ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒè¨˜éŒ²ã•ã‚ŒãŸã‹ç¢ºèªã™ã‚‹ã«ã¯ã€Visual Studio Code ã«æˆ»ã‚Šã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’ç¢ºèªã—ã¾ã™ã€‚ã‚µãƒ ã‚ºã‚¢ãƒƒãƒ—/ãƒ€ã‚¦ãƒ³ã®çµæœã¨ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚

![The terminal window of Visual Studio Code showing the user's feedback with a thumb up and the feedback text 'Copilot Camp rocks!'](../../../assets/images/custom-engine-03/feedback-output.png)

!!! tip "ãƒ‡ãƒãƒƒã‚°ã§ Feedback Loop ã‚’æ·±æ˜ã‚Š"
    ã‚³ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒãƒƒã‚°ã—ã¦å‹•ä½œã‚’ç†è§£ã—ã¾ã—ã‚‡ã†ã€‚`app.feedbackLoop` ã«ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’è¨­å®šã—ã€ã‚µãƒ ã‚ºã‚¢ãƒƒãƒ—/ãƒ€ã‚¦ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å®Ÿè¡Œã™ã‚‹ã¨ã€`feedbackLoopData.actionValue.reaction` ã«ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒã€`feedbackLoopData.actionValue.feedback` ã«ãƒ†ã‚­ã‚¹ãƒˆ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒæ ¼ç´ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

<cc-end-step lab="bta3" exercise="1" step="2" />

## Exercise 2: Adaptive Cards ã§å¼•ç”¨ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹

ã‚«ã‚¹ã‚¿ãƒ  ã‚¨ãƒ³ã‚¸ãƒ³ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ãƒ‡ãƒ¼ã‚¿ ã‚½ãƒ¼ã‚¹ã‚’å®šç¾©ã™ã‚‹ã¨ã€Teams AI ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã™ã‚‹å¼•ç”¨ã‚’è‡ªå‹•ã§æœ‰åŠ¹ã«ã—ã¾ã™ã€‚ç¾åœ¨ã®ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€ã€ŒSuggest me .NET developers who can speak Spanish.ã€ã®ã‚ˆã†ã«è³ªå•ã—ã¦ã¿ã¦ãã ã•ã„ã€‚å¼•ç”¨ãƒãƒ¼ã‚¯ã«ã‚«ãƒ¼ã‚½ãƒ«ã‚’åˆã‚ã›ã‚‹ã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®å†’é ­ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![The UI of a chat with the custom engine agent when citations are enabled. There is a citation mark beside a content in the response and a popup callout to show the initial part of the referenced document.](../../../assets/images/custom-engine-03/current-citation.png)

ã“ã®æ¼”ç¿’ã§ã¯ã€ã“ã®å¼•ç”¨ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã‚’ã•ã‚‰ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã€Adaptive Cards ã‚’ç”¨ã„ã¦å¼•ç”¨ã®è¡¨ç¤ºæ–¹æ³•ã‚’å¤‰æ›´ã—ã¾ã™ã€‚

### Step 1: å¼•ç”¨ç”¨ã® Adaptive Card ã‚’ä½œæˆã™ã‚‹

`src/app/` ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã« **card.ts** ã¨ã„ã†æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€æ¬¡ã®ã‚³ãƒ¼ãƒ‰ ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚

```javascript
import { AdaptiveCard, Message, Utilities } from '@microsoft/teams-ai';
/**
 * Create an adaptive card from a prompt response.
 * @param {Message<string>} response The prompt response to create the card from.
 * @returns {AdaptiveCard} The response card.
 */

//Adaptive card to display the response and citations
export function createResponseCard(response: Message<string>): AdaptiveCard {
    const citationCards = response.context?.citations.map((citation, i) => ({
            type: 'Action.ShowCard',
            title: `${i+1}`,
            card: {
                type: 'AdaptiveCard',
                body: [
                    {
                        type: 'TextBlock',
                        text: citation.title,
                        fontType: 'Default',
                        weight: 'Bolder'
                    },
                    {
                        type: 'TextBlock',
                        text: citation.content,
                        wrap: true
                    }
                ]
            }
        }));
    
    const text = Utilities.formatCitationsResponse(response.content!);
    return {
        type: 'AdaptiveCard',
        body: [
            {
                type: 'TextBlock',
                text: text,
                wrap: true
            },
            {
                type: 'TextBlock',
                text: 'Citations',
                wrap: true,
                fontType: 'Default',
                weight: 'Bolder'
            },
            {
                type: 'ActionSet',
                actions: citationCards
            }
        ],
        $schema: 'http://adaptivecards.io/schemas/adaptive-card.json',
        version: '1.5'
    };
}
```

ã“ã® Adaptive Card ã¯ `Action.ShowCard` ãƒœã‚¿ãƒ³ã¨ã—ã¦å¼•ç”¨ã‚’ä¸€è¦§è¡¨ç¤ºã—ã€ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©³ç´°ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚ã¾ãŸã€å¼•ç”¨ãƒœã‚¿ãƒ³ã¨ã¨ã‚‚ã«å¿œç­”ã®ãƒ¡ã‚¤ãƒ³ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè©³ç´°ã‚’ç¢ºèªã—ãŸã„å ´åˆã¯ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦å…¨æ–‡ã‚’é–²è¦§ã§ãã¾ã™ã€‚

<cc-end-step lab="bta3" exercise="2" step="1" />

### Step 2: PredictedSayCommand ã§å¼•ç”¨ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹

??? info "`PredictedSayCommand` ã¨ã¯?"
    **PredictedSayCommand** ã¯ AI ã‚·ã‚¹ãƒ†ãƒ ãŒå®Ÿè¡Œã™ã‚‹å¿œç­”ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã§ã™ã€‚PredictedSayCommand ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã“ã¨ã§ã€å¼•ç”¨ã‚„ Feedback Loop ãªã© Powered by AI æ©Ÿèƒ½ã‚’ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã¸ç´°ã‹ãçµ±åˆã§ãã€AI å¿œç­”ã‚’ã‚¢ãƒ—ãƒªè¦ä»¶ã«åˆã‚ã›ã¦èª¿æ•´ã§ãã¾ã™ã€‚

`src/app/app.ts` ã‚’é–‹ãã€å…ˆã»ã©ä½œæˆã—ãŸ Adaptive Card ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã«æ¬¡ã®ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’ã‚³ãƒ¼ãƒ‰å†’é ­ã«è¿½åŠ ã—ã¾ã™ã€‚

```javascript
import { createResponseCard } from './card';
```

`botbuilder` ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã« `CardFactory` ã‚’è¿½åŠ ã—ã€æ›´æ–°å¾Œã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```javascript
import { CardFactory, MemoryStorage, MessageFactory, TurnContext } from "botbuilder";
```

"@microsoft/teams-ai" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã« `AI` ã¨ `PredictedSayCommand` ã‚’è¿½åŠ ã—ã€æ›´æ–°å¾Œã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```javascript
import { Application, ActionPlanner, OpenAIModel, PromptManager, AI, PredictedSayCommand} from "@microsoft/teams-ai";
```

å¼•ç”¨ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ãŸã‚ã« `src/app/app.ts` ã«æ¬¡ã® PredictedSayCommand ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```javascript
app.ai.action<PredictedSayCommand>(AI.SayCommandActionName, async (context, state, data, action) => {
  let activity;
  if (data.response.context && data.response.context.citations.length > 0 ) {
      const attachment = CardFactory.adaptiveCard(createResponseCard(data.response));
      activity = MessageFactory.attachment(attachment);
  }
  else {
      activity = MessageFactory.text(data.response.content);
  }

  activity.entities = [
    {
        type: "https://schema.org/Message",
        "@type": "Message",
        "@context": "https://schema.org",
        "@id": ""
    }
  ];
  activity.channelData = {
    feedbackLoopEnabled: true
  };

  await context.sendActivity(activity);

  return "success";
 
});
```

<cc-end-step lab="bta3" exercise="2" step="2" />

### Step 3: ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸå¼•ç”¨ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹

ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸå¼•ç”¨ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã‚’å‚™ãˆãŸ Career Genie ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚Visual Studio Code ã® **Run and Debug** ã‚¿ãƒ–ã‹ã‚‰ **Debug in Teams (Edge)** ã¾ãŸã¯ **Debug in Teams (Chrome)** ã‚’é¸æŠã—ã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã§ Microsoft Teams ãŒé–‹ã„ãŸã‚‰ã€ã‚¢ãƒ—ãƒªã®è©³ç´°ã§ **Add** ã‚’é¸æŠã—ã¦ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹ã—ã¾ã™ã€‚

!!! tip "Tip: ã“ã®æ¼”ç¿’ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆã™ã‚‹"
    ã“ã‚Œã¾ã§ã‚¢ãƒ—ãƒªã«å®Ÿè£…ã—ãŸ Teams AI ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ©Ÿèƒ½ã¯ Teams App Test Tool ã§ã¯å®Œå…¨ã«å‹•ä½œã—ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚å¿…ãš Teams ã§ãƒ­ãƒ¼ã‚«ãƒ« ãƒ‡ãƒãƒƒã‚°ã—ã¦ãã ã•ã„ã€‚

ã¾ãšã€ŒHiã€ã‚„ã€ŒHelloã€ã¨æŒ¨æ‹¶ã—ã€ãã®å¾Œã€ŒCan you suggest any candidates for a senior developer position with 7+ year experience that requires Japanese speaking?ã€ã®ã‚ˆã†ã«è³ªå•ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

![An animation showing the behavior of citations in a custom engine agent. There is a prompt and a response that provides three citations. Each citation shows the actual resume for each employee referenced in the answer.](../../../assets/images/custom-engine-03/customized-citation.gif)

Adaptive Cards ã§ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã•ã‚ŒãŸå¼•ç”¨ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹ã§ã¯ã€å¼•ç”¨ã”ã¨ã«ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚å¼•ç”¨ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ ãƒ“ãƒ¥ãƒ¼ã‚’å±•é–‹ã—ã€å€™è£œè€…ã”ã¨ã®å±¥æ­´æ›¸è©³ç´°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

<cc-end-step lab="bta3" exercise="2" step="3" />

## Exercise 3: Generated by AI ãƒ©ãƒ™ãƒ«ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹

ã“ã®æ¼”ç¿’ã§ã¯ `PredictedSayCommand` ã‚’ä½¿ã„ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ AI ã¨äººé–“ã®å¿œç­”ã‚’åŒºåˆ¥ã§ãã‚‹ã‚ˆã†ã€ŒAI generatedã€ãƒ©ãƒ™ãƒ«ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

### Step 1: PredictedSayCommand ã§ Generated by AI ãƒ©ãƒ™ãƒ«ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹

`src/app/app.ts` ã‚’é–‹ãã€`PredictedSayCommand` ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ¢ã—ã¾ã™ã€‚`activity.entities` å†…ã«æ¬¡ã®ã‚³ãƒ¼ãƒ‰ ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚

```javascript
// Generated by AI label
additionalType: ["AIGeneratedContent"]
```

æ›´æ–°å¾Œã® `activity.entities` ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```javascript
activity.entities = [
    {
        type: "https://schema.org/Message",
        "@type": "Message",
        "@context": "https://schema.org",
        "@id": "",
        // Generated by AI label
        additionalType: ["AIGeneratedContent"],
    },
    
];
```

<cc-end-step lab="bta3" exercise="3" step="1" />

### Step 2: Generated by AI ãƒ©ãƒ™ãƒ«ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹

Generated by AI ãƒ©ãƒ™ãƒ«ä»˜ãã® Career Genie ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚Visual Studio Code ã® **Run and Debug** ã‚¿ãƒ–ã‹ã‚‰ **Debug in Teams (Edge)** ã¾ãŸã¯ **Debug in Teams (Chrome)** ã‚’é¸æŠã—ãƒ‡ãƒãƒƒã‚°ã—ã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã§ Microsoft Teams ãŒé–‹ã„ãŸã‚‰ã€ã‚¢ãƒ—ãƒªã®è©³ç´°ã§ **Add** ã‚’é¸æŠã—ã¦ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹ã—ã¾ã™ã€‚

!!! tip "Tip: ã“ã®æ¼”ç¿’ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆã™ã‚‹"
    ã“ã‚Œã¾ã§ã‚¢ãƒ—ãƒªã«å®Ÿè£…ã—ãŸ Teams AI ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ©Ÿèƒ½ã¯ Teams App Test Tool ã§ã¯å®Œå…¨ã«å‹•ä½œã—ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚å¿…ãš Teams ã§ãƒ­ãƒ¼ã‚«ãƒ« ãƒ‡ãƒãƒƒã‚°ã—ã¦ãã ã•ã„ã€‚

Career Genie ã«æŒ¨æ‹¶ã—ã¦ã¿ã¦ãã ã•ã„ã€‚æœ€åˆã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ä¸Šéƒ¨ã«å°ã•ãã€ŒAI generatedã€ãƒ©ãƒ™ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

![The UI of a chat with the custom engine agent when the Generated by AI label is enabled. At the top of the answer there is a label showing that the content is 'AI generated'.](../../../assets/images/custom-engine-03/ai-generated.png)

<cc-end-step lab="bta3" exercise="3" step="2" />

## Exercise 4: Sensitivity ãƒ©ãƒ™ãƒ«ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹

æœ€å¾Œã®æ¼”ç¿’ã§ã¯ `PredictedSayCommand` ã‚’ç”¨ã„ã¦ Sensitivity ãƒ©ãƒ™ãƒ«ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚Career Genie ã¯äººäº‹é–¢é€£ã®æ©Ÿå¯†æƒ…å ±ã‚’æ‰±ã†ã“ã¨ãŒå¤šã„ãŸã‚ã€å…±æœ‰æƒ…å ±ãŒæ©Ÿå¯†æ€§ã‚’å«ã‚€å ´åˆã« Sensitivity ãƒ©ãƒ™ãƒ«ã‚’è¡¨ç¤ºã—ã¦çµ„ç¹”å¤–ã¸ã®å…±æœ‰å¯å¦ã‚’ç¤ºã—ã¾ã™ã€‚

### Step 1: PredictedSayCommand ã§ Sensitivity ãƒ©ãƒ™ãƒ«ã‚’æœ‰åŠ¹åŒ–ã™ã‚‹

`src/app/app.ts` ã‚’é–‹ãã€`PredictedSayCommand` ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ¢ã—ã¾ã™ã€‚`activity.entities` å†…ã«æ¬¡ã®ã‚³ãƒ¼ãƒ‰ ã‚¹ãƒ‹ãƒšãƒƒãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚

```javascript
// Sensitivity label
usageInfo: {
    "@type": "CreativeWork",
    name: "Confidential",
    description: "Sensitive information, do not share outside of your organization.",
}
```

æ›´æ–°å¾Œã® `activity.entities` ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```javascript
activity.entities = [
    {
        type: "https://schema.org/Message",
        "@type": "Message",
        "@context": "https://schema.org",
        "@id": "",
        // Generated by AI label
        additionalType: ["AIGeneratedContent"],
        // Sensitivity label
        usageInfo: {
          "@type": "CreativeWork",
          name: "Confidential",
          description: "Sensitive information, do not share outside of your organization.",
        }
    },
    
  ];
```

<cc-end-step lab="bta3" exercise="4" step="1" />

### Step 2: Sensitivity ãƒ©ãƒ™ãƒ«ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹

Sensitivity ãƒ©ãƒ™ãƒ«ä»˜ãã® Career Genie ã‚’ãƒ†ã‚¹ãƒˆã—ã¾ã—ã‚‡ã†ã€‚Visual Studio Code ã® **Run and Debug** ã‚¿ãƒ–ã‹ã‚‰ **Debug in Teams (Edge)** ã¾ãŸã¯ **Debug in Teams (Chrome)** ã‚’é¸æŠã—ã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã§ Microsoft Teams ãŒé–‹ãã€ã‚¢ãƒ—ãƒªã®è©³ç´°ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ **Add** ã‚’é¸æŠã—ã¦ãƒãƒ£ãƒƒãƒˆã‚’é–‹å§‹ã—ã¾ã™ã€‚

!!! tip "Tip: ã“ã®æ¼”ç¿’ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆã™ã‚‹"
    ã“ã‚Œã¾ã§ã‚¢ãƒ—ãƒªã«å®Ÿè£…ã—ãŸ Teams AI ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ©Ÿèƒ½ã¯ Teams App Test Tool ã§ã¯å®Œå…¨ã«å‹•ä½œã—ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚å¿…ãš Teams ã§ãƒ­ãƒ¼ã‚«ãƒ« ãƒ‡ãƒãƒƒã‚°ã—ã¦ãã ã•ã„ã€‚

ã€ŒHiã€ã‚„ã€ŒCan you suggest a candidate who is suitable for spanish speaking role that requires at least 2 years of .NET experience?ã€ãªã©ã¨è³ªå•ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

![The UI of a chat with the custom engine agent when the Sensitivity label is enabled. At the top of the answer, next to the 'AI generated' label, there is a sensitivity shield label highlighted. There is also a card with specific guidance that appears when hoovering over the sensitivity label.](../../../assets/images/custom-engine-03/sensitivity-label.png)

Career Genie ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸Šéƒ¨ã§ã€ŒAI Generatedã€ãƒ©ãƒ™ãƒ«ã®éš£ã« Sensitivity ãƒ©ãƒ™ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚Sensitivity ãƒ©ãƒ™ãƒ«ã«ã‚«ãƒ¼ã‚½ãƒ«ã‚’åˆã‚ã›ã¦ã€çµ„ç¹”å›ºæœ‰ã®ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

<cc-end-step lab="bta3" exercise="4" step="2" />

---8<--- "ja/b-congratulations.md"

Lab BTA3 - Powered by AI ã‚­ãƒƒãƒˆã«ã‚ˆã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹å‘ä¸Šãƒ©ãƒœã‚’å®Œäº†ã—ã¾ã—ãŸã€‚ã•ã‚‰ã«æ¢æ±‚ã—ãŸã„å ´åˆã¯ã€ã“ã®ãƒ©ãƒœã®ã‚½ãƒ¼ã‚¹ ã‚³ãƒ¼ãƒ‰ã‚’ [Copilot Developer Camp ãƒªãƒã‚¸ãƒˆãƒª](https://github.com/microsoft/copilot-camp/tree/main/src/custom-engine-agent/Lab03-Powered-by-AI/CareerGenie){target=_blank} ã§ã”è¦§ã„ãŸã ã‘ã¾ã™ã€‚

æ¬¡ã¯ Lab BTA4 - èªè¨¼ã«ã‚ˆã‚‹ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ ê°•í™” ã«é€²ã¿ã¾ã—ã‚‡ã†ã€‚Next ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚

<cc-next url="../04-authentication" />

<img src="https://m365-visitor-stats.azurewebsites.net/copilot-camp/custom-engine/teams-ai/03-powered-by-ai--ja" />