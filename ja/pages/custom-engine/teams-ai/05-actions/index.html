
<!doctype html>
<html lang="ja" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://microsoft.github.io/copilot-camp/ja/pages/custom-engine/teams-ai/05-actions/">
      
      
      
      
        
          <link rel="alternate" href="../../../../../pages/custom-engine/teams-ai/05-actions/" hreflang="en">
        
          <link rel="alternate" href="./" hreflang="ja">
        
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>ラボ BTA5 - 複雑なタスクを処理するアクションの追加 - Copilot Developer Camp</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../stylesheets/labStyles.css">
    
      <link rel="stylesheet" href="../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#bta5-" class="md-skip">
          コンテンツにスキップ
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="ヘッダー">
    <a href="../../../../" title="Copilot Developer Camp" class="md-header__button md-logo" aria-label="Copilot Developer Camp" data-md-component="logo">
      
  <img src="../../../../../assets/images/tent-small.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Copilot Developer Camp
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ラボ BTA5 - 複雑なタスクを処理するアクションの追加
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="言語切り替え">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="../../../../../pages/custom-engine/teams-ai/05-actions/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="./" hreflang="ja" class="md-select__link">
              Japanese (日本語)
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="検索" placeholder="検索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="検索">
        
        <button type="reset" class="md-search__icon md-icon" title="クリア" aria-label="クリア" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            検索を初期化
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/microsoft/copilot-camp" title="リポジトリへ" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/copilot-camp
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="タブ" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../" class="md-tabs__link">
        
  
  
    
  
  ようこそ

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../make/" class="md-tabs__link">
          
  
  
  Maker 向けエージェントの作成

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../extend-m365-copilot/" class="md-tabs__link">
          
  
  
  宣言型エージェントの構築

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../" class="md-tabs__link">
          
  
  
  カスタム エンジン エージェントの構築

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../beyond-agents/" class="md-tabs__link">
          
  
  
  AI の概念と手法

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../resources/" class="md-tabs__link">
        
  
  
    
  
  動画など

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="ナビゲーション" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../" title="Copilot Developer Camp" class="md-nav__button md-logo" aria-label="Copilot Developer Camp" data-md-component="logo">
      
  <img src="../../../../../assets/images/tent-small.png" alt="logo">

    </a>
    Copilot Developer Camp
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/microsoft/copilot-camp" title="リポジトリへ" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/copilot-camp
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ようこそ
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Maker 向けエージェントの作成
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Maker 向けエージェントの作成
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Microsoft 365 Copilot 用エージェントの作成
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/agent-builder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MAB - Copilot Studio エージェント ビルダーによるエージェント作成
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/agent-builder/01-first-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MAB1 - 最初のエージェント構築
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS - Microsoft Copilot Studio の概要
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/00-prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MCS0 - セットアップ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/01-first-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MCS1 - 最初のエージェント
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/02-topics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS2 - トピックの定義
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/03-actions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MCS3 - ツールの定義
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/04-extending-m365-copilot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MCS4 - Microsoft 365 Copilot の拡張
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/05-connectors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MCS5 - Power Platform カスタム コネクタ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/06-mcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MCS6 - MCP サーバーの利用
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/07-autonomous/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MCS7 - 自律型エージェントの作成
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/08-rag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MCS8 - RAG のための Azure AI Search 統合
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/sharepoint-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MSA - SharePoint エージェントの理解
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/sharepoint-agents/01-first-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MSA1 - はじめての SharePoint エージェント作成
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/sharepoint-agents/02-sharing-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MSA2 - SharePoint エージェントの共有
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    宣言型エージェントの構築
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    宣言型エージェントの構築
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Microsoft 365 Copilot の拡張
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    セットアップ
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    セットアップ
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/00-prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ E0 - セットアップ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    宣言型エージェントの基礎
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    宣言型エージェントの基礎
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/01-typespec-declarative-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ E1 - Microsoft 365 Agents Toolkit と TypeSpec 定義による Declarative エージェントの初構築
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/01a-geolocator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ E1 - 指示ベース Geo Locator ゲーム エージェント
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API をゼロから構築して統合
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API をゼロから構築して統合
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/02-build-the-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ E2 - API の構築
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/03-add-declarative-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ E3 - 宣言型 エージェント と API プラグインの追加
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/04-enhance-api-plugin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ E4 - API とプラグインを拡張する
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/05-add-adaptive-card/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab E5 - Adaptive Cards の追加
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/06a-add-authentication-ttk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ E6a - Entra ID 認証を OAuth で追加 (Agents Toolkit)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    認証 (旧ラボ)
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    認証 (旧ラボ)
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/06b-add-authentication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ E6b - OAuth を使用した Entra ID 認証の追加 (手動セットアップ)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/06c-add-sso/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ E6c - Entra ID 認証と Single Sign-on の追加
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    インテグレーション
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    インテグレーション
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/07-add-graphconnector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ E7 - 統合: Microsoft Copilot Connector を使用して Trey Genie にナレッジ機能を追加
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    カスタム エンジン エージェントの構築
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    カスタム エンジン エージェントの構築
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    カスタムエンジン エージェントの構築
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    M365 Agents SDK ラボ
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    M365 Agents SDK ラボ
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    イントロ - M365 Agents SDK と Semantic Kernel を使用したエージェント構築
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/00-prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ BMA0 - 前提条件
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/01-agent-in-foundry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ BMA1 - Azure AI Foundry でエージェントを準備する
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/02-agent-with-agents-sdk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ BMA2 - M365 Agents SDK を使用して最初のエージェントを構築
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/03-agent-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ BMA3 - Azure AI Foundry エージェントを M365 Agents SDK と統合
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/04-bring-agent-to-copilot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MBA4 - エージェントを Copilot Chat に導入
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    AI の概念と手法
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    AI の概念と手法
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../beyond-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    始めてみましょう
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../beyond-agents/beginner-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    エージェント指示ラボ - エージェント指示の改善（初心者向け）
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    動画など
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="bta5-">ラボ BTA5 - 複雑なタスクを処理するアクションの追加</h1>
<p>このラボでは次のことを行います。</p>
<ul>
<li>アクションとは何かを学び、それを使って複雑なタスクを処理する方法を理解します  </li>
<li>カスタム エンジン エージェントにマルチプロンプトを統合し、アクションを扱えるようにします  </li>
<li>カスタム エンジン エージェントにアクションを実装します  </li>
<li>Microsoft Graph とアクションを組み合わせてワークフローを自動化します  </li>
</ul>
<div class="lab-intro-video">
    <div style="flex: 1; min-width: 0;">
        <iframe  src="//www.youtube.com/embed/bfULaDnpAXY" frameborder="0" allowfullscreen style="width: 100%; aspect-ratio: 16/9;">          
        </iframe>
          <div>このビデオでラボの概要を素早く確認しましょう。</div>
    </div>
    <div style="flex: 1; min-width: 0;">
        <div class="floatwide">
        <div class="cc-lab-toc b-path">
          <img src="/copilot-camp/assets/images/path-icons/B-path-heading.png"></img>
          <div>
            <p>Azure OpenAI と Teams AI library を使用してカスタム AI モデルとオーケストレーションを備えた Custom エンジン エージェントを構築したい場合は、これらの ラボ を実施してください</p>
            <ul>
              <li><a href="/copilot-camp/ja/pages/custom-engine/teams-ai/00-prerequisites/">BTA0 - セットアップ</a></li>
              <li><a href="/copilot-camp/ja/pages/custom-engine/teams-ai/01-custom-engine-agent/">BTA1 - はじめての Custom エンジン エージェント</a></li>
              <li><a href="/copilot-camp/ja/pages/custom-engine/teams-ai/02-rag/">BTA2 - データを Azure AI Search でインデックス化する</a></li>
              <li><a href="/copilot-camp/ja/pages/custom-engine/teams-ai/03-powered-by-ai/">BTA3 - ユーザー エクスペリエンスを強化する</a></li>
              <li><a href="/copilot-camp/ja/pages/custom-engine/teams-ai/04-authentication/">BTA4 - シングル サインオン認証を追加する</a></li>
              <li><a href="/copilot-camp/ja/pages/custom-engine/teams-ai/05-actions/">BTA5 - 複雑なタスクを処理するアクションを追加する</a></li>
            </ul>
          </div>
        </div>

        <script>
        (() => {
        // This script decorates the table of contents with a "you are here" indicator.
        const toc = document.getElementsByClassName('cc-lab-toc');
        for (const div of toc) {
            const lis = div.querySelectorAll('li');
            for (const li of lis) {
                const anchor = li.querySelector('a');
                if (location.href.includes(anchor.href)) {
                    const span = document.createElement("span");
                    span.innerHTML = "YOU&nbsp;ARE&nbsp;HERE";
                    li.appendChild(span);
                }
            }    
        }
        })();
        </script>

        <!-- <div class="cc-b-lab-steps">
            <h4>目次</h4>
            <cc-table-of-contents />
          </div> -->
        </div>
    </div>
</div>

<h2 id="_1">はじめに</h2>
<p>さあ、Career Genie にアクションを追加して複雑なタスクやワークフローを処理できるようにしましょう！このラボでは、候補者のリストを扱える新しいプロンプトを Career Genie のロジックに統合します。つまり Career Genie で候補者を検索するときに、候補者のリストを作成し名前を追加できるようになります。作成後は、そのリストを HR に送って面接日程を調整することも可能です。これらすべてを Career Genie に実装するアクションで処理します。それでは始めましょう。</p>
<details class="info" open="open">
<summary>カスタム エンジン エージェントにおけるアクションとは？</summary>
<p>AI システムにおけるアクションは、コードでいうところの基本的な関数やメソッドのようなものです。ユーザーの入力に基づいて実行される特定のタスクを指し、AI がさまざまな処理を行う際の構成要素となります。どのアクションを実行するかは、ユーザーの要望によって AI システムが判断します。</p>
<p>例として、以下のようなアクションがあります。</p>
<ul>
<li>新しいリストを作成する  </li>
<li>リストを削除する  </li>
<li>既存のリストに項目を追加する  </li>
<li>既存のリストから項目を削除する  </li>
</ul>
<p>ユーザーが AI システムに対話すると、システムはプロンプトを解釈し適切なアクションを選択して実行します。まるでツールボックスに入ったツールの中から、ユーザーのニーズに応じて最適なツールを選ぶようなイメージです。</p>
</details>
<h2 id="exercise-1">Exercise 1: アクション付きの新しいプロンプトの作成</h2>
<p>この演習では、「prompts」フォルダーにアクションを処理する新しいプロンプトを作成します。</p>
<h3 id="step-1-monologue">Step 1: 「monologue」プロンプトを作成する</h3>
<p>プロジェクトで <code>src/prompts/</code> に移動し、<strong>monologue</strong> という名前の新しいフォルダーを追加します。<code>src/prompts/monologue/</code> フォルダーに <strong>config.json</strong> という名前のファイルを作成し、次のコード スニペットをコピーしてください。</p>
<pre><code class="language-json">{
  &quot;schema&quot;: 1.1,
  &quot;description&quot;: &quot;A bot that can chat with users&quot;,
  &quot;type&quot;: &quot;completion&quot;,
  &quot;completion&quot;: {
    &quot;completion_type&quot;: &quot;chat&quot;,
    &quot;include_history&quot;: true,
    &quot;include_input&quot;: true,
    &quot;max_input_tokens&quot;: 2800,
    &quot;max_tokens&quot;: 1000,
    &quot;temperature&quot;: 0.9,
    &quot;top_p&quot;: 0.0,
    &quot;presence_penalty&quot;: 0.6,
    &quot;frequency_penalty&quot;: 0.0
  },
  &quot;augmentation&quot;: {
      &quot;augmentation_type&quot;: &quot;monologue&quot;
  }
}
</code></pre>
<div class="admonition tip">
<p class="admonition-title"><code>config.json</code> の <code>augmentation</code> についての簡単な説明</p>
<p>Augmentation はプロンプト エンジニアリングを簡略化する機能で、特定の指示を自動的にプロンプトへ追加します。augmentation を利用すると、AI にマルチステップ タスク（sequence）を処理させるか、ステップごとに考えさせる（monologue）かを設定できます。</p>
</div>
<p><code>src/prompts/monologue/</code> フォルダーに <strong>skprompt.txt</strong> というファイルを作成し、次のテキストをコピーしてください。</p>
<pre><code>You are a career specialist named &quot;Career Genie&quot; that helps Human Resources team who can manage lists of Candidates. 
You are friendly and professional. You like using emojis where appropriate.
Always share the lists in bullet points.

rules:
- only create lists the user has explicitly asked to create.
- only add Candidates to a list that the user has asked to have added.
- if multiple lists are being manipulated, call a separate action for each list.
- if Candidates are being added and removed from a list, call a separate action for each operation.
- if user asks for a summary, share all the lists and candidates. 
- only send an email to HR if user has explicitly asked to send.

Current lists:
{{$conversation.lists}}
</code></pre>
<p>同じフォルダーに <strong>actions.json</strong> というファイルを作成し、次のコード スニペットをコピーします。</p>
<pre><code class="language-json">[
    {
        &quot;name&quot;: &quot;createList&quot;,
        &quot;description&quot;: &quot;Creates a new list with an optional set of initial Candidates&quot;,
        &quot;parameters&quot;: {
            &quot;type&quot;: &quot;object&quot;,
            &quot;properties&quot;: {
                &quot;list&quot;: {
                    &quot;type&quot;: &quot;string&quot;,
                    &quot;description&quot;: &quot;The name of the list to create&quot;
                },
                &quot;Candidates&quot;: {
                    &quot;type&quot;: &quot;array&quot;,
                    &quot;description&quot;: &quot;The Candidates to add to the list&quot;,
                    &quot;Candidates&quot;: {
                        &quot;type&quot;: &quot;string&quot;
                    }
                }
            },
            &quot;required&quot;: [
                &quot;list&quot;
            ]
        }
    },
    {
        &quot;name&quot;: &quot;deleteList&quot;,
        &quot;description&quot;: &quot;Deletes a list&quot;,
        &quot;parameters&quot;: {
            &quot;type&quot;: &quot;object&quot;,
            &quot;properties&quot;: {
                &quot;list&quot;: {
                    &quot;type&quot;: &quot;string&quot;,
                    &quot;description&quot;: &quot;The name of the list to delete&quot;
                }
            },
            &quot;required&quot;: [
                &quot;list&quot;
            ]
        }
    },
    {
        &quot;name&quot;: &quot;addCandidates&quot;,
        &quot;description&quot;: &quot;Adds one or more Candidates to a list&quot;,
        &quot;parameters&quot;: {
            &quot;type&quot;: &quot;object&quot;,
            &quot;properties&quot;: {
                &quot;list&quot;: {
                    &quot;type&quot;: &quot;string&quot;,
                    &quot;description&quot;: &quot;The name of the list to add the item to&quot;
                },
                &quot;Candidates&quot;: {
                    &quot;type&quot;: &quot;array&quot;,
                    &quot;description&quot;: &quot;The Candidates to add to the list&quot;,
                    &quot;Candidates&quot;: {
                        &quot;type&quot;: &quot;string&quot;
                    }
                }
            },
            &quot;required&quot;: [
                &quot;list&quot;,
                &quot;Candidates&quot;
            ]
        }
    },
    {
        &quot;name&quot;: &quot;removeCandidates&quot;,
        &quot;description&quot;: &quot;Removes one or more Candidates from a list&quot;,
        &quot;parameters&quot;: {
            &quot;type&quot;: &quot;object&quot;,
            &quot;properties&quot;: {
                &quot;list&quot;: {
                    &quot;type&quot;: &quot;string&quot;,
                    &quot;description&quot;: &quot;The name of the list to remove the item from&quot;
                },
                &quot;Candidates&quot;: {
                    &quot;type&quot;: &quot;array&quot;,
                    &quot;description&quot;: &quot;The Candidates to remove from the list&quot;,
                    &quot;Candidates&quot;: {
                        &quot;type&quot;: &quot;string&quot;
                    }
                }
            },
            &quot;required&quot;: [
                &quot;list&quot;,
                &quot;Candidates&quot;
            ]
        }
    }
]
</code></pre>
<p><cc-end-step lab="bta5" exercise="1" step="1" /></p>
<h2 id="exercise-2">Exercise 2: プロンプトを選択するロジックをプランナーに実装する</h2>
<p>この演習では、ユーザーのプロンプトをチェックして「chat」か「monologue」のどちらかのプロンプトを選択する関数を実装します。</p>
<h3 id="step-1-defaultprompt">Step 1: プランナーに <code>defaultPrompt</code> 用の関数を作成する</h3>
<p>プロジェクトの <code>src/app/app.ts</code> ファイルで、次の関数を追加します。</p>
<pre><code class="language-javascript">async function choosePrompt(context){
  if (context.activity.text.includes('list')){
    const template = await prompts.getPrompt('monologue');
    return template;
  }
  else {
    const template = await prompts.getPrompt('chat');
    const skprompt = fs.readFileSync(path.join(__dirname, '..', 'prompts', 'chat', 'skprompt.txt'));

    const dataSources = (template.config.completion as any)['data_sources'];

    dataSources.forEach((dataSource: any) =&gt; {
      if (dataSource.type === 'azure_search') {
        dataSource.parameters.authentication.key = config.azureSearchKey;
        dataSource.parameters.endpoint = config.azureSearchEndpoint;
        dataSource.parameters.indexName = config.indexName;
        dataSource.parameters.embedding_dependency.deployment_name =
          config.azureOpenAIEmbeddingDeploymentName;
        dataSource.parameters.role_information = `${skprompt.toString('utf-8')}`;
      }
    });

    return template;
  }
}
</code></pre>
<div class="admonition tip">
<p class="admonition-title"><code>choosePrompt</code> 関数を確認</p>
<p><code>choosePrompt</code> 関数はユーザー プロンプトに「list」が含まれているかどうかをチェックします。含まれていれば <strong>monologue</strong> プロンプトを返し、含まれていなければデフォルト プロンプトである <strong>chat</strong> を返します。</p>
</div>
<p><code>src/app/app.ts</code> ファイルで <code>planner</code> を探し、<strong>defaultPrompt</strong> に割り当てられているコードを削除します。その後、<code>choosePrompt</code> 関数を <strong>defaultPrompt</strong> として定義します。最終的なプランナーは次のようになります。</p>
<pre><code class="language-javascript">const planner = new ActionPlanner({
  model,
  prompts,
  defaultPrompt: choosePrompt,
});
</code></pre>
<p><cc-end-step lab="bta5" exercise="2" step="1" /></p>
<h2 id="exercise-3">Exercise 3: アプリにアクションを実装する</h2>
<p>この演習では、アクション用の関数を作成し、アプリにアクション ハンドラーを登録します。</p>
<h3 id="step-1-conversationstate">Step 1: <code>ConversationState</code> を更新し、各アクションの関数を定義する</h3>
<p><code>src/app/app.ts</code> で <code>@microsoft/teams-ai</code> のインポートを <strong>DefaultConversationState</strong> に更新します。最終的なインポートは次のとおりです。</p>
<pre><code class="language-javascript">import { AuthError, ActionPlanner, OpenAIModel, PromptManager, AI, PredictedSayCommand, Application, TurnState, DefaultConversationState } from &quot;@microsoft/teams-ai&quot;;
</code></pre>
<p><code>src/app/app.ts</code> で <strong>ConversationState</strong> と <strong>ApplicationTurnState</strong> を探し、次のコードに置き換えます。</p>
<pre><code class="language-javascript">// Strongly type the applications turn state
interface ConversationState extends DefaultConversationState {
  lists: Record&lt;string, string[]&gt;;
}
export type ApplicationTurnState = TurnState&lt;ConversationState&gt;;
</code></pre>
<p><code>src/app/</code> フォルダーに <strong>actions.ts</strong> というファイルを作成し、次のソースコードを追加してアクション用の関数を定義します。</p>
<pre><code class="language-javascript">import { ApplicationTurnState } from './app';

function getCandidates(state: ApplicationTurnState, list: string): string[] {
    ensureListExists(state, list);
    return state.conversation.lists[list];
}

function setCandidates(state: ApplicationTurnState, list: string, Candidates: string[]): void {
    ensureListExists(state, list);
    state.conversation.lists[list] = Candidates ?? [];
}

function ensureListExists(state: ApplicationTurnState, listName: string): void {
    if (typeof state.conversation.lists != 'object') {
        state.conversation.lists = {};
    }

    if (!Object.prototype.hasOwnProperty.call(state.conversation.lists, listName)) {
        state.conversation.lists[listName] = [];
    }
}

function deleteList(state: ApplicationTurnState, listName: string): void {
    if (
        typeof state.conversation.lists == 'object' &amp;&amp;
        Object.prototype.hasOwnProperty.call(state.conversation.lists, listName)
    ) {
        delete state.conversation.lists[listName];
    }
}

export { getCandidates, setCandidates, ensureListExists, deleteList };
</code></pre>
<p><cc-end-step lab="bta5" exercise="3" step="1" /></p>
<h3 id="step-2">Step 2: アクション ハンドラーをアプリに登録する</h3>
<p><code>src/app/app.ts</code> にアクションのインポートを追加します。</p>
<pre><code class="language-javascript">import { ensureListExists, getCandidates, setCandidates, deleteList } from &quot;./actions&quot;;
</code></pre>
<p>次に、AI システムにアクション ハンドラーを登録するために以下のコード スニペットを追加します。</p>
<pre><code class="language-javascript">// Register action handlers
interface ListOnly {
  list: string;
}

interface ListAndCandidates extends ListOnly {
  Candidates?: string[];
}

app.ai.action('createList', async (context: TurnContext, state: ApplicationTurnState, parameters: ListAndCandidates) =&gt; {
  ensureListExists(state, parameters.list);
  if (Array.isArray(parameters.Candidates) &amp;&amp; parameters.Candidates.length &gt; 0) {
      await app.ai.doAction(context, state, 'addCandidates', parameters);
      return `List created and Candidates added. Summarize your action.`;
  } else {
      return `List created. Summarize your action.`;
  }
});

app.ai.action('deleteList', async (context: TurnContext, state: ApplicationTurnState, parameters: ListOnly) =&gt; {
  deleteList(state, parameters.list);
  return `list deleted. Summarize your action.`;
});

app.ai.action('addCandidates', async (context: TurnContext, state: ApplicationTurnState, parameters: ListAndCandidates) =&gt; {
  const Candidates = getCandidates(state, parameters.list);
  Candidates.push(...(parameters.Candidates ?? []));
  setCandidates(state, parameters.list, Candidates);
  return `Candidates added. Summarize your action.`;
});

app.ai.action('removeCandidates', async (context: TurnContext, state: ApplicationTurnState, parameters: ListAndCandidates) =&gt; {
  const Candidates = getCandidates(state, parameters.list);
  (parameters.Candidates ?? []).forEach((candidate: string) =&gt; {
      const index = Candidates.indexOf(candidate);
      if (index &gt;= 0) {
          Candidates.splice(index, 1);
      }
  });
  setCandidates(state, parameters.list, Candidates);
  return `Candidates removed. Summarize your action.`;
});

</code></pre>
<p><cc-end-step lab="bta5" exercise="3" step="2" /></p>
<h3 id="step-3">Step 3: 新しいアクションでアプリをテストする</h3>
<p>Visual Studio Code の <strong>Run and Debug</strong> タブで <strong>Debug in Teams (Edge)</strong> または <strong>Debug in Teams (Chrome)</strong> を選択してデバッグを開始しましょう。ブラウザーで Microsoft Teams が開きます。アプリの詳細が表示されたら <strong>Add</strong> を選択し、チャットを開始します。</p>
<div class="admonition tip">
<p class="admonition-title">この演習をローカルでテストする際のヒント</p>
<p>これまでに実装した Teams AI ライブラリの機能の一部は Teams App Test Tool では正常に動作しない場合があります。必ずローカルの Teams でテストおよびデバッグを行ってください。</p>
</div>
<p>フローを理解するため、以下の順番で質問してみましょう。</p>
<ul>
<li>Hello  </li>
<li>Can you suggest candidates who have experience in .NET?  </li>
<li>Great, add Isaac Talbot in the .NET Developer Candidates list  </li>
<li>Add Anthony Ivanov in the same list with Isaac  </li>
<li>Can you summarize my lists  </li>
<li>Suggest candidates who have experience in Python and are able to speak Spanish  </li>
<li>Nice! Add Sara Folgueroles in the Python Developer Candidates (Spanish speaking) list  </li>
<li>Can you suggest candidates who have 10+ years of experience  </li>
<li>Ok, remove Anthony from the .NET Developer Candidates list  </li>
<li>Add Anthony Ivanov in the Talent list  </li>
<li>Summarize my lists  </li>
</ul>
<p><img alt="Animation showing Career Genie in action accordingly to the dialog flow illustrated above, to search for candidates and add them to lists." src="../../../../../assets/images/custom-engine-05/actions.gif" /></p>
<p><cc-end-step lab="bta5" exercise="3" step="3" /></p>
<h2 id="exercise-4-microsoft-graph">Exercise 4: Microsoft Graph とアクションを組み合わせてワークフローを自動化する</h2>
<p>この演習では、Microsoft Graph を利用して候補者リストを HR に送信し、面接をスケジュールする新しいアクションを実装します。</p>
<h3 id="step-1">Step 1: メール送信用の新しいアクションをプロンプトに定義する</h3>
<p><code>src/prompts/monologue/actions.json</code> に次のアクションを追加します。</p>
<pre><code class="language-json">,
{
    &quot;name&quot;: &quot;sendLists&quot;,
    &quot;description&quot;: &quot;Send list of Candidates to Human Resources, aka HR for scheduling interviews&quot;,
    &quot;parameters&quot;: {
        &quot;type&quot;: &quot;object&quot;,
        &quot;properties&quot;: {
            &quot;list&quot;: {
                &quot;type&quot;: &quot;string&quot;,
                &quot;description&quot;: &quot;The name of the list to send Human Resources, aka HR for scheduling interviews&quot;
            },
            &quot;Candidates&quot;: {
                &quot;type&quot;: &quot;array&quot;,
                &quot;description&quot;: &quot;The Candidates in the list to send Human Resources, aka HR for scheduling interviews&quot;,
                &quot;Candidates&quot;: {
                    &quot;type&quot;: &quot;string&quot;
                }
            }
        },
        &quot;required&quot;: [
            &quot;list&quot;,
            &quot;Candidates&quot;
        ]
    }
}
</code></pre>
<p><cc-end-step lab="bta5" exercise="4" step="1" /></p>
<h3 id="step-2-sendlists">Step 2: 新しい <code>sendLists</code> アクション用の関数を作成する</h3>
<p><code>src/app/app.ts</code> で <code>getUserDisplayName</code> を探し、関数の前に <strong>export</strong> を追加します。最終的な関数は以下のようになります。</p>
<pre><code class="language-javascript">export async function getUserDisplayName {
...
...
...
}

</code></pre>
<p><code>src/app/app.ts</code> 内の <code>app</code> を探し、スコープに <strong>'Mail.Send'</strong> を追加します。最終的な app は次のとおりです。</p>
<pre><code class="language-javascript">const app = new Application({
  storage,
  authentication: {settings: {
    graph: {
      scopes: ['User.Read', 'Mail.Send'],
        ...
        ...
    }
  }}});
</code></pre>
<p><code>env/.env.local.user</code> に HR のメール アドレスを環境変数として追加します。</p>
<pre><code>HR_EMAIL=&lt;YOUR-EMAIL-ADDRESS&gt;
</code></pre>
<div class="admonition pied-piper">
<p class="admonition-title"><code>HR_EMAIL</code> の詳細 (ラボ用)</p>
<p>このラボをテストするために、ご自身のアカウントのメール アドレスを <code>HR_EMAIL</code> に入力してください。実際のシナリオでは、面接日程を送信する HR チームのメール アドレスを使用します。本ラボはプロトタイピング目的であり、本番環境での使用を想定していません。</p>
</div>
<p><code>teamsapp.local.yml</code> を開き、<code>file/createOrUpdateEnvironmentFile</code> の <strong>envs</strong> リストに次の行を追加します。</p>
<pre><code>HR_EMAIL: ${{HR_EMAIL}}
</code></pre>
<p><code>src/config.ts</code> を開き、次の行を追加します。</p>
<pre><code class="language-javascript">HR_EMAIL: process.env.HR_EMAIL
</code></pre>
<p><code>src/app/actions.ts</code> のインポートを以下のように更新します。</p>
<pre><code class="language-javascript">import { getUserDisplayName, ApplicationTurnState } from './app';
import { Client } from &quot;@microsoft/microsoft-graph-client&quot;;
import config from '../config';
</code></pre>
<p>続いて、<code>actions.ts</code> に次の関数を追加します。</p>
<pre><code class="language-javascript">async function sendLists(state: ApplicationTurnState, token): Promise&lt;string&gt; {
    const email = await createEmailContent(state.conversation.lists, token);
    try {
        const client = Client.init({
            authProvider: (done) =&gt; {
                done(null, token);
            }
        });
        const sendEmail = await client.api('/me/sendMail').post(JSON.stringify(email));
        if (sendEmail.ok) {
            return email.message.body.content;
        }
        else {
            console.log(`Error ${sendEmail.status} calling Graph in sendToHR: ${sendEmail.statusText}`);
            return 'Error sending email';
        }
    } catch (error) {
        console.error('Error in sendLists:', error);
        throw error;
    }
}

async function createEmailContent(lists, token) {
    let emailContent = '';
    for (const listName in lists) {
        if (lists.hasOwnProperty(listName)) {
        emailContent += `${listName}:\n`;
        lists[listName].forEach(candidate =&gt; {
            emailContent += `  • ${candidate}\n`;
        });
        emailContent += '\n'; // Add an extra line between different lists
        }
    }

    const profileName = await getUserDisplayName(token);

    const email ={
        &quot;message&quot;: {
        &quot;subject&quot;: &quot;Request to Schedule Interviews with Shortlisted Candidates&quot;,
        &quot;body&quot;: {
            &quot;contentType&quot;: &quot;Text&quot;,
            &quot;content&quot;: `Hello HR Team, \nI hope this email finds you well. \n\nCould you please assist in scheduling 1:1 interviews with the following shortlisted candidates? \n\n${emailContent} Please arrange suitable times and send out the calendar invites accordingly. \n\n Best Regards, \n ${profileName}`
        },
        &quot;toRecipients&quot;: [
            {
            &quot;emailAddress&quot;: {
                &quot;address&quot;: `${config.HR_EMAIL}`
            }
            }
        ]
        },
        &quot;saveToSentCandidates&quot;: &quot;true&quot;
    };
    return await email;
}
</code></pre>
<p>最後に <code>src/app/actions.ts</code> で <strong>sendLists</strong> をエクスポートに追加します。最終的なエクスポートは以下のとおりです。</p>
<pre><code class="language-javascript">export { getCandidates, setCandidates, ensureListExists, deleteList, sendLists };
</code></pre>
<p><cc-end-step lab="bta5" exercise="4" step="2" /></p>
<h3 id="step-3-sendlists">Step 3: <code>sendLists</code> アクション ハンドラーを登録する</h3>
<p><code>src/app/app.ts</code> で <code>./actions</code> のインポートを <strong>sendLists</strong> を含むように更新します。最終的なインポートは以下のようになります。</p>
<pre><code class="language-javascript">import { ensureListExists, getCandidates, setCandidates, deleteList, sendLists } from &quot;./actions&quot;;
</code></pre>
<p>次に、AI システムに <code>sendLists</code> アクションを登録するコード スニペットを追加します。</p>
<pre><code class="language-javascript">app.ai.action('sendLists', async (context: TurnContext, state: ApplicationTurnState, parameters: ListAndCandidates) =&gt; {
  await sendLists(state, state.temp.authTokens['graph']);
  return `Email sent to HR. Summarize your action.`;
});
</code></pre>
<p><cc-end-step lab="bta5" exercise="4" step="3" /></p>
<h3 id="step-4-entra-id">Step 4: Entra ID アプリ登録を更新する</h3>
<p>新しいスコープ <code>Mail.Send</code> に対応するよう Entra ID アプリのスクリプトを更新します。<code>aad.manifest.json</code> の <code>requiredResourceAccess</code> ノード内で <code>"resourceAppId": "Microsoft Graph",</code> を探し、<code>resourceAccess</code> 配列に次のスコープをカンマの後に追加します。</p>
<pre><code class="language-JSON"> {
    &quot;id&quot;: &quot;Mail.Send&quot;,
    &quot;type&quot;: &quot;Scope&quot;
}
</code></pre>
<p><cc-end-step lab="bta5" exercise="4" step="4" /></p>
<h3 id="step-5-sendlists">Step 5: アプリと新しい <code>sendLists</code> アクションをテストする</h3>
<p>Visual Studio Code の <strong>Run and Debug</strong> タブで <strong>Debug in Teams (Edge)</strong> または <strong>Debug in Teams (Chrome)</strong> を選択してデバッグを開始します。ブラウザーで Microsoft Teams が開きます。アプリの詳細が表示されたら <strong>Add</strong> を選択し、チャットを開始します。</p>
<div class="admonition tip">
<p class="admonition-title">この演習をローカルでテストする際のヒント</p>
<p>これまでに実装した Teams AI ライブラリの機能の一部は Teams App Test Tool では正常に動作しない場合があります。必ずローカルの Teams でテストおよびデバッグを行ってください。</p>
</div>
<p>Career Genie と会話を始めるには、たとえば「Hi」と打ち込んでください。</p>
<div class="admonition tip">
<p class="admonition-title">ブラウザーのポップアップ設定を確認</p>
<p>以下の手順をスムーズに行うため、ブラウザーでポップアップがブロックされていないことを確認してください。</p>
</div>
<p>追加の権限を求める小さなダイアログ ボックスが表示され、「Cancel」と「Continue」のボタンがあります。これはログインおよび必要な権限への同意を求めるものです。<strong>Continue</strong> を選択してください。</p>
<p><img alt="The chat in Microsoft Teams shows a message asking the user to consent permissions to the app associated with the custom engine agent. There are a message, a 'Continue' button, and a 'Cancel' button." src="../../../../../assets/images/custom-engine-04/consent-teams.png" /></p>
<p>Developer Tunnels でローカル実行しているため警告画面が表示されますが、<strong>Continue</strong> を選択します。アプリをデプロイするとユーザーには表示されません。ログインしてアプリの権限に同意する画面にリダイレクトされます。</p>
<div class="admonition tip">
<p class="admonition-title">組織全体の同意について</p>
<p>Microsoft 365 管理者の場合、「Consent on behalf of your organization」を選択してテナント内のすべてのユーザーの同意を行うこともできます。</p>
</div>
<p><strong>Accept</strong> を選択して権限に同意します。</p>
<p>Career Genie からログイン名を含むメッセージが届き、認証が成功したことを示します。これで Career Genie の新しいアクションをテストできます！</p>
<p>フローを理解するため、以下の順番で質問してみましょう。</p>
<ul>
<li>Hello  </li>
<li>Can you suggest candidates who have experience in .NET?  </li>
<li>Great, add Isaac Talbot in the .NET Developer Candidates list  </li>
<li>Add Anthony Ivanov in the same list with Isaac  </li>
<li>Can you summarize my lists  </li>
<li>Suggest candidates who have experience in Python and are able to speak Spanish  </li>
<li>Nice! Add Sara Folgueroles in the Python Developer Candidates (Spanish speaking) list  </li>
<li>Can you suggest candidates who have 10+ years of experience  </li>
<li>Ok, remove Anthony from the .NET Developer Candidates list  </li>
<li>Add Anthony Ivanov in the Talent list  </li>
<li>Summarize my lists  </li>
<li>Add Pedro Armijo in the same list with Sara  </li>
<li>Summarize my lists  </li>
<li>Send my lists to HR  </li>
</ul>
<div class="admonition tip">
<p class="admonition-title">メールボックスを確認</p>
<p>最後のステップの後、候補者リストのメールが届いていることを確認してください。</p>
</div>
<p><img alt="Animation showing the full experience of using Career Genie accordingly to the dialog flow illustrated above searching for candidates, adding them to lists, removing them from lists, and sending the lists of candidates by email to HR." src="../../../../../assets/images/custom-engine-05/career-genie-full.gif" /></p>
<p><cc-end-step lab="bta5" exercise="4" step="5" /></p>
<p><span style="font-size: large; font-weight: bold; color: #8d57c2;">おめでとうございます！</span></p>
<p>BTA5 - 複雑なタスクを処理するアクションの追加 を完了しました！さらに探求したい場合は、このラボのソース コードが <a href="https://github.com/microsoft/copilot-camp/tree/main/src/custom-engine-agent/Lab05-Actions/CareerGenie" target="_blank">Copilot Developer Camp リポジトリ</a> で公開されています。</p>
<p>これで <strong>Build your own agent</strong> パスは終了です！Career Genie の構築は楽しめましたか？ぜひご感想やフィードバックをお聞かせください。💜</p>
<p><cc-next label="Home" url="/" /></p>
<!-- <cc-award path="Build" /> -->

<p><img src="https://m365-visitor-stats.azurewebsites.net/copilot-camp/custom-engine/teams-ai/05-actions--ja" /></p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "toc.integrate", "content.code.copy"], "search": "../../../../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f", "clipboard.copy": "\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3078\u30b3\u30d4\u30fc", "search.result.more.one": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3082\u30461\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.more.other": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3042\u3068#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.none": "\u4f55\u3082\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f", "search.result.one": "1\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.other": "#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.placeholder": "\u691c\u7d22\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044", "search.result.term.missing": "\u691c\u7d22\u306b\u542b\u307e\u308c\u306a\u3044", "select.version": "\u30d0\u30fc\u30b8\u30e7\u30f3\u5207\u308a\u66ff\u3048"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
        <script src="../../../../../javascripts/cc-award.js"></script>
      
        <script src="../../../../../javascripts/cc-next.js"></script>
      
        <script src="../../../../../javascripts/cc-lab-step.js"></script>
      
        <script src="../../../../../javascripts/cc-card.js"></script>
      
    
  </body>
</html>