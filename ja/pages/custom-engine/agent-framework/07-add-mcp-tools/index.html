
<!doctype html>
<html lang="ja" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://microsoft.github.io/copilot-camp/ja/pages/custom-engine/agent-framework/07-add-mcp-tools/">
      
      
        <link rel="prev" href="../06-add-copilot-api/">
      
      
        <link rel="next" href="../../../beyond-agents/">
      
      
        
          <link rel="alternate" href="../../../../../pages/custom-engine/agent-framework/07-add-mcp-tools/" hreflang="en">
        
          <link rel="alternate" href="./" hreflang="ja">
        
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>ラボ BAF7 - MCP ツール統合の追加 - Copilot Developer Camp</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../stylesheets/labStyles.css">
    
      <link rel="stylesheet" href="../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#baf7-mcp" class="md-skip">
          コンテンツにスキップ
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="ヘッダー">
    <a href="../../../../" title="Copilot Developer Camp" class="md-header__button md-logo" aria-label="Copilot Developer Camp" data-md-component="logo">
      
  <img src="../../../../../assets/images/tent-small.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Copilot Developer Camp
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ラボ BAF7 - MCP ツール統合の追加
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="言語切り替え">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="../../../../../pages/custom-engine/agent-framework/07-add-mcp-tools/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="./" hreflang="ja" class="md-select__link">
              Japanese (日本語)
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="検索" placeholder="検索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="検索">
        
        <button type="reset" class="md-search__icon md-icon" title="クリア" aria-label="クリア" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            検索を初期化
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/microsoft/copilot-camp" title="リポジトリへ" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/copilot-camp
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="タブ" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../" class="md-tabs__link">
        
  
  
    
  
  ようこそ

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../make/" class="md-tabs__link">
          
  
  
  Maker 向けエージェントの作成

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../extend-m365-copilot/" class="md-tabs__link">
          
  
  
  宣言型エージェントの構築

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  カスタム エンジン エージェントの構築

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../beyond-agents/" class="md-tabs__link">
          
  
  
  AI の概念と手法

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../resources/" class="md-tabs__link">
        
  
  
    
  
  動画など

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="ナビゲーション" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../" title="Copilot Developer Camp" class="md-nav__button md-logo" aria-label="Copilot Developer Camp" data-md-component="logo">
      
  <img src="../../../../../assets/images/tent-small.png" alt="logo">

    </a>
    Copilot Developer Camp
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/microsoft/copilot-camp" title="リポジトリへ" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    microsoft/copilot-camp
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ようこそ
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Maker 向けエージェントの作成
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Maker 向けエージェントの作成
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Microsoft 365 Copilot 向けエージェントの作成
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/agent-builder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MAB - Copilot Studio Lite によるエージェント作成
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/agent-builder/01-first-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MAB1 - 最初のエージェントの構築
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MCS - Microsoft Copilot Studio の理解
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/00-prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MCS0 - セットアップ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/01-first-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MCS1 - 最初のエージェント
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/02-topics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MCS2 - トピックの定義
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/03-actions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MCS3 - ツールの定義
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/04-extending-m365-copilot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MCS4 - Microsoft 365 Copilot の拡張
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/05-connectors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MCS5 - Power Platform カスタム コネクター
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/06-mcp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MCS6 - MCP サーバーの利用
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/07-autonomous/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MCS7 - Autonomous エージェントの作成
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/08-rag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MCS8 - RAG のための Azure AI Search 統合
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/copilot-studio/09-connected-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MCS9 - Connected エージェント (プレビュー)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/sharepoint-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MSA - SharePoint エージェントの理解
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/sharepoint-agents/01-first-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MSA1 - 最初の SharePoint エージェントを構築する
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../make/sharepoint-agents/02-sharing-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lab MSA2 - SharePoint エージェントの共有
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    宣言型エージェントの構築
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    宣言型エージェントの構築
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Microsoft 365 Copilot の拡張
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    セットアップ
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    セットアップ
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/00-prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ E0 - セットアップ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    宣言型エージェントの基礎
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    宣言型エージェントの基礎
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/01-typespec-declarative-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ E1 - Microsoft 365 Agents Toolkit で TypeSpec 定義を使って Declarative エージェントを初めて作成する
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/01a-geolocator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ E1 - Geo Locator ゲーム エージェントのインストラクション
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    API をゼロから構築して統合
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    API をゼロから構築して統合
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/02-build-the-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ E2 - API の構築
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/03-add-declarative-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ E3 - 宣言型エージェントと API プラグインの追加
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/04-enhance-api-plugin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ E4 - API とプラグインの強化
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/05-add-adaptive-card/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ E5 - Adaptive Card の追加
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/06a-add-authentication-ttk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ E6a - OAuth で Entra ID 認証を追加 (Agents Toolkit)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    インテグレーション
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    インテグレーション
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/07-add-graphconnector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ E7 - 統合: Microsoft Copilot Connector を使用して Trey Genie に Knowledge 機能を追加
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/08-mcp-server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ 08 : Declarative エージェントを MCP サーバーに接続する
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../extend-m365-copilot/09-connected-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ 09: Connected Agent - Zava のマルチ エージェント請求オーケストレーション
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    カスタム エンジン エージェントの構築
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    カスタム エンジン エージェントの構築
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    カスタム エンジン エージェントの構築
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Microsoft Foundry で構築する
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Microsoft Foundry で構築する
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    はじめに - M365 Agents SDK と Semantic Kernel で独自エージェントを構築する
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/00-prerequisites/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ BMA0 - 前提条件
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/01-agent-in-foundry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ BMA1 - Microsoft Foundry でエージェントを準備する
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/02-agent-with-agents-sdk/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ BMA2 - M365 Agents SDK を使用した初めてのエージェント構築
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/03-agent-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ BMA3 - Microsoft Foundry エージェントと M365 Agents SDK の統合
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agents-sdk/04-bring-agent-to-copilot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ MBA4 - エージェントを Copilot Chat に追加
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Agent Framework で構築する
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Agent Framework で構築する
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Zava Insurance エージェントの構築 - Microsoft 365 Agents SDK と Agents Framework
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-build-and-run/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ BAF1 - 最初のエージェントの構築と実行
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-add-claim-search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ BAF2 - Azure AI Search を使用したドキュメント検索の追加
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../03-add-vision-analysis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ BAF3 - Mistral AI を使用したビジョン解析の追加
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-add-policy-search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ BAF4 - ポリシー検索の追加
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../05-add-communication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ BAF5 - 通信機能の追加
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../06-add-copilot-api/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ BAF6 - Microsoft 365 Work IQ API 統合を追加する
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    ラボ BAF7 - MCP ツール統合の追加
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    ラボ BAF7 - MCP ツール統合の追加
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目次">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目次
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
        概要
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-1-azure-functions-mcp" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 1: Azure Functions で MCP サーバーを作成する
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-2-mcp" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 2: エージェントで MCP クライアントを構成する
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-3-claimsadjustersplugin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 3: ClaimsAdjustersPlugin を作成する
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-4-claimsadjustersplugin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 4: エージェントに ClaimsAdjustersPlugin を登録する
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise-5-mcp" class="md-nav__link">
    <span class="md-ellipsis">
      
        Exercise 5: MCP ツール統合をテストする
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    AI の概念と手法
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    AI の概念と手法
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../beyond-agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Index
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../beyond-agents/beginner-agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    エージェント指示ラボ - エージェント指示の改善 (初心者向け)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    動画など
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="baf7-mcp">ラボ BAF7 - MCP ツール統合の追加</h1>
<p>このラボでは、Zava Insurance エージェントに Model Context Protocol ( MCP ) ツールを拡張します。Azure Functions を使用してクレーム アジャスター管理機能を提供する MCP サーバーを作成し、そのツールを Custom Engine エージェントのカスタム プラグインから利用します。</p>
<details class="info" open="open">
<summary>MCP 統合の理解</summary>
<p><strong>Model Context Protocol ( MCP )</strong> により、エージェントは次のことが可能になります。</p>
<ul>
<li><strong>外部ツールへの接続</strong>: 標準化されたプロトコルを使用して MCP サーバーのツールにアクセス</li>
<li><strong>クレーム アジャスターの管理</strong>: 専門分野や国別にアジャスターを一覧表示</li>
<li><strong>クレームへのアジャスター割り当て</strong>: クレーム種別に基づいて適切なアジャスターを自動的に割り当て</li>
<li><strong>Azure Functions の活用</strong>: MCP ツールをスケーラブルなサーバーレス関数としてホスト</li>
</ul>
<p>この統合は、MCP エコシステムを使用してエージェントの機能を拡張する方法を示します。</p>
</details>
<hr />

<h2 id="_1">概要</h2>
<p>前回までのラボで、クレーム検索、ビジョン分析、ポリシー検索、コミュニケーション機能を追加しました。今回は、クレーム種別と場所に基づいて専門のアジャスターにルーティングするという保険ワークフローで一般的な要件に対応するため、MCP ツールでクレーム アジャスターを管理する機能を拡張します。</p>
<p><strong>Model Context Protocol ( MCP )</strong> は、AI アプリケーションが外部データ ソースやツールに接続できるようにするオープン スタンダードです。Azure Functions で MCP サーバーを作成することで、ビジネス ロジックを MCP 互換のエージェントが利用できるツールとして公開できます。</p>
<details class="note" open="open">
<summary>構築するもの</summary>
<ul>
<li><strong>MCP サーバー</strong>: クレーム アジャスター ツールを MCP 経由で公開する Azure Function アプリ</li>
<li><strong>ClaimsAdjustersPlugin</strong>: MCP ツールを利用してアジャスターの一覧表示と割り当てを行うプラグイン</li>
<li><strong>エージェント統合</strong>: 会話内でアジャスター管理を可能にするためプラグインを接続</li>
</ul>
</details>
<h2 id="exercise-1-azure-functions-mcp">Exercise 1: Azure Functions で MCP サーバーを作成する</h2>
<details class="important">
<summary>事前定義された MCP サーバー</summary>
<p>MCP サーバーを最初から作成したくない場合は、Exercise 1 をスキップし、フォルダー <code>/src/agent-framework/insurance-mcp</code> から事前定義されたサーバーをダウンロードして、<code>env/.env.local</code> と <code>env/.env.local.user</code> ファイルを設定後、Visual Studio Code で F5 を押して実行できます。その場合は Exercise 2 へ進んでください。</p>
</details>
<p>まず、クレーム アジャスター管理ツールを公開する MCP サーバーとして Azure Function アプリを作成します。</p>
<h3 id="step-1-mcp">Step 1: MCP サーバー アーキテクチャを理解する</h3>
<details class="note">
<summary>MCP サーバーの仕組み</summary>
<p>MCP サーバーは MCP クライアントから呼び出せるツールを公開します。各ツールには以下が含まれます。</p>
<ul>
<li><strong>Tool Name</strong>: 一意の識別子 (例: <code>get_claims_adjusters</code>)</li>
<li><strong>Description</strong>: LLM がツールをいつ使用するかを理解するための説明</li>
<li><strong>Properties</strong>: 型と説明を持つ入力パラメーター</li>
<li><strong>Handler</strong>: ツールが呼び出されたときに実行される関数</li>
</ul>
<p>Azure Functions はネイティブな MCP プロトコル バインディングにより MCP サーバーのホスティング モデルを提供します。</p>
</details>
<p>MCP サーバーのアーキテクチャは次の構成です。</p>
<ol>
<li><strong>データ ストレージ</strong>: Azure Table Storage にクレーム アジャスター レコードを保存  </li>
<li><strong>HTTP ハンドラー</strong>: 直接 API アクセス用の REST エンドポイント  </li>
<li><strong>MCP ツール ハンドラー</strong>: エージェントが利用する MCP ツールとして登録された関数  </li>
</ol>
<p><cc-end-step lab="baf7" exercise="1" step="1" /></p>
<h3 id="step-2-azure-function">Step 2: Azure Function プロジェクトを作成する</h3>
<p>1️⃣ MCP サーバー プロジェクト用の新しいフォルダーを作成します。</p>
<pre><code class="language-bash">mkdir InsuranceMCPServer
cd InsuranceMCPServer
</code></pre>
<p>2️⃣ TypeScript で新しい Azure Functions プロジェクトを初期化します。</p>
<pre><code class="language-bash">func init --typescript
</code></pre>
<p>3️⃣ 必要な依存関係をインストールします。</p>
<pre><code class="language-bash">npm install @azure/data-tables dotenv
npm install --save-dev @types/node
</code></pre>
<p>4️⃣ 環境構成ファイル <code>env/.env.local</code> を作成します。</p>
<pre><code class="language-bash">AZURE_STORAGE_ACCOUNT=your_storage_account
AZURE_TABLE_ENDPOINT=https://your_storage_account.table.core.windows.net
TABLE_NAME=ClaimsAdjusters
ALLOW_INSECURE_CONNECTION=false
</code></pre>
<p>5️⃣ 環境構成ファイル <code>env/.env.local.user</code> を作成します。</p>
<pre><code class="language-bash">SECRET_AZURE_STORAGE_KEY=your_storage_key
</code></pre>
<p><cc-end-step lab="baf7" exercise="1" step="2" /></p>
<h3 id="step-3-claims-adjusters-function">Step 3: Claims Adjusters Function を作成する</h3>
<p>MCP ツール実装を含む <code>src/functions/ClaimsAdjusters.ts</code> ファイルを作成します。</p>
<pre><code class="language-typescript">import { app, HttpRequest, HttpResponseInit, InvocationContext } from &quot;@azure/functions&quot;;
import { TableClient, AzureNamedKeyCredential } from &quot;@azure/data-tables&quot;;
import * as dotenv from &quot;dotenv&quot;;
import * as path from &quot;path&quot;;
import * as fs from &quot;fs&quot;;

// Load environment variables (.env.local.user takes precedence over .env.local)
const envLocalFile = path.join(__dirname, &quot;../../../env/.env.local&quot;);
const envLocalUserFile = path.join(__dirname, &quot;../../../env/.env.local.user&quot;);

// Load .env.local first, then .env.local.user (later values override earlier ones)
dotenv.config({ path: envLocalFile });
if (fs.existsSync(envLocalUserFile)) {
    dotenv.config({ path: envLocalUserFile, override: true });
}

interface ClaimAdjuster {
    id: string;
    firstName: string;
    lastName: string;
    email: string;
    phone: string;
    country: string;
    area: string;
}

// Initialize Table Storage client
function getTableClient(): TableClient {
    const account = process.env.AZURE_STORAGE_ACCOUNT;
    const accountKey = process.env.SECRET_AZURE_STORAGE_KEY;
    const tableEndpoint = process.env.AZURE_TABLE_ENDPOINT;
    const tableName = process.env.TABLE_NAME;
    const allowInsecure = process.env.ALLOW_INSECURE_CONNECTION === &quot;true&quot;;

    if (!account || !accountKey || !tableEndpoint || !tableName) {
        throw new Error(&quot;Missing required environment variables. Please check your env/.env file.&quot;);
    }

    const credential = new AzureNamedKeyCredential(account, accountKey);
    return new TableClient(tableEndpoint, tableName, credential, {
        allowInsecureConnection: allowInsecure
    });
}

// Load claims adjusters data from Table Storage
async function loadClaimsAdjusters(): Promise&lt;ClaimAdjuster[]&gt; {
    const tableClient = getTableClient();
    const adjusters: ClaimAdjuster[] = [];

    const entities = tableClient.listEntities({
        queryOptions: { filter: `PartitionKey eq 'ClaimsAdjusters'` }
    });

    for await (const entity of entities) {
        adjusters.push({
            id: entity.rowKey as string,
            firstName: entity.firstName as string,
            lastName: entity.lastName as string,
            email: entity.email as string,
            phone: entity.phone as string,
            country: entity.country as string,
            area: entity.area as string
        });
    }

    return adjusters;
}

// Internal implementation: List claims adjusters with optional filters
async function listClaimsAdjustersImpl(country?: string, area?: string): Promise&lt;ClaimAdjuster[]&gt; {
    let adjusters = await loadClaimsAdjusters();

    // Apply filters
    if (country) {
        adjusters = adjusters.filter(adj =&gt; adj.country.toLowerCase() === country.toLowerCase());
    }

    if (area) {
        adjusters = adjusters.filter(adj =&gt; adj.area.toLowerCase() === area.toLowerCase());
    }

    return adjusters;
}

// Internal implementation: Get claim adjuster by ID
async function getClaimAdjusterByIdImpl(id: string): Promise&lt;ClaimAdjuster | null&gt; {
    const tableClient = getTableClient();

    try {
        const entity = await tableClient.getEntity(&quot;ClaimsAdjusters&quot;, id);
        const adjuster: ClaimAdjuster = {
            id: entity.rowKey as string,
            firstName: entity.firstName as string,
            lastName: entity.lastName as string,
            email: entity.email as string,
            phone: entity.phone as string,
            country: entity.country as string,
            area: entity.area as string
        };
        return adjuster;
    } catch (entityError: any) {
        if (entityError.statusCode === 404) {
            return null;
        }
        throw entityError;
    }
}

// Internal implementation: Assign a claim adjuster to a claim
async function assignClaimAdjusterImpl(claimId: string, adjusterId: string): Promise&lt;{
    success: boolean;
    assignmentId?: string;
    adjusterName?: string;
    error?: string;
}&gt; {
    if (!claimId || !adjusterId) {
        return {
            success: false,
            error: &quot;Both claimId and adjusterId are required&quot;
        };
    }

    // Verify adjuster exists
    const adjuster = await getClaimAdjusterByIdImpl(adjusterId);

    if (!adjuster) {
        return {
            success: false,
            error: `Claim adjuster with ID ${adjusterId} not found`
        };
    }

    // Generate fake assignment ID
    const currentYear = new Date().getFullYear();
    const randomNumber = Math.floor(Math.random() * 1000000).toString().padStart(6, '0');
    const assignmentId = `ASS-${currentYear}-${randomNumber}`;

    return {
        success: true,
        assignmentId: assignmentId,
        adjusterName: `${adjuster.firstName} ${adjuster.lastName}`
    };
}
</code></pre>
<p><cc-end-step lab="baf7" exercise="1" step="3" /></p>
<h3 id="step-4-mcp">Step 4: MCP ツールを登録する</h3>
<p><code>src/functions/ClaimsAdjusters.ts</code> の末尾に MCP ツール登録を追加します。</p>
<pre><code class="language-typescript">// MCP Tool Handler: List claims adjusters with optional filters
async function handleListClaimsAdjusters(input: any, context: InvocationContext): Promise&lt;ClaimAdjuster[] | { error: string }&gt; {
    context.log(`MCP: Listing claims adjusters with filters`);

    try {
        const country = input.arguments[&quot;country&quot;] || undefined;
        const area = input.arguments[&quot;area&quot;] || undefined;

        const adjusters = await listClaimsAdjustersImpl(country, area);
        return adjusters;
    } catch (error) {
        context.log('Error fetching claim adjusters:', error);
        return { error: (error as Error).message };
    }
}

// MCP Tool Handler: Get claim adjuster by ID
async function handleGetClaimsAdjusterById(input: any, context: InvocationContext): Promise&lt;ClaimAdjuster | { error: string }&gt; {
    context.log(`MCP: Getting claim adjuster by ID`);

    try {
        const id = input.arguments[&quot;id&quot;];

        if (!id) {
            return { error: &quot;Claim adjuster ID is required&quot; };
        }

        const adjuster = await getClaimAdjusterByIdImpl(id);

        if (!adjuster) {
            return { error: `Claim adjuster with ID ${id} not found` };
        }

        return adjuster;
    } catch (error) {
        context.log('Error fetching claim adjuster:', error);
        return { error: (error as Error).message };
    }
}

// MCP Tool Handler: Assign a claim adjuster to a claim
async function handleAssignClaimAdjuster(input: any, context: InvocationContext): Promise&lt;{ success: boolean; assignmentId?: string; adjusterName?: string; error?: string }&gt; {
    context.log(`MCP: Assigning claim adjuster to claim`);

    try {
        const claimId = input.arguments[&quot;claimId&quot;];
        const adjusterId = input.arguments[&quot;adjusterId&quot;];

        const result = await assignClaimAdjusterImpl(claimId, adjusterId);
        return result;
    } catch (error) {
        context.log('Error assigning claim adjuster:', error);
        return { success: false, error: (error as Error).message };
    }
}

// Register MCP tools
app.mcpTool(&quot;get_claims_adjusters&quot;, {
    toolName: &quot;get_claims_adjusters&quot;,
    description: &quot;Retrieve a list of all insurance claims adjusters&quot;,
    toolProperties: [
        {
            &quot;propertyName&quot;: &quot;country&quot;,
            &quot;propertyType&quot;: &quot;string&quot;,
            &quot;description&quot;: &quot;The country of the claim adjuster&quot;,
            &quot;isRequired&quot;: false
        },
        {
            &quot;propertyName&quot;: &quot;area&quot;,
            &quot;propertyType&quot;: &quot;string&quot;,
            &quot;description&quot;: &quot;The area of expertise of the claim adjuster&quot;,
            &quot;isRequired&quot;: false
        }
    ],
    handler: handleListClaimsAdjusters
});

app.mcpTool(&quot;get_claims_adjuster&quot;, {
    toolName: &quot;get_claims_adjuster&quot;,
    description: &quot;Retrieve a specific insurance claims adjuster by ID&quot;,
    toolProperties: [
        {
            &quot;propertyName&quot;: &quot;id&quot;,
            &quot;propertyType&quot;: &quot;string&quot;,
            &quot;description&quot;: &quot;The unique identifier of the claim adjuster&quot;,
            &quot;isRequired&quot;: true
        }
    ],
    handler: handleGetClaimsAdjusterById
});

app.mcpTool(&quot;assign_claim_adjuster&quot;, {
    toolName: &quot;assign_claim_adjuster&quot;,
    description: &quot;Assign a claim adjuster to an insurance claim&quot;,
    toolProperties: [
        {
            &quot;propertyName&quot;: &quot;claimId&quot;,
            &quot;propertyType&quot;: &quot;string&quot;,
            &quot;description&quot;: &quot;The unique identifier of the claim&quot;,
            &quot;isRequired&quot;: true
        },
        {
            &quot;propertyName&quot;: &quot;adjusterId&quot;,
            &quot;propertyType&quot;: &quot;string&quot;,
            &quot;description&quot;: &quot;The unique identifier of the claim adjuster to assign&quot;,
            &quot;isRequired&quot;: true
        }
    ],
    handler: handleAssignClaimAdjuster
});
</code></pre>
<details class="note">
<summary>MCP ツール登録パターン</summary>
<p>各 MCP ツールは <code>app.mcpTool()</code> を使用して登録します。</p>
<ul>
<li><strong>toolName</strong>: ツールを呼び出す際の識別子  </li>
<li><strong>description</strong>: LLM がこのツールをいつ使用すべきかを理解するための説明  </li>
<li><strong>toolProperties</strong>: 名前、型、説明、必須フラグを含む入力パラメーターの配列  </li>
<li><strong>handler</strong>: ツール ロジックを実行する async 関数  </li>
</ul>
</details>
<p><cc-end-step lab="baf7" exercise="1" step="4" /></p>
<h3 id="step-5-mcp">Step 5: MCP サーバーをデプロイする</h3>
<p>1️⃣ Azure で Azure Function App を作成します。</p>
<pre><code class="language-bash">az functionapp create --name your-mcp-server --resource-group your-rg --consumption-plan-location eastus --runtime node --runtime-version 20 --functions-version 4 --storage-account your-storage
</code></pre>
<p>2️⃣ 関数をデプロイします。</p>
<pre><code class="language-bash">func azure functionapp publish your-mcp-server
</code></pre>
<p>3️⃣ MCP サーバー エンドポイント URL を控えます (例: <code>https://your-mcp-server.azurewebsites.net/runtime/webhooks/mcp</code>)</p>
<details class="info">
<summary>開発トンネルでローカル MCP サーバーを公開</summary>
<p>MCP サーバーを Azure へ発行せずローカルで実行したまま <strong>Dev Tunnels</strong> で公開 URL を作成できます。</p>
<p>1️⃣ Azure Function をローカルで起動します。<br />
<code>bash
func start</code></p>
<p>2️⃣ 新しいターミナルで dev tunnel を作成・ホストします。<br />
<code>bash
devtunnel create --allow-anonymous
devtunnel port create -p 7071
devtunnel host</code></p>
<p>3️⃣ トンネル URL (例: <code>https://abc123.devtunnels.ms</code>) をコピーし、MCP サーバー エンドポイントを構成します。<br />
<code>text
https://abc123.devtunnels.ms/runtime/webhooks/mcp</code></p>
<p>デバッグとテストに便利です。<code>devtunnel host</code> コマンドを実行している限りトンネルは有効です。</p>
</details>
<p><cc-end-step lab="baf7" exercise="1" step="5" /></p>
<h2 id="exercise-2-mcp">Exercise 2: エージェントで MCP クライアントを構成する</h2>
<p>次に、Custom Engine エージェントを MCP サーバーへ接続できるよう設定します。</p>
<h3 id="step-1-mcp_1">Step 1: MCP クライアント構成を追加する</h3>
<p>1️⃣ エージェント プロジェクトの <code>.env.local</code> ファイルを開きます。</p>
<p>2️⃣ MCP サーバー構成を追加します。</p>
<pre><code class="language-bash"># MCP Server Configuration
MCP_SERVER_URL=https://your-mcp-server-url/runtime/webhooks/mcp
</code></pre>
<p><cc-end-step lab="baf7" exercise="2" step="1" /></p>
<h3 id="step-2-mcp">Step 2: 依存性注入に MCP クライアントを登録する</h3>
<p>1️⃣ ModelContextProtocol NuGet パッケージをインストールします。エージェント プロジェクト フォルダーでターミナルを開き、次を実行します。</p>
<pre><code class="language-bash">dotnet add package ModelContextProtocol --version 0.4.1-preview.1
</code></pre>
<p>2️⃣ <code>src/Program.cs</code> を開きます。</p>
<p>3️⃣ ファイルの先頭に必要な using ステートメントを追加します。</p>
<pre><code class="language-csharp">using ModelContextProtocol.Client;
using ModelContextProtocol.Protocol;
</code></pre>
<p>4️⃣ サービスが登録されている箇所を探し、MCP クライアント登録を追加します。</p>
<pre><code class="language-csharp">// Register MCP Client for claims adjusters
builder.Services.AddSingleton&lt;McpClient&gt;(sp =&gt;
{
    var configuration = sp.GetRequiredService&lt;IConfiguration&gt;();
    var mcpServerUrl = configuration[&quot;MCP_SERVER_URL&quot;] 
        ?? throw new InvalidOperationException(&quot;MCP_SERVER_URL is not configured&quot;);

    var clientTransport = new HttpClientTransport(new HttpClientTransportOptions {
        Endpoint = new Uri(mcpServerUrl)});

    return McpClient.CreateAsync(clientTransport).GetAwaiter().GetResult();
});
</code></pre>
<p><cc-end-step lab="baf7" exercise="2" step="2" /></p>
<h2 id="exercise-3-claimsadjustersplugin">Exercise 3: ClaimsAdjustersPlugin を作成する</h2>
<p>次に、MCP ツールを利用してクレーム アジャスターを管理するプラグインを作成します。</p>
<h3 id="step-1-claimsadjustersplugin">Step 1: ClaimsAdjustersPlugin を作成する</h3>
<details class="note">
<summary>このプラグインが行うこと</summary>
<p><code>ClaimsAdjustersPlugin</code> は主に 2 つの機能を提供します。</p>
<p><strong>ListClaimsAdjustersAsync</strong>:</p>
<ul>
<li>クレーム種別と国でフィルターしたクレーム アジャスターを取得  </li>
<li>クレーム種別を検証 (「Auto」と「Homeowners」のみサポート)  </li>
<li>MCP サーバーの <code>get_claims_adjusters</code> ツールを呼び出す  </li>
</ul>
<p><strong>AssignClaimAdjusterAsync</strong>:</p>
<ul>
<li>特定のアジャスターをクレームに割り当て  </li>
<li>割り当て ID を含む確認結果を返す  </li>
<li>MCP サーバーの <code>assign_claim_adjuster</code> ツールを呼び出す  </li>
</ul>
</details>
<p>1️⃣ <code>src/Plugins/ClaimsAdjustersPlugin.cs</code> ファイルを作成し、次の実装を追加します。</p>
<pre><code class="language-csharp">using Microsoft.Agents.Builder;
using Microsoft.Agents.Core.Models;
using System.ComponentModel;
using System.Text.Json;
using InsuranceAgent;
using Microsoft.Agents.Builder.State;
using ModelContextProtocol.Client;

namespace ZavaInsurance.Plugins
{
    /// &lt;summary&gt;
    /// Claims Adjusters Plugin for Zava Insurance
    /// Provides tools for managing and retrieving claims adjuster information via MCP.
    /// &lt;/summary&gt;
    public class ClaimsAdjustersPlugin
    {
        private readonly ITurnContext _turnContext;
        private readonly McpClient _mcpClient;
        private readonly IConfiguration _configuration;

        public ClaimsAdjustersPlugin(ITurnContext turnContext,
            McpClient mcpClient, 
            IConfiguration configuration)
        {
            _turnContext = turnContext ?? throw new ArgumentNullException(nameof(turnContext));
            _mcpClient = mcpClient ?? throw new ArgumentNullException(nameof(mcpClient));
            _configuration = configuration ?? throw new ArgumentNullException(nameof(configuration));
        }

        /// &lt;summary&gt;
        /// Retrieves claims adjusters based on claim type and country.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;claimType&quot;&gt;The claim type to filter claims adjusters (Auto or Homeowners)&lt;/param&gt;
        /// &lt;param name=&quot;country&quot;&gt;The country to filter claims adjusters&lt;/param&gt;
        /// &lt;returns&gt;A list of claims adjusters matching the criteria&lt;/returns&gt;
        [Description(&quot;Retrieves claims adjusters based on area and country&quot;)]
        public async Task&lt;string&gt; ListClaimsAdjustersAsync(string claimType, string country)
        {
            await NotifyUserAsync($&quot;Retrieving claims adjusters for area {claimType} and country {country}...&quot;);

            // Validate claim type - only &quot;Auto&quot; and &quot;Homeowners&quot; are supported
            if (claimType != &quot;Auto&quot; &amp;&amp; claimType != &quot;Homeowners&quot;)
            {
                claimType = null;
            }

            // Validate country
            if (country == &quot;All&quot;)
            {
                country = null;
            }

            var result = await _mcpClient.CallToolAsync(&quot;get_claims_adjusters&quot;, 
                new Dictionary&lt;string, object?&gt; {                 
                    [&quot;area&quot;] = claimType, 
                    [&quot;country&quot;] = country
                }
            );

            if (!result.IsError.HasValue || result.IsError.HasValue &amp;&amp; !result.IsError.Value)
            {
                var adjusters = result.Content;
                return JsonSerializer.Serialize(adjusters, new JsonSerializerOptions { WriteIndented = true });
            }
            else
            {
                return $&quot;Error retrieving claims adjusters!&quot;;
            }
        }

        /// &lt;summary&gt;
        /// Assigns a claims adjuster to a specific claim.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;claimId&quot;&gt;The ID of the claim&lt;/param&gt;
        /// &lt;param name=&quot;adjusterId&quot;&gt;The ID of the claims adjuster&lt;/param&gt;
        /// &lt;returns&gt;Confirmation message of assignment&lt;/returns&gt;
        [Description(&quot;Assigns a claims adjuster to a specific claim&quot;)]
        public async Task&lt;string&gt; AssignClaimAdjusterAsync(string claimId, string adjusterId)
        {
            await NotifyUserAsync($&quot;Assigning claims adjuster {adjusterId} to claim {claimId}...&quot;);

            var result = await _mcpClient.CallToolAsync(&quot;assign_claim_adjuster&quot;, 
                new Dictionary&lt;string, object?&gt; {                 
                    [&quot;claimId&quot;] = claimId, 
                    [&quot;adjusterId&quot;] = adjusterId
                }
            );

            if (!result.IsError.HasValue || result.IsError.HasValue &amp;&amp; !result.IsError.Value)
            {
                var adjusters = result.Content;
                return JsonSerializer.Serialize(adjusters, new JsonSerializerOptions { WriteIndented = true });
            }
            else
            {
                return $&quot;Error assigning claims adjuster!&quot;;
            }
        }

        private async Task NotifyUserAsync(string message)
        {
            if (!_turnContext.Activity.ChannelId.Channel!.Contains(Channels.Webchat))
            {
                await _turnContext.StreamingResponse.QueueInformativeUpdateAsync(message);
            }
            else
            {
                await _turnContext.StreamingResponse.QueueInformativeUpdateAsync(message).ConfigureAwait(false);
            }
        }
    }
}
</code></pre>
<p><cc-end-step lab="baf7" exercise="3" step="1" /></p>
<h2 id="exercise-4-claimsadjustersplugin">Exercise 4: エージェントに ClaimsAdjustersPlugin を登録する</h2>
<p>ZavaInsuranceAgent に ClaimsAdjustersPlugin を組み込みます。</p>
<h3 id="step-1">Step 1: エージェント コンストラクターを更新する</h3>
<p>1️⃣ <code>src/Agent/ZavaInsuranceAgent.cs</code> を開きます。</p>
<p>2️⃣ ファイル先頭に必要な using ステートメントを追加します。</p>
<pre><code class="language-csharp">using ModelContextProtocol.Client;
</code></pre>
<p>3️⃣ クラス フィールド セクションを見つけ、MCP クライアント フィールドを追加します。</p>
<pre><code class="language-csharp">private readonly McpClient _mcpClient = null;
</code></pre>
<p>4️⃣ コンストラクターを更新し、MCP クライアントを受け取って保持します。</p>
<pre><code class="language-csharp">public ZavaInsuranceAgent(AgentApplicationOptions options, IChatClient chatClient, IConfiguration configuration, IServiceProvider serviceProvider, IHttpClientFactory httpClientFactory, McpClient mcpClient) : base(options)
{
    _chatClient = chatClient;
    _configuration = configuration;
    _serviceProvider = serviceProvider;
    _httpClient = httpClientFactory.CreateClient() ?? throw new ArgumentNullException(nameof(httpClientFactory));
    _mcpClient = mcpClient;

    // Greet when members are added to the conversation
    OnConversationUpdate(ConversationUpdateEvents.MembersAdded, WelcomeMessageAsync);

    // Listen for ANY message to be received
    OnActivity(ActivityTypes.Message, OnMessageAsync, autoSignInHandlers: [UserAuthorization.DefaultHandlerName]);
}
</code></pre>
<p><cc-end-step lab="baf7" exercise="4" step="1" /></p>
<h3 id="step-2-claimsadjustersplugin">Step 2: ClaimsAdjustersPlugin をインスタンス化する</h3>
<p>1️⃣ <code>GetClientAgent</code> メソッド (他のプラグインをインスタンス化している箇所) を探します。</p>
<p>2️⃣ 他のプラグインの後に ClaimsAdjustersPlugin のインスタンス化を追加します。</p>
<pre><code class="language-csharp">// Create ClaimsAdjustersPlugin with MCP client
ClaimsAdjustersPlugin claimsAdjustersPlugin = new(context, _mcpClient, _configuration);
</code></pre>
<p><cc-end-step lab="baf7" exercise="4" step="2" /></p>
<h3 id="step-3-claimsadjusters">Step 3: ClaimsAdjusters ツールを登録する</h3>
<p>同じ <code>GetClientAgent</code> メソッドで <code>toolOptions.Tools</code> にツールを追加している箇所を探し、クレーム アジャスター ツールを登録します。</p>
<pre><code class="language-csharp">// Register Claims Adjusters MCP tools
toolOptions.Tools.Add(AIFunctionFactory.Create(claimsAdjustersPlugin.ListClaimsAdjustersAsync));
toolOptions.Tools.Add(AIFunctionFactory.Create(claimsAdjustersPlugin.AssignClaimAdjusterAsync));
</code></pre>
<p><cc-end-step lab="baf7" exercise="4" step="3" /></p>
<h3 id="step-4">Step 4: エージェント インストラクションを更新する</h3>
<p>エージェント インストラクションにクレーム アジャスターの機能を追加します。</p>
<p>1️⃣ <code>ZavaInsuranceAgent.cs</code> 内の <code>AgentInstructions</code> フィールドを探します。</p>
<p>2️⃣ クレーム アジャスター ツールをインストラクションに追加します。</p>
<pre><code class="language-csharp">private readonly string AgentInstructions = &quot;&quot;&quot;
        You are a professional insurance claims assistant for Zava Insurance.

        Whenever the user starts a new conversation or provides a prompt to start a new conversation like &quot;start over&quot;, &quot;restart&quot;, 
        &quot;new conversation&quot;, &quot;what can you do?&quot;, &quot;how can you help me?&quot;, etc. use {{StartConversationPlugin.StartConversation}} and 
        provide to the user exactly the message you get back from the plugin.

        **Available Tools:**
        Use {{DateTimeFunctionTool.getDate}} to get the current date and time.
        For claims search, use {{ClaimsPlugin.SearchClaims}} and {{ClaimsPlugin.GetClaimDetails}}.
        For damage photo viewing, use {{VisionPlugin.ShowDamagePhoto}}.
        For AI vision damage analysis, use {{VisionPlugin.AnalyzeAndShowDamagePhoto}} and require approval via {{VisionPlugin.ApproveAnalysis}}.
        For policy search, use {{PolicyPlugin.SearchPolicies}} and {{PolicyPlugin.GetPolicyDetails}}.
        For sending investigation reports and claim details via email, use {{CommunicationPlugin.GenerateInvestigationReport}} and {{CommunicationPlugin.SendClaimDetailsByEmail}}.
        For claims compliance analysis, use {{ClaimsPoliciesPlugin.AnalyzeClaimCompliance}}.

        To list claim adjusters use {{ClaimsAdjustersPlugin.ListClaimsAdjusters}}. When listing claim adjusters:
        - Always try to use the country of the current claim, if any. Otherwise, if no country is specified by the user, set country value to 'All'.
        - Always try to use the claim type of the current claim, if any.
        - Always retrieve id, firstName, lastName, email, country, phone, and area for each claim adjuster.
        - Only &quot;Auto&quot; and &quot;Homeowners&quot; are valid claim types. If the user provides any other claim type, set area value to null.

        To assign a claim adjuster to a claim use {{ClaimsAdjustersPlugin.AssignClaimAdjuster}}.

        **IMPORTANT**: When user asks to &quot;check policy for this claim&quot;, first use GetClaimDetails to get the claim's policy number, then use GetPolicyDetails with that policy number.

        **IMPORTANT**: If in the response there are references to citations like [1], [2], etc., make sure to include those citations in the response so that M365 Copilot can render them properly.

        Stick to the scenario above and use only the information from the tools when answering questions.
        Be concise and professional in your responses.
        &quot;&quot;&quot;;
</code></pre>
<details class="note">
<summary>これらのインストラクションが重要な理由</summary>
<p>インストラクションは LLM にクレーム アジャスター ツールの効果的な使用方法を伝えます。</p>
<ul>
<li><strong>国の推定</strong>: クレームの国情報がある場合はそれを使用  </li>
<li><strong>クレーム種別の検証</strong>: 「Auto」と「Homeowners」のみ有効な専門分野  </li>
<li><strong>コンテキスト認識</strong>: 既存のクレーム コンテキストを活用して関連するアジャスターを提供  </li>
</ul>
</details>
<p><cc-end-step lab="baf7" exercise="4" step="4" /></p>
<h2 id="exercise-5-mcp">Exercise 5: MCP ツール統合をテストする</h2>
<p>いよいよ MCP ツール統合全体をテストします！</p>
<h3 id="step-1_1">Step 1: 実行と確認</h3>
<p>1️⃣ MCP サーバーが実行中であることを確認します (ローカルまたは Azure にデプロイ)。</p>
<p>2️⃣ VS Code で <strong>F5</strong> を押してエージェントをデバッグ起動します。</p>
<p>3️⃣ プロンプトが表示されたら <strong>(Preview) Debug in Copilot (Edge)</strong> を選択します。</p>
<p>4️⃣ ターミナルに通常の初期化メッセージが表示されます。</p>
<p>5️⃣ ブラウザー ウィンドウが開き、Microsoft 365 Copilot が表示されます。</p>
<p><cc-end-step lab="baf7" exercise="5" step="1" /></p>
<h3 id="step-2">Step 2: クレーム アジャスター一覧のテスト</h3>
<p>1️⃣ Microsoft 365 Copilot で、まずクレームを取得してコンテキストを確立します。</p>
<pre><code class="language-text">Get details for claim CLM-2025-001007
</code></pre>
<p>2️⃣ 次にアジャスターを問い合わせます。</p>
<pre><code class="language-text">List available claims adjusters for this claim
</code></pre>
<p>エージェントは以下を行うはずです。</p>
<ul>
<li>クレームの種別 (Auto) と国を使用  </li>
<li><code>get_claims_adjusters</code> MCP ツールを呼び出す  </li>
<li>条件に一致するアジャスターの一覧を返す  </li>
</ul>
<p><cc-end-step lab="baf7" exercise="5" step="2" /></p>
<h3 id="step-3">Step 3: アジャスター割り当てのテスト</h3>
<p>1️⃣ アジャスターの一覧を取得した後、次のように割り当てます。</p>
<pre><code class="language-text">Assign adjuster ADJ-EE-0001 to this claim
</code></pre>
<p>エージェントは以下を行うはずです。</p>
<ul>
<li><code>assign_claim_adjuster</code> MCP ツールを呼び出す  </li>
<li>割り当て ID を含む確認結果を返す  </li>
<li>アジャスター名を確認する  </li>
</ul>
<p><cc-end-step lab="baf7" exercise="5" step="3" /></p>
<h3 id="step-4_1">Step 4: フィルター付きテスト</h3>
<p>1️⃣ 直接フィルターを指定してテストします。</p>
<pre><code class="language-text">Show me all Auto adjusters in the United States
</code></pre>
<p>エージェントは専門分野と国の両方でアジャスターをフィルターするはずです。</p>
<p>2️⃣ 「All」国を指定してテストします。</p>
<pre><code class="language-text">List all Homeowners adjusters
</code></pre>
<p>エージェントは国に関係なく Homeowners アジャスターをすべて返すはずです。</p>
<p><cc-end-step lab="baf7" exercise="5" step="4" /></p>
<div class="admonition success">
<p class="admonition-title">おめでとうございます！</p>
<p>MCP ツールを Custom Engine エージェントに統合できました。エージェントは次のことが可能になりました。</p>
<p>✅ 外部 MCP サーバーへの接続<br />
✅ 専門分野と国でフィルターしたクレーム アジャスターの一覧表示<br />
✅ アジャスターをクレームに割り当て、確認を取得<br />
✅ クレーム コンテキストを使用して関連するアジャスターを提案  </p>
<p>このパターンは、任意の MCP 互換サービスと統合するために拡張できます。豊富なツール エコシステムを活用し、エージェントの機能をさらに向上させましょう。</p>
</div>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "toc.integrate", "content.code.copy"], "search": "../../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f", "clipboard.copy": "\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3078\u30b3\u30d4\u30fc", "search.result.more.one": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3082\u30461\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.more.other": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3042\u3068#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.none": "\u4f55\u3082\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f", "search.result.one": "1\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.other": "#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.placeholder": "\u691c\u7d22\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044", "search.result.term.missing": "\u691c\u7d22\u306b\u542b\u307e\u308c\u306a\u3044", "select.version": "\u30d0\u30fc\u30b8\u30e7\u30f3\u5207\u308a\u66ff\u3048"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../../../javascripts/cc-award.js"></script>
      
        <script src="../../../../../javascripts/cc-next.js"></script>
      
        <script src="../../../../../javascripts/cc-lab-step.js"></script>
      
        <script src="../../../../../javascripts/cc-card.js"></script>
      
    
  </body>
</html>